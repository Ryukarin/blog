<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VBA 之 函数的使用 | KARIN</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <link rel="alternate" type="application/atom+xml" href="https://vuepress-theme-hope-demo.mrhope.site/blog/atom.xml" title="KARIN Atom Feed">
    <link rel="alternate" type="application/json" href="https://vuepress-theme-hope-demo.mrhope.site/blog/feed.json" title="KARIN JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="https://vuepress-theme-hope-demo.mrhope.site/blog/rss.xml" title="KARIN RSS Feed">
    <link rel="icon" href="/favicon.png">
    <link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512">
    <link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192">
    <link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512">
    <link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192">
    <link rel="manifest" href="/blog/manifest.webmanifest" crossorigin="use-credentials">
    <link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png">
    <meta name="description" content="KARIN的学习笔记">
    <meta property="og:url" content="/blog/project/Excel/13.VBA_function.html">
    <meta property="og:site_name" content="KARIN">
    <meta property="og:title" content="VBA 之 函数的使用">
    <meta property="og:description" content="153、调用工作表函数求和 在对工作表的单元格区域进行求和计算时，使用工作表 Sum 函数比使用 VBA 代码遍历单元格进行累加求和效率要高得多，代码如下所示。 代码解析： rngSum 过程调用工作表 Sum 函数对工作表的单元格区域进行求和计算。 在 VBA 中调用工作表函数需要在工作表函数前加上 WorksheetFunction 属性。应用于 App">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="zh-CN">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="KARIN">
    <meta property="article:author" content="karin">
    <meta property="article:tag" content="Excel">
    <meta property="article:published_time" content="2021-07-02T00:00:00.000Z">
    <meta name="theme-color" content="#46bd87">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    
    <link rel="preload" href="/blog/assets/css/0.styles.5649bb21.css" as="style"><link rel="preload" href="/blog/assets/js/app.9f9c9b81.js" as="script"><link rel="preload" href="/blog/assets/js/vendors~layout-Layout.79b66223.js" as="script"><link rel="preload" href="/blog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.efafecdd.js" as="script"><link rel="preload" href="/blog/assets/js/page-VBA之函数的使用.60f6a8be.js" as="script"><link rel="prefetch" href="/blog/assets/js/122.7ad47f04.js"><link rel="prefetch" href="/blog/assets/js/123.ae4a39df.js"><link rel="prefetch" href="/blog/assets/js/124.2715123b.js"><link rel="prefetch" href="/blog/assets/js/125.a4234a33.js"><link rel="prefetch" href="/blog/assets/js/126.8fa2f32c.js"><link rel="prefetch" href="/blog/assets/js/127.9bf5c918.js"><link rel="prefetch" href="/blog/assets/js/128.0c398c07.js"><link rel="prefetch" href="/blog/assets/js/layout-Blog.8dd576a3.js"><link rel="prefetch" href="/blog/assets/js/layout-Layout.3729e73b.js"><link rel="prefetch" href="/blog/assets/js/layout-NotFound.f1d2f2e6.js"><link rel="prefetch" href="/blog/assets/js/layout-Slide.7ed7d0aa.js"><link rel="prefetch" href="/blog/assets/js/page--3d4f54c7.4eab0894.js"><link rel="prefetch" href="/blog/assets/js/page-Docker数据管理.143b7f4f.js"><link rel="prefetch" href="/blog/assets/js/page-Excel函数.22369a36.js"><link rel="prefetch" href="/blog/assets/js/page-Excel快捷键.8fdc623f.js"><link rel="prefetch" href="/blog/assets/js/page-Excel笔记介绍.57c3fe06.js"><link rel="prefetch" href="/blog/assets/js/page-FTP笔记.2b8526c8.js"><link rel="prefetch" href="/blog/assets/js/page-Git介绍.82a25571.js"><link rel="prefetch" href="/blog/assets/js/page-Git分支管理.4f9c0210.js"><link rel="prefetch" href="/blog/assets/js/page-Git创建仓库.cabea66e.js"><link rel="prefetch" href="/blog/assets/js/page-Git基本操作.4e1f4734.js"><link rel="prefetch" href="/blog/assets/js/page-Git安装.cf6d44b4.js"><link rel="prefetch" href="/blog/assets/js/page-Git工作区、暂存区和版本库.5d561956.js"><link rel="prefetch" href="/blog/assets/js/page-Git工作流程.d2b8995f.js"><link rel="prefetch" href="/blog/assets/js/page-Git服务器搭建.7f6986af.js"><link rel="prefetch" href="/blog/assets/js/page-Git查看提交历史.40ff21ea.js"><link rel="prefetch" href="/blog/assets/js/page-Git标签.8f2c2cb6.js"><link rel="prefetch" href="/blog/assets/js/page-Git笔记.5e6ddcdf.js"><link rel="prefetch" href="/blog/assets/js/page-Git远程仓库（GitHub）.c8505cba.js"><link rel="prefetch" href="/blog/assets/js/page-Git配置.f141007c.js"><link rel="prefetch" href="/blog/assets/js/page-IT基础.e088bf26.js"><link rel="prefetch" href="/blog/assets/js/page-LAMP和LNMP环境搭建.adf92a39.js"><link rel="prefetch" href="/blog/assets/js/page-Markdown语法.76ecc03f.js"><link rel="prefetch" href="/blog/assets/js/page-SELinux管理.4075242b.js"><link rel="prefetch" href="/blog/assets/js/page-SFTP笔记.cdcf4d77.js"><link rel="prefetch" href="/blog/assets/js/page-Shell函数.775b51bc.js"><link rel="prefetch" href="/blog/assets/js/page-Shell变量.cda63b20.js"><link rel="prefetch" href="/blog/assets/js/page-Shell对文件的操作---sed命令.cd166768.js"><link rel="prefetch" href="/blog/assets/js/page-Shell对文本的搜索---grep命令.6083e37d.js"><link rel="prefetch" href="/blog/assets/js/page-Shell对输出流的处理---awk命令.0d48e00c.js"><link rel="prefetch" href="/blog/assets/js/page-Shell数组.4b8667ee.js"><link rel="prefetch" href="/blog/assets/js/page-Shell格式化输入.bf1e7958.js"><link rel="prefetch" href="/blog/assets/js/page-Shell格式化输出.6607e3e6.js"><link rel="prefetch" href="/blog/assets/js/page-Shell正则表达式.ebfdf1ff.js"><link rel="prefetch" href="/blog/assets/js/page-Shell流程控制---case分支语句.332bd80e.js"><link rel="prefetch" href="/blog/assets/js/page-Shell流程控制---for循环语句.de1b1b0b.js"><link rel="prefetch" href="/blog/assets/js/page-Shell流程控制---if判断语句.b0532849.js"><link rel="prefetch" href="/blog/assets/js/page-Shell流程控制---until循环语句.e7c9c7f3.js"><link rel="prefetch" href="/blog/assets/js/page-Shell流程控制---while循环语句.09fcf551.js"><link rel="prefetch" href="/blog/assets/js/page-Shell监控脚本.214dbdf6.js"><link rel="prefetch" href="/blog/assets/js/page-Shell脚本---lamp环境安装.02e925e4.js"><link rel="prefetch" href="/blog/assets/js/page-Shell脚本介绍.a9743a4a.js"><link rel="prefetch" href="/blog/assets/js/page-Shell脚本笔记.333fc9cf.js"><link rel="prefetch" href="/blog/assets/js/page-Shell语法.af36ce2b.js"><link rel="prefetch" href="/blog/assets/js/page-Shell运算.2f6e1b67.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之Application对象.dc3d863e.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之Range对象.aff14b9e.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之Shape、Chart对象.c8437d84.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之Sheet对象.40acafa7.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之Workbook对象.4b6ac3e5.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之使用对话框.32011bcc.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之控件与用户窗体1.b004969b.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之控件与用户窗体2.0ca5f6c7.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之控件与用户窗体3.d9a20920.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之文件操作.5f150c21.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之菜单和工具栏.ec98d91f.js"><link rel="prefetch" href="/blog/assets/js/page-linux三剑客.e71431d8.js"><link rel="prefetch" href="/blog/assets/js/page-linux介绍.eae8610d.js"><link rel="prefetch" href="/blog/assets/js/page-linux关机和重启命令.13f93679.js"><link rel="prefetch" href="/blog/assets/js/page-linux其他权限管理命令.cedaf338.js"><link rel="prefetch" href="/blog/assets/js/page-linux压缩、解压缩命令.6908caa3.js"><link rel="prefetch" href="/blog/assets/js/page-linux基本操作命令.e8f72eb0.js"><link rel="prefetch" href="/blog/assets/js/page-linux大杂烩.9f8cdc5c.js"><link rel="prefetch" href="/blog/assets/js/page-linux帮助命令.4fdeff8c.js"><link rel="prefetch" href="/blog/assets/js/page-linux常用网络命令.8169fd78.js"><link rel="prefetch" href="/blog/assets/js/page-linux搜索命令.8d223c34.js"><link rel="prefetch" href="/blog/assets/js/page-linux数据备份与恢复.f202f4a1.js"><link rel="prefetch" href="/blog/assets/js/page-linux文件系统管理.859d9e24.js"><link rel="prefetch" href="/blog/assets/js/page-linux文件系统结构.a7348129.js"><link rel="prefetch" href="/blog/assets/js/page-linux文本编辑器.fa0a4df9.js"><link rel="prefetch" href="/blog/assets/js/page-linux权限管理命令.be5e8ebf.js"><link rel="prefetch" href="/blog/assets/js/page-linux用户和用户组管理.4079bdf7.js"><link rel="prefetch" href="/blog/assets/js/page-linux的管理建议.82f61a78.js"><link rel="prefetch" href="/blog/assets/js/page-linux系统启动管理.96ebf1d7.js"><link rel="prefetch" href="/blog/assets/js/page-linux系统工作管理.3c407e77.js"><link rel="prefetch" href="/blog/assets/js/page-linux系统日志管理.72ca77b7.js"><link rel="prefetch" href="/blog/assets/js/page-linux系统服务管理.46ae7426.js"><link rel="prefetch" href="/blog/assets/js/page-linux系统进程管理.d56234ab.js"><link rel="prefetch" href="/blog/assets/js/page-linux软件安装.cc84e331.js"><link rel="prefetch" href="/blog/assets/js/page-linux高级文件系统管理.9e3c9bf6.js"><link rel="prefetch" href="/blog/assets/js/page-【MSG1500】刷机.c9407606.js"><link rel="prefetch" href="/blog/assets/js/page-【OpenWRT】固件编译.0ef4cd6f.js"><link rel="prefetch" href="/blog/assets/js/page-【Padavan】固件编译.d2a97584.js"><link rel="prefetch" href="/blog/assets/js/page-【RM2100】刷机救转.c6946098.js"><link rel="prefetch" href="/blog/assets/js/page-【VuePress】博客搭建.11c20d91.js"><link rel="prefetch" href="/blog/assets/js/page-【bootimg】解包打包.9ffb0b1e.js"><link rel="prefetch" href="/blog/assets/js/page-【openwrt】编译F大N1固件.49fa444e.js"><link rel="prefetch" href="/blog/assets/js/page-【squashfs】解包打包.58587e3c.js"><link rel="prefetch" href="/blog/assets/js/page-【小娱C1C5】刷机.4e341876.js"><link rel="prefetch" href="/blog/assets/js/page-【小娱C1C5】改造计划.ce3479e5.js"><link rel="prefetch" href="/blog/assets/js/page-【斐讯N1】Armbian.3bec83f3.js"><link rel="prefetch" href="/blog/assets/js/page-【斐讯N1】开机第一屏logo替换.57e2b6fa.js"><link rel="prefetch" href="/blog/assets/js/page-【贝壳云】改造计划.89b5027b.js"><link rel="prefetch" href="/blog/assets/js/page-【魔百合Q5】改造计划.510447e8.js"><link rel="prefetch" href="/blog/assets/js/page-个人信息.60959644.js"><link rel="prefetch" href="/blog/assets/js/page-主要功能与配置演示.90c45f63.js"><link rel="prefetch" href="/blog/assets/js/page-使用Dockerfile创建镜像.39abbd05.js"><link rel="prefetch" href="/blog/assets/js/page-使用Docker镜像.f46cc3e5.js"><link rel="prefetch" href="/blog/assets/js/page-初识Docker与容器.03017897.js"><link rel="prefetch" href="/blog/assets/js/page-博客主页.ee0b8fe8.js"><link rel="prefetch" href="/blog/assets/js/page-常用网站.40b6c65e.js"><link rel="prefetch" href="/blog/assets/js/page-幻灯片页.d2d94e64.js"><link rel="prefetch" href="/blog/assets/js/page-操作Docker容器.fca5b876.js"><link rel="prefetch" href="/blog/assets/js/page-核心概念与安装配置.bf9114e2.js"><link rel="prefetch" href="/blog/assets/js/page-瞎折腾.1dfcca6f.js"><link rel="prefetch" href="/blog/assets/js/page-端口映射与容器互联.44a4b5aa.js"><link rel="prefetch" href="/blog/assets/js/page-虚拟化的发展.7ac33b9a.js"><link rel="prefetch" href="/blog/assets/js/page-访问Docker仓库.71b3e000.js"><link rel="prefetch" href="/blog/assets/js/page-项目主页.24aa2c8e.js"><link rel="prefetch" href="/blog/assets/js/vendors~flowchart.eb5798cd.js"><link rel="prefetch" href="/blog/assets/js/vendors~mermaid.f1e52241.js"><link rel="prefetch" href="/blog/assets/js/vendors~photo-swipe.46d64c2d.js"><link rel="prefetch" href="/blog/assets/js/vendors~reveal.3f88bab1.js"><link rel="prefetch" href="/blog/assets/js/vendors~waline.8e39946b.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.5649bb21.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.png" alt="KARIN" class="logo"> <!----> <span class="site-name can-hide">KARIN</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">主题色:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">主题模式:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  博客主页
</a></div><div class="nav-item"><a href="/blog/project/" class="nav-link router-link-active active"><i class="iconfont icon-folder"></i>
  项目总览
</a></div><div class="nav-item"><a href="/blog/IT/" class="nav-link"><i class="iconfont icon-blog"></i>
  知识要点
</a></div><div class="nav-item"><a href="/blog/operate/" class="nav-link"><i class="iconfont icon-operate"></i>
  捣鼓折腾
</a></div></nav> <!----> <a rel="noopener noreferrer" href="https://github.com/Ryukarin/blog" target="_blank" class="repo-link can-hide">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div vocab="https://schema.org/" typeof="Person" class="blogger-info mobile"><div data-balloon-pos="down" role="navigation" class="blogger hasIntro"><img property="image" alt="Blogger Avatar" src="/blog/logo.png" class="avatar round"> <div property="name" class="name">karin</div> <meta property="url" content="/blog/intro/"></div> <div class="num-wrapper"><div><div class="num">106</div> <div>文章</div></div> <div><div class="num">14</div> <div>分类</div></div> <div><div class="num">18</div> <div>标签</div></div> <div><div class="num">105</div> <div>时间轴</div></div></div> <div class="media-links-wrapper"><a href="https://gitee.com/ryuukarin" rel="noopener noreferrer" target="_blank" aria-label="Gitee" data-balloon-pos="up" class="media-link"><span class="sr-only">Gitee</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-gitee"><circle cx="512" cy="512" r="512" fill="#C71D23"></circle> <path d="M772.953 454.723H480.17v.006a25.46 25.46 0 0 0-25.46 25.453l-.025 63.649a25.46 25.46 0 0 0 25.46 25.466l178.242-.007a25.46 25.46 0 0 1 25.459 25.46v12.73c0 42.18-34.198 76.378-76.378 76.378H365.583a25.46 25.46 0 0 1-25.46-25.46V416.533h-.006c0-42.18 34.192-76.378 76.378-76.378h356.388v-.013a25.46 25.46 0 0 0 25.46-25.446l.057-63.65h.013a25.46 25.46 0 0 0-25.46-25.471l-356.432.012c-105.453 0-190.946 85.493-190.946 190.946v356.433a25.46 25.46 0 0 0 25.46 25.46H626.56c94.913 0 171.852-76.94 171.852-171.852V480.182a25.46 25.46 0 0 0-25.46-25.46z" fill="#fff"></path></svg></a><a href="https://github.com/Ryukarin" rel="noopener noreferrer" target="_blank" aria-label="Github" data-balloon-pos="up" class="media-link"><span class="sr-only">Github</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-github"><circle cx="512" cy="512" r="512" fill="#171515"></circle> <path d="M509.423 146.442c-200.317 0-362.756 162.42-362.756 362.8 0 160.266 103.936 296.24 248.109 344.217 18.139 3.327 24.76-7.872 24.76-17.486 0-8.613-.313-31.427-.49-61.702-100.912 21.923-122.205-48.63-122.205-48.63-16.495-41.91-40.28-53.067-40.28-53.067-32.937-22.51 2.492-22.053 2.492-22.053 36.407 2.566 55.568 37.386 55.568 37.386 32.362 55.438 84.907 39.43 105.58 30.143 3.296-23.444 12.667-39.43 23.032-48.498-80.557-9.156-165.246-40.28-165.246-179.297 0-39.604 14.135-71.988 37.342-97.348-3.731-9.178-16.18-46.063 3.556-96.009 0 0 30.46-9.754 99.76 37.19 28.937-8.048 59.97-12.071 90.823-12.211 30.807.14 61.843 4.165 90.822 12.21 69.26-46.944 99.663-37.189 99.663-37.189 19.792 49.946 7.34 86.831 3.61 96.01 23.25 25.359 37.29 57.742 37.29 97.347 0 139.366-84.82 170.033-165.637 179.013 13.026 11.2 24.628 33.342 24.628 67.182 0 48.498-.445 87.627-.445 99.521 0 9.702 6.535 20.988 24.945 17.444 144.03-48.067 247.881-183.95 247.881-344.175 0-200.378-162.442-362.798-362.802-362.798z" fill="#FFF"></path></svg></a></div></div> <hr> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  博客主页
</a></div><div class="nav-item"><a href="/blog/project/" class="nav-link router-link-active active"><i class="iconfont icon-folder"></i>
  项目总览
</a></div><div class="nav-item"><a href="/blog/IT/" class="nav-link"><i class="iconfont icon-blog"></i>
  知识要点
</a></div><div class="nav-item"><a href="/blog/operate/" class="nav-link"><i class="iconfont icon-operate"></i>
  捣鼓折腾
</a></div> <a rel="noopener noreferrer" href="https://github.com/Ryukarin/blog" target="_blank" class="repo-link">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><a href="/blog/" aria-current="page" class="sidebar-link"><i class="iconfont icon-home"></i>博客主页</a></li><li><a href="/blog/project/" aria-current="page" class="sidebar-link"><i class="iconfont icon-folder"></i>项目主页</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-blog"></i> <span class="title">知识要点</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-operate"></i> <span class="title">捣鼓折腾</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-linux"></i> <span class="title">Linux基础知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-linux"></i> <span class="title">Linux系统管理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-linux"></i> <span class="title">Linux大杂烩</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-shell"></i> <span class="title">Shell笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-geometry"></i> <span class="title">Docker笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-git"></i> <span class="title">Git笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable open"><i class="iconfont icon-note"></i> <span class="title">Excel修炼秘籍</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/project/Excel/" aria-current="page" class="sidebar-link">Excel 笔记介绍</a></li><li><a href="/blog/project/Excel/01.Excel_hotkey/" class="sidebar-link">Excel 快捷键</a></li><li><a href="/blog/project/Excel/02.Excel_function/" class="sidebar-link">Excel 函数</a></li><li><a href="/blog/project/Excel/03.VBA_Range/" class="sidebar-link">VBA 之 Range 对象</a></li><li><a href="/blog/project/Excel/04.VBA_Sheet/" class="sidebar-link">VBA 之 Sheet 对象</a></li><li><a href="/blog/project/Excel/05.VBA_Workbook/" class="sidebar-link">VBA 之 Workbook 对象</a></li><li><a href="/blog/project/Excel/06.VBA_Shape_Chart/" class="sidebar-link">VBA 之 Shape、Chart 对象</a></li><li><a href="/blog/project/Excel/07.VBA_Application/" class="sidebar-link">VBA 之 Application 对象</a></li><li><a href="/blog/project/Excel/08.VBA_dialog/" class="sidebar-link">VBA 之 使用对话框</a></li><li><a href="/blog/project/Excel/09.VBA_menu_toolbar/" class="sidebar-link">VBA 之 菜单和工具栏</a></li><li><a href="/blog/project/Excel/10.VBA_controls_form_1/" class="sidebar-link">VBA 之 控件与用户窗体1</a></li><li><a href="/blog/project/Excel/11.VBA_controls_form_2/" class="sidebar-link">VBA 之 控件与用户窗体2</a></li><li><a href="/blog/project/Excel/12.VBA_controls_form_3/" class="sidebar-link">VBA 之 控件与用户窗体3</a></li><li><a href="/blog/project/Excel/13.VBA_function/" aria-current="page" class="active sidebar-link">VBA 之 函数的使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/project/Excel/13.VBA_function/#_153、调用工作表函数求和" class="sidebar-link">153、调用工作表函数求和</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/13.VBA_function/#_154、查找最大、最小值" class="sidebar-link">154、查找最大、最小值</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/13.VBA_function/#_155、不重复值的录入" class="sidebar-link">155、不重复值的录入</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/13.VBA_function/#_156、获得当月的最后一天" class="sidebar-link">156、获得当月的最后一天</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/13.VBA_function/#_157、四舍五入运算" class="sidebar-link">157、四舍五入运算</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/project/Excel/13.VBA_function/#_1-极小值修正法" class="sidebar-link heading3">1）极小值修正法</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/13.VBA_function/#_2-调用工作表函数法" class="sidebar-link heading3">2）调用工作表函数法</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/13.VBA_function/#_158、使用字符串函数" class="sidebar-link">158、使用字符串函数</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/13.VBA_function/#_159、使用日期函数" class="sidebar-link">159、使用日期函数</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/13.VBA_function/#_160、判断是否为数值" class="sidebar-link">160、判断是否为数值</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/13.VBA_function/#_161、格式化数值、日期和时间" class="sidebar-link">161、格式化数值、日期和时间</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/13.VBA_function/#_162、个人所得税自定义函数" class="sidebar-link">162、个人所得税自定义函数</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/13.VBA_function/#_163、人民币大写函数" class="sidebar-link">163、人民币大写函数</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/13.VBA_function/#_164、列号转换为列标" class="sidebar-link">164、列号转换为列标</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/13.VBA_function/#_165、判断工作表是否为空表" class="sidebar-link">165、判断工作表是否为空表</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/13.VBA_function/#_166、查找指定工作表" class="sidebar-link">166、查找指定工作表</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/13.VBA_function/#_167、查找指定工作簿是否打开" class="sidebar-link">167、查找指定工作簿是否打开</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/13.VBA_function/#_168、取得应用程序的安装路径" class="sidebar-link">168、取得应用程序的安装路径</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/13.VBA_function/#_169、数组的使用" class="sidebar-link">169、数组的使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/project/Excel/13.VBA_function/#_1-代码运行时创建数组" class="sidebar-link heading3">1）代码运行时创建数组</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/13.VBA_function/#_2-文本转换为数组" class="sidebar-link heading3">2）文本转换为数组</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/13.VBA_function/#_3-使用动态数组去除重复值" class="sidebar-link heading3">3）使用动态数组去除重复值</a></li></ul></li></ul></li><li><a href="/blog/project/Excel/14.VBA_fso/" class="sidebar-link">VBA 之 文件操作</a></li></ul></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav display="true" class="breadcrumb"><ol vocab="https://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a href="/blog/project/" property="item" typeof="WebPage" class="router-link-active"><i class="iconfont icon-folder"></i> <span property="name">项目主页</span></a> <meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem"><a href="/blog/project/Excel/" property="item" typeof="WebPage" class="router-link-active"><!----> <span property="name">Excel 笔记介绍</span></a> <meta property="position" content="2"></li><li property="itemListElement" typeof="ListItem" class="is-active"><a href="/blog/project/Excel/13.VBA_function/" aria-current="page" property="item" typeof="WebPage" class="router-link-exact-active router-link-active"><!----> <span property="name">VBA 之 函数的使用</span></a> <meta property="position" content="3"></li></ol></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">VBA 之 函数的使用</span></h1> <div class="page-info"><!----> <span aria-label="作者🖊" data-balloon-pos="down" categoryPath="/category/$category/" tagPath="/tag/$tag/"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon author-icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z" fill="currentColor"></path></svg> <span property="author">karin</span></span><span aria-label="访问量🔢" data-balloon-pos="down" defaultAuthor="karin" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="visitor-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon eye-icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 0 0-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z" fill="currentColor"></path></svg> <span id="/blog/project/Excel/13.VBA_function/" data-flag-title="VBA 之 函数的使用" class="leancloud_visitors waline-visitor-count"><span class="leancloud-visitors-count">...</span></span></span><span aria-label="写作日期📅" data-balloon-pos="down" defaultAuthor="karin" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2021-07-02 </span></span><!----><span aria-label="标签🏷" data-balloon-pos="down" defaultAuthor="karin" categoryPath="/category/$category/"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon tag-icon"><path d="M939.902 458.563 910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 0 0 0 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z" fill="currentColor"></path></svg> <ul class="tags-wrapper"><li class="tag clickable tag0"><span role="navigation">Excel</span></li></ul> <meta property="keywords" content="Excel"></span><span aria-label="阅读时间⌛" data-balloon-pos="down" defaultAuthor="karin" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>大约 35 分钟</span> <meta property="timeRequired" content="PT35M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/blog/project/Excel/13.VBA_function/#_153、调用工作表函数求和" class="anchor-link heading2"><div>153、调用工作表函数求和</div></a></li><li class="anchor"><a href="/blog/project/Excel/13.VBA_function/#_154、查找最大、最小值" class="anchor-link heading2"><div>154、查找最大、最小值</div></a></li><li class="anchor"><a href="/blog/project/Excel/13.VBA_function/#_155、不重复值的录入" class="anchor-link heading2"><div>155、不重复值的录入</div></a></li><li class="anchor"><a href="/blog/project/Excel/13.VBA_function/#_156、获得当月的最后一天" class="anchor-link heading2"><div>156、获得当月的最后一天</div></a></li><li class="anchor"><a href="/blog/project/Excel/13.VBA_function/#_157、四舍五入运算" class="anchor-link heading2"><div>157、四舍五入运算</div></a></li><li class="anchor"><a href="/blog/project/Excel/13.VBA_function/#_1-极小值修正法" class="anchor-link heading3"><div>1）极小值修正法</div></a></li><li class="anchor"><a href="/blog/project/Excel/13.VBA_function/#_2-调用工作表函数法" class="anchor-link heading3"><div>2）调用工作表函数法</div></a></li><li class="anchor"><a href="/blog/project/Excel/13.VBA_function/#_158、使用字符串函数" class="anchor-link heading2"><div>158、使用字符串函数</div></a></li><li class="anchor"><a href="/blog/project/Excel/13.VBA_function/#_159、使用日期函数" class="anchor-link heading2"><div>159、使用日期函数</div></a></li><li class="anchor"><a href="/blog/project/Excel/13.VBA_function/#_160、判断是否为数值" class="anchor-link heading2"><div>160、判断是否为数值</div></a></li><li class="anchor"><a href="/blog/project/Excel/13.VBA_function/#_161、格式化数值、日期和时间" class="anchor-link heading2"><div>161、格式化数值、日期和时间</div></a></li><li class="anchor"><a href="/blog/project/Excel/13.VBA_function/#_162、个人所得税自定义函数" class="anchor-link heading2"><div>162、个人所得税自定义函数</div></a></li><li class="anchor"><a href="/blog/project/Excel/13.VBA_function/#_163、人民币大写函数" class="anchor-link heading2"><div>163、人民币大写函数</div></a></li><li class="anchor"><a href="/blog/project/Excel/13.VBA_function/#_164、列号转换为列标" class="anchor-link heading2"><div>164、列号转换为列标</div></a></li><li class="anchor"><a href="/blog/project/Excel/13.VBA_function/#_165、判断工作表是否为空表" class="anchor-link heading2"><div>165、判断工作表是否为空表</div></a></li><li class="anchor"><a href="/blog/project/Excel/13.VBA_function/#_166、查找指定工作表" class="anchor-link heading2"><div>166、查找指定工作表</div></a></li><li class="anchor"><a href="/blog/project/Excel/13.VBA_function/#_167、查找指定工作簿是否打开" class="anchor-link heading2"><div>167、查找指定工作簿是否打开</div></a></li><li class="anchor"><a href="/blog/project/Excel/13.VBA_function/#_168、取得应用程序的安装路径" class="anchor-link heading2"><div>168、取得应用程序的安装路径</div></a></li><li class="anchor"><a href="/blog/project/Excel/13.VBA_function/#_169、数组的使用" class="anchor-link heading2"><div>169、数组的使用</div></a></li><li class="anchor"><a href="/blog/project/Excel/13.VBA_function/#_1-代码运行时创建数组" class="anchor-link heading3"><div>1）代码运行时创建数组</div></a></li><li class="anchor"><a href="/blog/project/Excel/13.VBA_function/#_2-文本转换为数组" class="anchor-link heading3"><div>2）文本转换为数组</div></a></li><li class="anchor"><a href="/blog/project/Excel/13.VBA_function/#_3-使用动态数组去除重复值" class="anchor-link heading3"><div>3）使用动态数组去除重复值</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h2 id="_153、调用工作表函数求和"><a href="#_153、调用工作表函数求和" class="header-anchor">#</a> 153、调用工作表函数求和</h2> <p>在对工作表的单元格区域进行求和计算时，使用工作表 Sum 函数比使用 VBA 代码遍历单元格进行累加求和效率要高得多，代码如下所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> rngSum<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> rng <span class="token keyword">As</span> Range
	<span class="token keyword">Dim</span> d <span class="token keyword">As</span> <span class="token keyword">Double</span>
	<span class="token keyword">Set</span> rng <span class="token operator">=</span> Range<span class="token punctuation">(</span><span class="token string">&quot;A1:F7&quot;</span><span class="token punctuation">)</span>
	d <span class="token operator">=</span> Application<span class="token punctuation">.</span>WorksheetFunction<span class="token punctuation">.</span>Sum<span class="token punctuation">(</span>rng<span class="token punctuation">)</span>
	MsgBox rng<span class="token punctuation">.</span>Address<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;单元格的和为&quot;</span> <span class="token operator">&amp;</span> d
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>代码解析：</p> <p>rngSum 过程调用工作表 Sum 函数对工作表的单元格区域进行求和计算。</p> <p>在 VBA 中调用工作表函数需要在工作表函数前加上 WorksheetFunction 属性。应用于 Application 对象的 WorksheetFunction 属性返回 WorksheetFunction 对象，作为 VBA 中调用工作表函数的容器，在实际应用中可省略 Application 对象识别符。</p> <h2 id="_154、查找最大、最小值"><a href="#_154、查找最大、最小值" class="header-anchor">#</a> 154、查找最大、最小值</h2> <p>在 VBA 中没有内置的函数可以进行最大、最小值的查找，借助工作表 Max、Min 函数可以快速地在工作表区域中查找最大、最小值，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> seeks<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> rng <span class="token keyword">As</span> Range
	<span class="token keyword">Dim</span> myRng <span class="token keyword">As</span> Range
	<span class="token keyword">Dim</span> k1 <span class="token keyword">As</span> <span class="token keyword">Integer</span><span class="token punctuation">,</span> k2 <span class="token keyword">As</span> <span class="token keyword">Integer</span>
	<span class="token keyword">Dim</span> max <span class="token keyword">As</span> <span class="token keyword">Double</span><span class="token punctuation">,</span> min <span class="token keyword">As</span> <span class="token keyword">Double</span>
	<span class="token keyword">Set</span> myRng <span class="token operator">=</span> Sheet1<span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;A1:F30&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">For</span> <span class="token keyword">Each</span> rng <span class="token keyword">In</span> myRng
		<span class="token keyword">If</span> rng<span class="token punctuation">.</span>Value <span class="token operator">=</span> WorksheetFunction<span class="token punctuation">.</span>max<span class="token punctuation">(</span>myRng<span class="token punctuation">)</span> <span class="token keyword">Then</span>
			rng<span class="token punctuation">.</span>Interior<span class="token punctuation">.</span>ColorIndex <span class="token operator">=</span> <span class="token number">3</span>
			k1 <span class="token operator">=</span> k1 <span class="token operator">+</span> <span class="token number">1</span>
			max <span class="token operator">=</span> rng<span class="token punctuation">.</span>Value
		<span class="token keyword">ElseIf</span> rng<span class="token punctuation">.</span>Value <span class="token operator">=</span> WorksheetFunction<span class="token punctuation">.</span>min<span class="token punctuation">(</span>myRng<span class="token punctuation">)</span> <span class="token keyword">Then</span>
			rng<span class="token punctuation">.</span>Interior<span class="token punctuation">.</span>ColorIndex <span class="token operator">=</span> <span class="token number">5</span>
			k2 <span class="token operator">=</span> k2 <span class="token operator">+</span> <span class="token number">1</span>
			min <span class="token operator">=</span> rng<span class="token punctuation">.</span>Value
		<span class="token keyword">Else</span>
			rng<span class="token punctuation">.</span>Interior<span class="token punctuation">.</span>ColorIndex <span class="token operator">=</span> <span class="token number">0</span>
		<span class="token keyword">End</span> <span class="token keyword">If</span>
	<span class="token keyword">Next</span>
	MsgBox <span class="token string">&quot;最大值是:&quot;</span> <span class="token operator">&amp;</span> max <span class="token operator">&amp;</span> <span class="token string">&quot;共有 &quot;</span> <span class="token operator">&amp;</span> k1 <span class="token operator">&amp;</span> <span class="token string">&quot;个&quot;</span> <span class="token operator">_</span>
		<span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;最小值是:&quot;</span> <span class="token operator">&amp;</span> min <span class="token operator">&amp;</span> <span class="token string">&quot;共有 &quot;</span> <span class="token operator">&amp;</span> k2 <span class="token operator">&amp;</span> <span class="token string">&quot;个&quot;</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>代码解析：</p> <p>seeks 过程在工作表单元格区域中查找最大、最小值，并将其所在的单元格底色分别设置为红色和蓝色。</p> <p>第 2 行到第 5 行代码声明变量类型。</p> <p>第 6 行代码使用关键字 Set 将单元格引用赋给变量 myRng。</p> <p>第 7 行到第 19 行代码遍历单元格区域，使用工作表 Max、Min 函数判断单元格数值是否是所在区域的最大、最小值，如果是，将其所在的单元格底色设置为红色或蓝色，并保存其数值和数量。</p> <p>第 20、21 行代码使用消息框显示最大、最小值数值和数量。</p> <p>运行 seeks 过程后将工作表区域最大、最小值所在的单元格的底色设置为红色或蓝色并用消息框显示其数值和数量，如图 154-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/154-1.85b83b74.png" alt="" loading="lazy"></p> <p><u>图 154-1</u>	查找最大、最小值</p></div> <h2 id="_155、不重复值的录入"><a href="#_155、不重复值的录入" class="header-anchor">#</a> 155、不重复值的录入</h2> <p>在工作表中录入数据时，有时希望能限制重复值的录入，比如在示例的 A 列单元格只能录入唯一的人员编号，此时可以利用工作表的 Change 事件结合工作表的 CountIf  函数来判断所录入的人员编号是否重复，示例代码如下。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Private</span> <span class="token keyword">Sub</span> Worksheet_Change<span class="token punctuation">(</span><span class="token keyword">ByVal</span> Target <span class="token keyword">As</span> Range<span class="token punctuation">)</span>
	<span class="token keyword">With</span> Target
		<span class="token keyword">If</span> <span class="token punctuation">.</span>Column <span class="token operator">&lt;</span><span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token keyword">Or</span> <span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token keyword">Then</span> <span class="token keyword">Exit</span> <span class="token keyword">Sub</span>
		<span class="token keyword">If</span> Application<span class="token punctuation">.</span>CountIf<span class="token punctuation">(</span>Range<span class="token punctuation">(</span><span class="token string">&quot;A:A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span>Value<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token keyword">Then</span>
			<span class="token punctuation">.</span><span class="token keyword">Select</span>
			MsgBox <span class="token string">&quot;不能输入重复的人员编号!&quot;</span><span class="token punctuation">,</span> <span class="token number">64</span>
			Application<span class="token punctuation">.</span>EnableEvents <span class="token operator">=</span> <span class="token boolean">False</span>
			<span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
			Application<span class="token punctuation">.</span>EnableEvents <span class="token operator">=</span> <span class="token boolean">True</span>
		<span class="token keyword">End</span> <span class="token keyword">If</span>
	<span class="token keyword">End</span> <span class="token keyword">With</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>代码解析：</p> <p>工作表的 Change 事件过程，使A列单元格只能录入唯一的人员编号。</p> <p>第 4 行代码使用工作表的 CountIf 函数来判断在A列单元格输入的人员编号是否重复。工作表的 CountIf 函数计算区域中满足给定条件的单元格的个数，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>COUNTIF<span class="token punctuation">(</span>range<span class="token punctuation">,</span> criteria<span class="token punctuation">)</span>

参数range为需要计算其中满足条件的单元格数目的单元格区域。
参数criteria为确定哪些单元格将被计算在内的条件，其形式可以为数字、表达式、单元格引用或文本。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在示例中以所录入的人员编号与A列单元格区域进行比较，如果 CountIf 函数的返回值大于 1，说明录入的是重复编号。</p> <p>第 5 行代码，重新选择该单元格便于下一步清空后重新录入。</p> <p>第 7、8、9 行代码，清除录入的重复编号，在清除前将 Application 对象的 EnableEvents 属性设置为 False，禁用事件。因为如果不禁用事件，那么在清除重复值的过程中会不断地触发工作表的 Change 事件，从而造成代码运行的死循环。</p> <p>经过以上的设置，在工作表的A列中只能录入唯一的人员编号，如果录入重复值会进行提示，如图 155-1 所示，点击确定后自动清除录入的重复编号。</p> <div class="custom-block center"><p><img src="/blog/assets/img/155-1.7e41e6bd.png" alt="" loading="lazy"></p> <p><u>图 155-1</u>	限制重复值的录入</p></div> <h2 id="_156、获得当月的最后一天"><a href="#_156、获得当月的最后一天" class="header-anchor">#</a> 156、获得当月的最后一天</h2> <p>在实际工作中经常需要根据给定的日期计算其所属月份的最后一天，此时可以使用 DateSerial 函数完成计算，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> Serial<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> DateStr <span class="token keyword">As</span> <span class="token keyword">Byte</span>
	DateStr <span class="token operator">=</span> Day<span class="token punctuation">(</span>DateSerial<span class="token punctuation">(</span>Year<span class="token punctuation">(</span><span class="token keyword">Date</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Month<span class="token punctuation">(</span><span class="token keyword">Date</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	MsgBox <span class="token string">&quot;本月的最后一天是&quot;</span> <span class="token operator">&amp;</span> Month<span class="token punctuation">(</span><span class="token keyword">Date</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;月&quot;</span> <span class="token operator">&amp;</span> DateStr <span class="token operator">&amp;</span> <span class="token string">&quot;号&quot;</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>代码解析：</p> <p>Serial 过程配合使用了 4 个 VBA 内置函数 Year、Month、Day 和 DateSerial 完成计算并使用消息框显示当月最后一天的日期。</p> <p>Year、Month 和 Day 函数分别返回代表指定日期的年、月、日的整数，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>Year<span class="token punctuation">(</span><span class="token keyword">Date</span><span class="token punctuation">)</span>
Month<span class="token punctuation">(</span><span class="token keyword">Date</span><span class="token punctuation">)</span>
Day<span class="token punctuation">(</span><span class="token keyword">Date</span><span class="token punctuation">)</span>

其中参数<span class="token keyword">Date</span>可以是任何能够表示日期的<span class="token keyword">Variant</span>、数值表达式、字符串表达式或它们的组合。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>DateSerial 函数返回包含指定的年、月、日的 Variant(Date)，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>DateSerial<span class="token punctuation">(</span>year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> day<span class="token punctuation">)</span>

其中参数year、 month、day分别表示指定的年、月、日。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>为了指定某个日期， DateSerial 函数中的每个参数的取值范围应该是可接受的，即日的取值范围应在 1-31 之间，而月的取值范围应在 1-12 之间。但是，当一个数值表达式表示某日之前或其后的年、月、日数时，也可以为每个使用这个数值表达式的参数指定相对日期。当任何一个参数的取值超出可接受的范围时，它会自动地在可接受的时间单位进行调整，例如本例中的 day 参数设置为 0，则被解释成 month 参数指定月的前一天，即表达式 Month(Date) + 1 指定的下一个月的前一天，也就是本月的最后一天。</p> <p>运行 Serial 过程结果如图 156-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/156-1.f271411f.png" alt="" loading="lazy"></p> <p><u>图 156-1</u>	获得当月的最后一天</p></div> <h2 id="_157、四舍五入运算"><a href="#_157、四舍五入运算" class="header-anchor">#</a> 157、四舍五入运算</h2> <p>在实际工作中经常需要对数值或计算结果进行四舍五入运算，此时可以使用 VBA 内置的 Round 函数。Round 函数返回一个数值，该数值是按照指定的小数位数进行四舍五入运算的结果，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>Round<span class="token punctuation">(</span>expression [<span class="token punctuation">,</span>numdecimalplaces]<span class="token punctuation">)</span>

参数expression是必需的，要进行四舍五入运算的数值表达式。
参数numdecimalplaces是可选的，数字值，表示进行四舍五入运算时，小数点右边应保留的位数。如果忽略，则Round函数返回整数。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>但是 VBA 内置的 Round 函数在对数值进行四舍五入运算时实行的是 Bankre 舍入，而不是算术舍入。按 Bankre 舍入规则，如果保留位数的下一个数字正好是 5 则其后没有其他有效数字，则按保留位最后一位“偶舍奇入”的方法进行处理。比如 Round(1.5) 的保留位最后为 1，是奇数，小数位的 5 入上去，因此 Round(1.5) 的运算结果是 2；而 Round(4.5) 的保留位最后为 4，是偶数，小数位的 5 舍去，因此 Round(4.5) 的运算结果是 4 而不是 5。</p> <p>Bankre 舍入规则虽然有其合理性，但不符合实际工作的需要。在实际应用中使用以下两种方法避免 Bankre 舍入：</p> <h3 id="_1-极小值修正法"><a href="#_1-极小值修正法" class="header-anchor">#</a> 1）极小值修正法</h3> <p>在使用 Round 函数时对需要舍入的数值先加上极小值再调用 VBA 内置的 Round 函数，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> aTestRound<span class="token punctuation">(</span><span class="token punctuation">)</span>
	MsgBox <span class="token string">&quot;Round(4.5)=&quot;</span> <span class="token operator">&amp;</span> Round<span class="token punctuation">(</span><span class="token number">4.5</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;Round(4.5)=&quot;</span> <span class="token operator">&amp;</span> Round<span class="token punctuation">(</span><span class="token number">4.5</span> <span class="token operator">+</span> <span class="token number">0.0000001</span><span class="token punctuation">)</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>代码解析：</p> <p>aTestRound 过程分别调用 VBA 内置的 Round 函数和加上极小值再调用 VBA 内置的 Round 函数在洗染店框中显示两者运算结果，如图 157-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/157-1.78dab1d6.png" alt="" loading="lazy"></p> <p><u>图 157-1</u>	加上极小值进行运算结果</p></div> <p>从运算结果中可以发现，加上极小值后 Round(4.5) 已正确运算为 5 而不是 4。</p> <h3 id="_2-调用工作表函数法"><a href="#_2-调用工作表函数法" class="header-anchor">#</a> 2）调用工作表函数法</h3> <p>还可以使用工作表函数 Round 代替 VBA 内置的 Round 函数。工作表函数 Round 和 VBA 内置的 Round 函数的用法相同，但它采用算术舍入而不是 Bankre 舍入，所以不会有“偶舍奇入”的问题，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> bTestRound<span class="token punctuation">(</span><span class="token punctuation">)</span>
	MsgBox <span class="token string">&quot;Round(4.5)=&quot;</span> <span class="token operator">&amp;</span> Round<span class="token punctuation">(</span><span class="token number">4.5</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;Round(4.5)=&quot;</span> <span class="token operator">&amp;</span> Application<span class="token punctuation">.</span>Round<span class="token punctuation">(</span><span class="token number">4.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>代码解析：</p> <p>bTestRound 过程分别调用 VBA 内置的 Round 函数和工作表 Round 函数在消息框中显示两者运算结果，如图 157-2 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/157-2.78dab1d6.png" alt="" loading="lazy"></p> <p><u>图 157-2</u>	工作表函数运算结果</p></div> <p>从运算结果中可以发现，使用工作表 Round 函数后 Round(4.5) 已正确运算为 5 而不是 4。</p> <h2 id="_158、使用字符串函数"><a href="#_158、使用字符串函数" class="header-anchor">#</a> 158、使用字符串函数</h2> <p>使用 VBA 的字符串函数可以对字符串进行各种操作，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> StrFunctions<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> Str <span class="token keyword">As</span> <span class="token keyword">String</span>
	Str <span class="token operator">=</span> <span class="token string">&quot;AbcD EFG hijk Lmn&quot;</span>
	MsgBox <span class="token string">&quot;原始字符串为：&quot;</span> <span class="token operator">&amp;</span> Str <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">_</span>
		<span class="token operator">&amp;</span> <span class="token string">&quot;字符串长度为：&quot;</span> <span class="token operator">&amp;</span> Len<span class="token punctuation">(</span>Str<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">_</span>
		<span class="token operator">&amp;</span> <span class="token string">&quot;左边8个字符为：&quot;</span> <span class="token operator">&amp;</span> Left<span class="token punctuation">(</span>Str<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">_</span>
		<span class="token operator">&amp;</span> <span class="token string">&quot;右边6个字符为：&quot;</span> <span class="token operator">&amp;</span> Right<span class="token punctuation">(</span>Str<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">_</span>
		<span class="token operator">&amp;</span> <span class="token string">&quot;从左边第2个开始取5个字符为：&quot;</span> <span class="token operator">&amp;</span> Mid<span class="token punctuation">(</span>Str<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">_</span>
		<span class="token operator">&amp;</span> <span class="token string">&quot;转换为大写：&quot;</span> <span class="token operator">&amp;</span> UCase<span class="token punctuation">(</span>Str<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">_</span>
		<span class="token operator">&amp;</span> <span class="token string">&quot;转换为小写：&quot;</span> <span class="token operator">&amp;</span> LCase<span class="token punctuation">(</span>Str<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>代码解析：</p> <p>StrFunctions 过程使用字符串函数对字符串进行各种操作，如计算字符数、取得一定数量的字符、大小写转换等。</p> <p>第 5 行代码使用 Len 函数返回字符串内字符的数目，Len 函数语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>Len<span class="token punctuation">(</span><span class="token keyword">string</span> | varname<span class="token punctuation">)</span>

参数<span class="token keyword">string</span>为任何有效的字符串表达式。
参数varname为任何有效的变量名称。
两个可能的参数必须有一个，而且只能有一个参数。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>第 6 行代码使用 Left 函数从字符串左边起返回 8 个字符。</p> <p>第 7 行代码使用 Right 函数从字符串右边起返回 6 个字符</p> <p>Left 和 rigth 函数语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>Left<span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span>
Right<span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span>

参数<span class="token keyword">string</span>是必需的，字符串表达式。
参数length是必需的，数值表达式，将返回的字符数量。如果为<span class="token number">0</span>，返回零长度字符串 <span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>；如果大于或等于参数<span class="token keyword">string</span>的字符数，则返回整个字符串
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>第 8 行代码使用 Mid 函数从字符串第 2 位起返回 5 个字符。Mid 函数语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>Mid<span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">,</span> start[<span class="token punctuation">,</span> length]<span class="token punctuation">)</span>

参数<span class="token keyword">string</span>是必需的，字符串表达式。
参数start是必需的，<span class="token keyword">string</span>中被取出部分的字符位置。如果超过<span class="token keyword">string</span>的字符数，将返回零长度字符串 <span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>。
参数length是可选的，要返回的字符数。如果省略或超过<span class="token keyword">string</span>的字符数，将返回字符串中所有字符。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>第 9 行代码使用 UCase 函数将字符串转换成大写的字符串。</p> <p>第 10 行代码使用 LCase 函数将字符串转换成小写的字符串。</p> <p>UCase 和 LCase 函数的语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>UCase<span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">)</span>
LCase<span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">)</span>

参数<span class="token keyword">string</span>是必需的，任何有效的字符串表达式。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>运行 StrFunctions 过程结果如图 158-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/158-1.39bbe7c8.png" alt="" loading="lazy"></p> <p><u>图 158-1</u>	使用字符串函数</p></div> <h2 id="_159、使用日期函数"><a href="#_159、使用日期函数" class="header-anchor">#</a> 159、使用日期函数</h2> <p>使用 VBA 的日期函数可以对日期进行各种计算，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> DatFunctions<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> Str <span class="token keyword">As</span> <span class="token keyword">String</span>
	<span class="token keyword">Dim</span> Week <span class="token keyword">As</span> <span class="token keyword">String</span>
	Str <span class="token operator">=</span> InputBox<span class="token punctuation">(</span><span class="token string">&quot;请输入日期：&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">If</span> Len<span class="token punctuation">(</span>Str<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">Then</span>
		<span class="token keyword">If</span> IsDate<span class="token punctuation">(</span>Str<span class="token punctuation">)</span> <span class="token keyword">Then</span>
			<span class="token keyword">Select</span> <span class="token keyword">Case</span> Weekday<span class="token punctuation">(</span>Str<span class="token punctuation">,</span> vbMonday<span class="token punctuation">)</span>
				<span class="token keyword">Case</span> <span class="token number">1</span>
					Week <span class="token operator">=</span> <span class="token string">&quot;一&quot;</span>
				<span class="token keyword">Case</span> <span class="token number">2</span>
					Week <span class="token operator">=</span> <span class="token string">&quot;二&quot;</span>
				<span class="token keyword">Case</span> <span class="token number">3</span>
					Week <span class="token operator">=</span> <span class="token string">&quot;三&quot;</span>
				<span class="token keyword">Case</span> <span class="token number">4</span>
					Week <span class="token operator">=</span> <span class="token string">&quot;四&quot;</span>
				<span class="token keyword">Case</span> <span class="token number">5</span>
					Week <span class="token operator">=</span> <span class="token string">&quot;五&quot;</span>
				<span class="token keyword">Case</span> <span class="token number">6</span>
					Week <span class="token operator">=</span> <span class="token string">&quot;六&quot;</span>
				<span class="token keyword">Case</span> <span class="token number">7</span>
					Week <span class="token operator">=</span> <span class="token string">&quot;日&quot;</span>
			<span class="token keyword">End</span> <span class="token keyword">Select</span>
			MsgBox <span class="token string">&quot;你输入的日期是&quot;</span> <span class="token operator">&amp;</span> DateValue<span class="token punctuation">(</span>Str<span class="token punctuation">)</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">_</span>
				<span class="token operator">&amp;</span> <span class="token string">&quot;是&quot;</span> <span class="token operator">&amp;</span> Year<span class="token punctuation">(</span>Str<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;年的第&quot;</span> <span class="token operator">&amp;</span> DatePart<span class="token punctuation">(</span><span class="token string">&quot;q&quot;</span><span class="token punctuation">,</span> Str<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;季度&quot;</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">_</span>
				<span class="token operator">&amp;</span> <span class="token string">&quot;是星期&quot;</span> <span class="token operator">&amp;</span> Week <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">_</span>
				<span class="token operator">&amp;</span> <span class="token string">&quot;距离今天有&quot;</span> <span class="token operator">&amp;</span> Abs<span class="token punctuation">(</span>DateDiff<span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span> <span class="token keyword">Date</span><span class="token punctuation">,</span> Str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;天&quot;</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">_</span>
				<span class="token operator">&amp;</span> <span class="token string">&quot;60天后的日期是&quot;</span> <span class="token operator">&amp;</span> DateAdd<span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> Str<span class="token punctuation">)</span>
		<span class="token keyword">Else</span>
			MsgBox <span class="token string">&quot;请输入正确格式的日期!&quot;</span>
		<span class="token keyword">End</span> <span class="token keyword">If</span>
	<span class="token keyword">End</span> <span class="token keyword">If</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>代码解析：</p> <p>DatFunctions 过程在对话框中输入日期后使用各种日期函数对其进行计算并用消息框显示。</p> <p>第 4、5 行代码使用 InputBox 函数显示一个对话框，供用户在对话框中输入一个日期。</p> <p>第 6 行代码使用 IsDate 函数判断输入的日期是否正确。IsDate 函数返回 Boolean 值，指出一个表达式是否可以转换成日期，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>IsDate<span class="token punctuation">(</span>expression<span class="token punctuation">)</span>

参数expression是必需的，日期表达式或字符串表达式，如果表达式是一个日期，或者可以作为有效日期识别，则IsDate函数返回<span class="token boolean">True</span>，否则返回<span class="token boolean">False</span>。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>第 7 行到第 22 行代码使用 Weekday 函数判断所输入的日期是星期几。Weekday 函数返回一个整数，代表某个日期是星期几，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>Weekday<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">,</span> [firstdayofweek]<span class="token punctuation">)</span>

参数<span class="token keyword">date</span>是必需的，能够表示日期的 <span class="token keyword">Variant</span>、数值表达式、字符串表达式或它们的组合。
参数firstdayofweek是可选的，指定一星期第一天的常数，如表格 <span class="token number">159</span><span class="token operator">-</span><span class="token number">1</span>所示。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><u>表格 159-1</u>	firstdayofweek 参数值</p> <table><thead><tr><th>常数</th> <th>值</th> <th>描述</th></tr></thead> <tbody><tr><td>vbUseSystem</td> <td>0</td> <td>使用 NLS API 设置</td></tr> <tr><td>VbSunday</td> <td>1</td> <td>星期日（缺省值）</td></tr> <tr><td>vbMonday</td> <td>2</td> <td>星期一</td></tr> <tr><td>vbTuesday</td> <td>3</td> <td>星期二</td></tr> <tr><td>vbWednesday</td> <td>4</td> <td>星期三</td></tr> <tr><td>vbThursday</td> <td>5</td> <td>星期四</td></tr> <tr><td>vbFriday</td> <td>6</td> <td>星期五</td></tr> <tr><td>vbSaturday</td> <td>7</td> <td>星期六</td></tr></tbody></table> <p>Weekday 函数返回一个 1 到 7 之间的整数，当 firstdayofweek 参数设置为 vbMonday（2）时，返回 1 时说明是星期一，以此类推。</p> <p>第 23 行代码根据系统中指定的短日期格式来显示所输入的日期。DateValue 函数的语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>DateValue<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">)</span>

参数<span class="token keyword">date</span>是必需的，任何表达式，表示从 <span class="token number">100</span> 年 <span class="token number">1</span> 月 <span class="token number">1</span> 日到 <span class="token number">9999</span> 年 <span class="token number">12</span> 月 <span class="token number">31</span> 日之间的一个日期。如果是一个字符串，且其内容只有数字以及分隔数字的日期分隔符，则 DateValue函数就会根据系统中指定的短日期格式来识别月、日、年的顺序。DateValue函数也识别明确的英文月份名称，全名或缩写均可。例如，除了<span class="token number">12</span><span class="token operator">/</span><span class="token number">30</span><span class="token operator">/</span><span class="token number">1991</span> 和<span class="token number">12</span><span class="token operator">/</span><span class="token number">30</span><span class="token operator">/</span><span class="token number">91</span> 之外，DateValue函数也能识别December <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">1991</span> 和Dec <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">1991</span>。

如果<span class="token keyword">date</span>参数中略去了年这一部分，DateValue函数就会使用由计算机系统日期设置的当前年份。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>第 24 行代码判断输入的日期的季度。DatePart 函数返回一个包含已知日期的指定时间部分的值，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>DatePart<span class="token punctuation">(</span>interval<span class="token punctuation">,</span> <span class="token keyword">date</span>[<span class="token punctuation">,</span>firstdayofweek[<span class="token punctuation">,</span> firstweekofyear]]<span class="token punctuation">)</span>

其中参数interval是必需的，字符串表达式，是要返回的时间间隔，设定值如表格 <span class="token number">159</span><span class="token operator">-</span><span class="token number">2</span>所示。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><u>表格 159-2</u>	interval 参数设定值</p> <table><thead><tr><th>设置</th> <th>说明</th></tr></thead> <tbody><tr><td>yyyy</td> <td>年</td></tr> <tr><td>q</td> <td>季</td></tr> <tr><td>m</td> <td>日</td></tr> <tr><td>y</td> <td>一年的日数</td></tr> <tr><td>d</td> <td>日</td></tr> <tr><td>w</td> <td>一周的日数</td></tr> <tr><td>ww</td> <td>周</td></tr> <tr><td>h</td> <td>时</td></tr> <tr><td>n</td> <td>分钟</td></tr> <tr><td>s</td> <td>秒</td></tr></tbody></table> <p>第 26 行代码计算所输入的日期距当天的天数。DateDiff 函数返回两个指定日期间的时间间隔数目，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>DateDiff<span class="token punctuation">(</span>interval<span class="token punctuation">,</span> date1<span class="token punctuation">,</span> date2[<span class="token punctuation">,</span> firstdayofweek[<span class="token punctuation">,</span> firstweekofyear]]<span class="token punctuation">)</span>

其中参数interval是必需的，字符串表达式，表示用来计算date1和date2的时间差的时间间隔，设定值如表格 <span class="token number">159</span><span class="token number">2</span>所示。
参数date1和date2是必需的，计算中要用到的两个日期。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>因为如果输入的日期是当前日期以前的日期，DateDiff 函数会返回负值，所以使用 Abs 函数返回绝对值将其转换为正值。</p> <p>第 27 行代码计算所输入的日期距当天的天数，DateAdd 返回加上了一段时间间隔的一个日期，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>DateAdd<span class="token punctuation">(</span>interval<span class="token punctuation">,</span> number<span class="token punctuation">,</span> <span class="token keyword">date</span><span class="token punctuation">)</span>

参数interval是必需的，字符串表达式，是所要加上去的时间间隔，设定值如表格 <span class="token number">159</span><span class="token operator">-</span><span class="token number">2</span>所示。
参数number是必需的，是要加上的时间间隔的数目。其数值可以为正数（得到未来的日期），也可以为负数（得到过去的日期）。
参数<span class="token keyword">date</span>是必需的，需要加上时间间隔的字符串表达式。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>运行 DatFunctions 过程，在显示的对话框中输入一个日期，结果如图 159-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/159-1.51855b5e.png" alt="" loading="lazy"></p> <p><u>图 159-1</u>	使用日期函数</p></div> <h2 id="_160、判断是否为数值"><a href="#_160、判断是否为数值" class="header-anchor">#</a> 160、判断是否为数值</h2> <p>使用 IsNumeric 函数可以判断表达式的运算结果是否为数值，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> Numeric<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> i <span class="token keyword">As</span> <span class="token keyword">Integer</span>
	<span class="token keyword">Dim</span> n <span class="token keyword">As</span> <span class="token keyword">String</span>
	<span class="token keyword">Dim</span> s <span class="token keyword">As</span> <span class="token keyword">String</span>
	<span class="token keyword">With</span> Sheet1
		<span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">To</span> <span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;A65536&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">End</span><span class="token punctuation">(</span>xlUp<span class="token punctuation">)</span><span class="token punctuation">.</span>Row
			<span class="token keyword">If</span> IsNumeric<span class="token punctuation">(</span><span class="token punctuation">.</span>Cells<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">Then</span>
				n <span class="token operator">=</span> n <span class="token operator">&amp;</span> <span class="token punctuation">.</span>Cells<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Address<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">.</span>Cells<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span>
			<span class="token keyword">Else</span>
				s <span class="token operator">=</span> s <span class="token operator">&amp;</span> <span class="token punctuation">.</span>Cells<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Address<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">.</span>Cells<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span>
			<span class="token keyword">End</span> <span class="token keyword">If</span>
		<span class="token keyword">Next</span>
	<span class="token keyword">End</span> <span class="token keyword">With</span>
	MsgBox <span class="token string">&quot;A列中数值单元格：&quot;</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> n <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">_</span>
		<span class="token operator">&amp;</span> <span class="token string">&quot;A列中非数值单元格：&quot;</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> s
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>代码解析：</p> <p>Numeric 过程使用 IsNumeric 函数判断工作表的A列单元格是否为数值，并使用消息框显示。</p> <p>第 7 行代码判断工作表的 A 列单元格是否为数值。IsNumeric 函数返回 Boolean 值，指出表达式的运算结果是否为数，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>IsNumeric<span class="token punctuation">(</span>expression<span class="token punctuation">)</span>

参数expression是必需的，<span class="token keyword">Variant</span>类型，包含数值表达式或字符串表达式。
如果参数expression的运算结果为数字，则IsNumeric返回<span class="token boolean">True</span>，否则返回<span class="token boolean">False</span>。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>第 8 行代码将数值单元格的地址和数值保存在变量 e 中。</p> <p>第 10 行代码将非数值单元格的地址和内容保存在变量 s 中。在保存时插入制表符对数据列进行分隔，使之排列整齐，请参阅 73-5。</p> <p>运行 Numeric 过程结果如图 160-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/160-1.723adae7.png" alt="" loading="lazy"></p> <p><u>图 160-1</u>	判断是否为数值</p></div> <h2 id="_161、格式化数值、日期和时间"><a href="#_161、格式化数值、日期和时间" class="header-anchor">#</a> 161、格式化数值、日期和时间</h2> <p>Format 函数是 VBA 中的常用函数，可以实现数值、日期和时间格式的转变，示例代码如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> FromatCurrent<span class="token punctuation">(</span><span class="token punctuation">)</span>
	MsgBox Format<span class="token punctuation">(</span><span class="token number">123456.789</span><span class="token punctuation">,</span> <span class="token string">&quot;0.00&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">_</span>
		<span class="token operator">&amp;</span> Format<span class="token punctuation">(</span><span class="token number">123456.789</span><span class="token punctuation">,</span> <span class="token string">&quot;0.00%&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">_</span>
		<span class="token operator">&amp;</span> Format<span class="token punctuation">(</span><span class="token number">123456.789</span><span class="token punctuation">,</span> <span class="token string">&quot;##,##0.00&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">_</span>
		<span class="token operator">&amp;</span> Format<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">123456.789</span><span class="token punctuation">,</span> <span class="token string">&quot;$#,##0.00;($#,##0.00)&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">_</span>
		<span class="token operator">&amp;</span> Format<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">123456.789</span><span class="token punctuation">,</span> <span class="token string">&quot;￥#,##0.00;(￥#,##0.00)&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">_</span>
		<span class="token operator">&amp;</span> Format<span class="token punctuation">(</span><span class="token keyword">Date</span><span class="token punctuation">,</span> <span class="token string">&quot;yyyy-mm-dd&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">_</span>
		<span class="token operator">&amp;</span> Format<span class="token punctuation">(</span><span class="token keyword">Date</span><span class="token punctuation">,</span> <span class="token string">&quot;yyyymmdd&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">_</span>
		<span class="token operator">&amp;</span> Format<span class="token punctuation">(</span><span class="token keyword">Date</span><span class="token punctuation">,</span> <span class="token string">&quot;Long Date&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">_</span>
		<span class="token operator">&amp;</span> Format<span class="token punctuation">(</span>Now<span class="token punctuation">,</span> <span class="token string">&quot;hh:mm:ss&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Chr<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">_</span>
		<span class="token operator">&amp;</span> Format<span class="token punctuation">(</span>Now<span class="token punctuation">,</span> <span class="token string">&quot;hh:mm:ss AMPM&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>代码解析：</p> <p>FromatCurrent 过程使用消息框显示格式化后的数值、日期和时间。</p> <p>Format 函数根据格式表达式中的指令来格式化的数值、日期和时间，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>Format<span class="token punctuation">(</span>expression[<span class="token punctuation">,</span> format[<span class="token punctuation">,</span> firstdayofweek[<span class="token punctuation">,</span> firstweekofyear]]]<span class="token punctuation">)</span>

其中参数expression是必需的，任何有效的表达式。
参数format是可选的，有效的命名表达式或用户自定义格式表达式。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>第 2 行代码将数值格式化为两位小数格式显示。</p> <p>第 3 行代码将数值格式化为两位小数的百分比格式显示。</p> <p>第 4 行代码将数值格式化为千位分隔符显示。</p> <p>第 5 行代码将数值格式化为以美元符号显示的两位小数，以千位分隔符分隔，如果是负值则以小括号显示。</p> <p>第 6 行代码将数值格式化为以人民币符号显示的两位小数，以千位分隔符分隔，如果是负值则以小括号显示。</p> <p>第 7 行代码将系统日期格式化为“yyyy-mm-dd”格式显示。</p> <p>第 8 行代码将系统日期格式化为“yyyymmdd”格式显示。</p> <p>第 9 行代码将系统日期格式化为长日期格式显示。</p> <p>第 10 行代码将系统时间格式化为 24 小时、分钟和秒的格式显示。</p> <p>第 11 行代码将系统时间格式化为分 12 小时、分钟和秒的格式显示。</p> <p>运行 FromatCurrent 过程结果如图 161-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/161-1.7053ad96.png" alt="" loading="lazy"></p> <p><u>图 161-1</u>	格式化数值、日期和时间</p></div> <h2 id="_162、个人所得税自定义函数"><a href="#_162、个人所得税自定义函数" class="header-anchor">#</a> 162、个人所得税自定义函数</h2> <p>在财务工作中经常需要计算个人所得税，而在 Excel 中没有计算个人所得税的函数，此时可以使用自定义函数来计算，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Public</span> <span class="token keyword">Function</span> PITax<span class="token punctuation">(</span>Income<span class="token punctuation">,</span> <span class="token keyword">Optional</span> Threshold<span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Single</span>
	<span class="token keyword">Dim</span> Rate <span class="token keyword">As</span> <span class="token keyword">Single</span>
	<span class="token keyword">Dim</span> Debit <span class="token keyword">As</span> <span class="token keyword">Single</span>
	<span class="token keyword">Dim</span> Taxliability <span class="token keyword">As</span> <span class="token keyword">Single</span>
	<span class="token keyword">If</span> IsMissing<span class="token punctuation">(</span>Threshold<span class="token punctuation">)</span> <span class="token keyword">Then</span> Threshold <span class="token operator">=</span> <span class="token number">2000</span>
	Taxliability <span class="token operator">=</span> Income <span class="token operator">-</span> Threshold
	<span class="token keyword">Select</span> <span class="token keyword">Case</span> Taxliability
		<span class="token keyword">Case</span> <span class="token number">0</span> <span class="token keyword">To</span> <span class="token number">500</span>
			Rate <span class="token operator">=</span> <span class="token number">0.05</span>
			Debit <span class="token operator">=</span> <span class="token number">0</span>
		<span class="token keyword">Case</span> <span class="token number">500.01</span> <span class="token keyword">To</span> <span class="token number">2000</span>
			Rate <span class="token operator">=</span> <span class="token number">0.1</span>
			Debit <span class="token operator">=</span> <span class="token number">25</span>
		<span class="token keyword">Case</span> <span class="token number">2000.01</span> <span class="token keyword">To</span> <span class="token number">5000</span>
			Rate <span class="token operator">=</span> <span class="token number">0.15</span>
			Debit <span class="token operator">=</span> <span class="token number">125</span>
		<span class="token keyword">Case</span> <span class="token number">5000.01</span> <span class="token keyword">To</span> <span class="token number">20000</span>
			Rate <span class="token operator">=</span> <span class="token number">0.2</span>
			Debit <span class="token operator">=</span> <span class="token number">375</span>
		<span class="token keyword">Case</span> <span class="token number">20000.01</span> <span class="token keyword">To</span> <span class="token number">40000</span>
			Rate <span class="token operator">=</span> <span class="token number">0.25</span>
			Debit <span class="token operator">=</span> <span class="token number">1375</span>
		<span class="token keyword">Case</span> <span class="token number">40000.01</span> <span class="token keyword">To</span> <span class="token number">60000</span>
			Rate <span class="token operator">=</span> <span class="token number">0.3</span>
			Debit <span class="token operator">=</span> <span class="token number">3375</span>
		<span class="token keyword">Case</span> <span class="token number">60000.01</span> <span class="token keyword">To</span> <span class="token number">80000</span>
			Rate <span class="token operator">=</span> <span class="token number">0.35</span>
			Debit <span class="token operator">=</span> <span class="token number">6375</span>
		<span class="token keyword">Case</span> <span class="token number">80000.01</span> <span class="token keyword">To</span> <span class="token number">10000</span>
			Rate <span class="token operator">=</span> <span class="token number">0.4</span>
			Debit <span class="token operator">=</span> <span class="token number">10375</span>
		<span class="token keyword">Case</span> <span class="token keyword">Else</span>
			Rate <span class="token operator">=</span> <span class="token number">0.45</span>
			Debit <span class="token operator">=</span> <span class="token number">15375</span>
	<span class="token keyword">End</span> <span class="token keyword">Select</span>
	<span class="token keyword">If</span> Taxliability <span class="token operator">&lt;</span><span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">Then</span>
		PITax <span class="token operator">=</span> <span class="token number">0</span>
	<span class="token keyword">Else</span>
		PITax <span class="token operator">=</span> Application<span class="token punctuation">.</span>Round<span class="token punctuation">(</span>Taxliability <span class="token operator">*</span> Rate <span class="token operator">-</span> Debit<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
	<span class="token keyword">End</span> <span class="token keyword">If</span>
<span class="token keyword">End</span> <span class="token keyword">Function</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>代码解析：</p> <p>自定义 PITax 函数根据应纳税额计算应纳的个人所得税额。</p> <p>第 5 行代码设置个人所得税的起征点为 2000 元，如果以后需要调整起征点，可把 2000 元改为调整后的起征点。</p> <p>第 6 行代码设置全月应纳税所得额等于应纳税收入减去起征点。</p> <p>第 7 行到第 35 行代码根据全月应纳税所得额取得税率和速算扣除数。税率和速算扣除数根据如表格 162-1 所示的工资、薪金所得适用个人所得税九级超额累进税率表计算。</p> <p><u>表格 162-1</u>	个人所得税九级超额累进税率表</p> <table><thead><tr><th>级数</th> <th>全月应纳税所得额（含税所得额）</th> <th>税率%</th> <th>速算扣除数（元）</th></tr></thead> <tbody><tr><td>一</td> <td>不超过500元</td> <td>5</td> <td>0</td></tr> <tr><td>二</td> <td>超过500元至2000元</td> <td>10</td> <td>25</td></tr> <tr><td>三</td> <td>超过2000元至5000元</td> <td>15</td> <td>125</td></tr> <tr><td>四</td> <td>超过5000元至20000元</td> <td>20</td> <td>375</td></tr> <tr><td>五</td> <td>超过20000元至40000元</td> <td>25</td> <td>1375</td></tr> <tr><td>六</td> <td>超过40000元至60000元</td> <td>30</td> <td>3375</td></tr> <tr><td>七</td> <td>超过60000元至80000元</td> <td>35</td> <td>6375</td></tr> <tr><td>八</td> <td>超过80000元至100000元</td> <td>40</td> <td>10375</td></tr> <tr><td>九</td> <td>超过100000元</td> <td>45</td> <td>15375</td></tr></tbody></table> <p>第 36 行到第 40 行代码根据应纳税所得额、税率和速算扣除数计算应纳的个人所得税额。其中第 39 行代码中使用工作表函数 Round 对计算结果进行四舍五入运算，请参阅 157-2。</p> <p>在工作表中使用自定义 PITax 函数结果如图 162-1 所示。</p> <div class="custom-block center"><p><img src="data:image/png;base64,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" alt="" loading="lazy"></p> <p><u>图 162-1</u>	工作表中使用自定义 PITax 函数</p></div> <h2 id="_163、人民币大写函数"><a href="#_163、人民币大写函数" class="header-anchor">#</a> 163、人民币大写函数</h2> <p>在 VBA 中没有内置的函数进行人民币大写转换，此时可以编写自定义函数进行人民币大写转换，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Public</span> <span class="token keyword">Function</span> RMBDX<span class="token punctuation">(</span>M<span class="token punctuation">)</span>
	RMBDX <span class="token operator">=</span> Replace<span class="token punctuation">(</span>Application<span class="token punctuation">.</span>Text<span class="token punctuation">(</span>Round<span class="token punctuation">(</span>M <span class="token operator">+</span> <span class="token number">0.00000001</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;[DBnum2]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;元&quot;</span><span class="token punctuation">)</span>
	RMBDX <span class="token operator">=</span> IIf<span class="token punctuation">(</span>Left<span class="token punctuation">(</span>Right<span class="token punctuation">(</span>RMBDX<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;元&quot;</span><span class="token punctuation">,</span> Left<span class="token punctuation">(</span>RMBDX<span class="token punctuation">,</span> Len<span class="token punctuation">(</span>RMBDX<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;角&quot;</span> <span class="token operator">&amp;</span> Right<span class="token punctuation">(</span>RMBDX<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">&quot;分&quot;</span><span class="token punctuation">,</span> IIf<span class="token punctuation">(</span>Left<span class="token punctuation">(</span>Right<span class="token punctuation">(</span>RMBDX<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;元&quot;</span><span class="token punctuation">,</span> RMBDX <span class="token operator">&amp;</span> <span class="token string">&quot;角整&quot;</span><span class="token punctuation">,</span> IIf<span class="token punctuation">(</span>RMBDX <span class="token operator">=</span> <span class="token string">&quot;零&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> RMBDX <span class="token operator">&amp;</span> <span class="token string">&quot;元整&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	RMBDX <span class="token operator">=</span> Replace<span class="token punctuation">(</span>Replace<span class="token punctuation">(</span>Replace<span class="token punctuation">(</span>Replace<span class="token punctuation">(</span>RMBDX<span class="token punctuation">,</span> <span class="token string">&quot;零元零角&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;零元&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;零角&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;零&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;-&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;负&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">End</span> <span class="token keyword">Function</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>代码解析：</p> <p>第 2 行代码首先使用 Round 函数对小写数字加上极小值后进行四舍五入运算，关于 Round 函数请参阅 157-1。其次使用工作表 Text 函数将数值转换成人民币大写格式表示的文本。Text 函数将数值转换为按指定数字格式表示的文本，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>TEXT<span class="token punctuation">(</span>value<span class="token punctuation">,</span>format_text<span class="token punctuation">)</span>

Value参数为数值、计算结果为数值的公式，或对包含数值的单元格的引用。
Format_text参数为<span class="token string">“单元格格式“</span>对话框中<span class="token string">”数字“</span>选项卡上”分类框中的文本形式的数字格式。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>最后使用 Replace 函数将人民币大写格式表示的文本中的小数点替换成“元”。 Replace 函数返回一个字符串，该字符串中指定的子字符串已被替换成另一子字符串，并且替换发生的次数也是指定的，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>Replace<span class="token punctuation">(</span>expression<span class="token punctuation">,</span> find<span class="token punctuation">,</span> replace[<span class="token punctuation">,</span> start[<span class="token punctuation">,</span> count[<span class="token punctuation">,</span> compare]]]<span class="token punctuation">)</span>

其中参数expression是必需的，包含要替换的子字符串。
参数find是必需的，要搜索到的子字符串。
参数replace是必需的，用来替换的子字符串。
参数start是可选的，在表达式中子字符串搜索的开始位置。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>第 3 行代码使用了 IIF 函数、Left 函数、Right 函数根据第 2 行代码返回的人民币大写格式表示的文本中的“元”的位置在文本中插入正确的“元”、“角”、“分”字符，使之符合人民币大写习惯。</p> <p>IIf 函数根据表达式的值，来返回两部分中的其中一个，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>IIf<span class="token punctuation">(</span>expr<span class="token punctuation">,</span> truepart<span class="token punctuation">,</span> falsepart<span class="token punctuation">)</span>

参数expr是必需的，用来判断真伪的表达式。
参数truepart是必需的，如果expr为<span class="token boolean">True</span>，则返回这部分的值或表达式。
参数falsepart是必需的，如果expr为<span class="token boolean">False</span>，则返回这部分的值或表达式。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Left、Right 函数请参阅 158 。</p> <p>第 4 行代码使用 Replace 函数将人民币大写格式表示的文本中可能出现的“零元零角”、“零元”替换成空白字符；可能出现的“零角”替换成“零”。如果输入负数的话，将“-”替换成“负”。</p> <p>在工作表中使用自定义 RMBDX 函数转换人民币大写的效果如图 163-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/163-1.7847d319.png" alt="" loading="lazy"></p> <p><u>图 163-1</u>	人民币大写转换</p></div> <h2 id="_164、列号转换为列标"><a href="#_164、列号转换为列标" class="header-anchor">#</a> 164、列号转换为列标</h2> <p>使用 VBA 获取单元格的列号时，只能返回一个数值。如果需要获取以字符表示的列标，可以使用下面的自定义 GetColumn 函数过程。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token number">001</span>  <span class="token keyword">Function</span> GetColumn<span class="token punctuation">(</span>C <span class="token keyword">As</span> <span class="token keyword">Integer</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">String</span>
<span class="token number">002</span>    GetColumn <span class="token operator">=</span> Split<span class="token punctuation">(</span>Cells<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> C<span class="token punctuation">)</span><span class="token punctuation">.</span>Address<span class="token punctuation">,</span> <span class="token string">&quot;$&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token number">003</span>  <span class="token keyword">End</span> <span class="token keyword">Function</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>代码解析：</p> <p>GetColumn 函数过程代码中，将参数 iCol 作为列号传递给 Cells 属性，并获取其绝对地址字串符，然后以“$”字符为分隔符，通过Split函数返回一个一维数组。</p> <p>Split 函数返回一个下标从零开始的一维数组，它包含指定数目的子字符串，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>Split<span class="token punctuation">(</span>expression[<span class="token punctuation">,</span> delimiter[<span class="token punctuation">,</span> limit[<span class="token punctuation">,</span> compare]]]<span class="token punctuation">)</span>

其中参数expression是必需的，包含子字符串和分隔符的字符串表达式 。如果expression是一个长度为零的字符串<span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>，则返回一个空数组，即没有元素和数据的数组。
参数delimiter是可选的，用于标识子字符串边界的字符串字符。如果忽略，则使用空格字符<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>作为分隔符。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>返回一维数组后获取该数组的第 2 个元素（下标为 1），即该列号的字符列标。</p> <p>下面的代码使用 GetColumn 函数过程获得所选单元格的字符列标。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Private</span> <span class="token keyword">Sub</span> Worksheet_SelectionChange<span class="token punctuation">(</span><span class="token keyword">ByVal</span> Target <span class="token keyword">As</span> Range<span class="token punctuation">)</span>
	MsgBox GetColumn<span class="token punctuation">(</span>Selection<span class="token punctuation">.</span>Column<span class="token punctuation">)</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>在工作表中选择单元格后结果如图 164-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/164-1.00c506d3.png" alt="" loading="lazy"></p> <p><u>图 164-1</u>	返回列标字符串</p></div> <h2 id="_165、判断工作表是否为空表"><a href="#_165、判断工作表是否为空表" class="header-anchor">#</a> 165、判断工作表是否为空表</h2> <p>VBA 中没有专门的属性或函数可以判断工作表是否为空白工作表，可以使用自定义函数返回指定工作表是否为空工作表，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Function</span> IsBlankSht<span class="token punctuation">(</span>Sh <span class="token keyword">As</span> <span class="token keyword">Variant</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Boolean</span>
	<span class="token keyword">If</span> TypeName<span class="token punctuation">(</span>Sh<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;String&quot;</span> <span class="token keyword">Then</span> <span class="token keyword">Set</span> Sh <span class="token operator">=</span> Worksheets<span class="token punctuation">(</span>Sh<span class="token punctuation">)</span>
	<span class="token keyword">If</span> Application<span class="token punctuation">.</span>CountA<span class="token punctuation">(</span>Sh<span class="token punctuation">.</span>UsedRange<span class="token punctuation">.</span>Cells<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">Then</span>
		IsBlankSht <span class="token operator">=</span> <span class="token boolean">True</span>
	<span class="token keyword">End</span> <span class="token keyword">If</span>
<span class="token keyword">End</span> <span class="token keyword">Function</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>代码解析：</p> <p>自定义 IsBlankSht 函数包含一个 Variant 变量类型的参数，代表工作表名称或者对象名称。如果指定的工作表为空工作表，则该函数返回 True。</p> <p>第 2 行代码使用 TypeName 函数判断参数 Sh 是否为字符串类型（“String”），如果是字符串，则将以该字符串作为名称的工作表赋值给变量 Sh。</p> <p>第 3 行代码通过工作表函数 CountA 统计工作表已使用区域的非空单元格个数，如果统计结果为 0，则表示该工作表为空工作表。</p> <p>现在就可以像使用 VBA 函数一样使用自定义的 IsBlankSht 函数，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> DelBlankSht<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> Sh <span class="token keyword">As</span> Worksheet
	Application<span class="token punctuation">.</span>DisplayAlerts <span class="token operator">=</span> <span class="token boolean">False</span>
	<span class="token keyword">For</span> <span class="token keyword">Each</span> Sh <span class="token keyword">In</span> ThisWorkbook<span class="token punctuation">.</span>Sheets
		<span class="token keyword">If</span> IsBlankSht<span class="token punctuation">(</span>Sh<span class="token punctuation">)</span> <span class="token keyword">Then</span> Sh<span class="token punctuation">.</span>Delete
	<span class="token keyword">Next</span>
	Application<span class="token punctuation">.</span>DisplayAlerts <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>代码解析：</p> <p>使用自定义的 IsBlankSht 函数删除工作簿中所有空工作表。</p> <p>第 3 行代码将 Application 对象的 DisplayAlerts 属性设置为 False，使删除时不显示系统警告对话框。</p> <p>第 4 行到第 6 行代码，使用 For Each...Next 语句遍历所有工作表，使用自定义的 IsBlankSht 函数判断是否为空表，如果为空表则使用 Delete 方法删除。</p> <div class="custom-block tip"><p class="custom-block-title">注意</p> <p>自定义 IsBlankSht 函数仅仅判断工作表单元格区域内容是否为空，如果工作表中存在其它对象（如图形对象、数据有效性、单元格批注等），还需要再进一步判断。</p></div> <h2 id="_166、查找指定工作表"><a href="#_166、查找指定工作表" class="header-anchor">#</a> 166、查找指定工作表</h2> <p>判断工作簿中是否存在指定名称的工作表，除了使用遍历工作簿中所有工作表的方法外，还可以使用自定义函数，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Function</span> ExistSh<span class="token punctuation">(</span>Sh <span class="token keyword">As</span> <span class="token keyword">String</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Boolean</span>
	<span class="token keyword">Dim</span> Sht <span class="token keyword">As</span> <span class="token keyword">Object</span>
	<span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">Resume</span> <span class="token keyword">Next</span>
	<span class="token keyword">Set</span> Sht <span class="token operator">=</span> Sheets<span class="token punctuation">(</span>Sh<span class="token punctuation">)</span>
	<span class="token keyword">If</span> Err<span class="token punctuation">.</span>Number <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">Then</span> ExistSh <span class="token operator">=</span> <span class="token boolean">True</span>
	<span class="token keyword">Set</span> Sht <span class="token operator">=</span> <span class="token boolean">Nothing</span>
<span class="token keyword">End</span> <span class="token keyword">Function</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>代码解析：</p> <p>自定义 ExistSh 函数包含一个 String 类型的参数，代表需要判断的工作表名称。如果该工作表存在，则返回 True。</p> <p>第 5 行代码判断前面的代码是否出错，如果前面的代码存在错误，则表示不存在指定名称的表。</p> <p>使用自定义 ExistSheet 函数判断工作簿中是否存在指定名称的工作表，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> NotSht<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> Sh <span class="token keyword">As</span> <span class="token keyword">String</span>
	Sh <span class="token operator">=</span> InputBox<span class="token punctuation">(</span><span class="token string">&quot;请输入工作表名称：&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">If</span> Len<span class="token punctuation">(</span>Sh<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">Then</span>
		<span class="token keyword">If</span> <span class="token keyword">Not</span> ExistSh<span class="token punctuation">(</span>Sh<span class="token punctuation">)</span> <span class="token keyword">Then</span>
			MsgBox <span class="token string">&quot;对不起,&quot;</span> <span class="token operator">&amp;</span> Sh <span class="token operator">&amp;</span> <span class="token string">&quot;表不存在!&quot;</span>
		<span class="token keyword">Else</span>
			Sheets<span class="token punctuation">(</span>Sh<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">Select</span>
		<span class="token keyword">End</span> <span class="token keyword">If</span>
	<span class="token keyword">End</span> <span class="token keyword">If</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>代码解析：</p> <p>NotSht 过程使用自定义的 ExistSh 函数判断工作簿中是否存在指定名称的工作表，如果不存在则使用消息框进行提示，如图 166-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/166-1.88ba2353.png" alt="" loading="lazy"></p> <p><u>图 166-1</u>	查找指定工作表</p></div> <h2 id="_167、查找指定工作簿是否打开"><a href="#_167、查找指定工作簿是否打开" class="header-anchor">#</a> 167、查找指定工作簿是否打开</h2> <p>如果需要判断指定名称的工作簿是否已经打开，除了使用 43 的方法外，还可以使用与 166 类似的自定义函数，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Function</span> ExistWorkbook<span class="token punctuation">(</span>WbName <span class="token keyword">As</span> <span class="token keyword">String</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Boolean</span>
	<span class="token keyword">Dim</span> wb <span class="token keyword">As</span> Workbook
	<span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">Resume</span> <span class="token keyword">Next</span>
	<span class="token keyword">Set</span> wb <span class="token operator">=</span> Workbooks<span class="token punctuation">(</span>WbName<span class="token punctuation">)</span>
	<span class="token keyword">If</span> Err<span class="token punctuation">.</span>Number <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">Then</span> ExistWorkbook <span class="token operator">=</span> <span class="token boolean">True</span>
	<span class="token keyword">Set</span> wb <span class="token operator">=</span> <span class="token boolean">Nothing</span>
<span class="token keyword">End</span> <span class="token keyword">Function</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>代码解析：</p> <p>自定义 ExistWorkbook 函数判断指定名称的工作簿是否已经打开。</p> <p>第 5 行代码判断前面的赋值语句是否存在错误。如果没有指定名称的工作簿，则第 4 行代码会产生错误，自定义 ExistWorkbook 函数返回 False。</p> <p>下面使用自定义 ExistWorkbook 函数判断名称为“Excel Home”的工作簿是否已经打开，如果没有打开则使用消息框进行提示，如图 167-1 所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> NotWorkbook<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">If</span> <span class="token keyword">Not</span> <span class="token punctuation">(</span>ExistWorkbook<span class="token punctuation">(</span><span class="token string">&quot;Excel Home&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">Then</span> MsgBox <span class="token string">&quot;对不起,Excel Home工作簿没有打开!&quot;</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="custom-block center"><p><img src="data:image/png;base64,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" alt="" loading="lazy"></p> <p><u>图 167-1</u>	消息框提示</p></div> <h2 id="_168、取得应用程序的安装路径"><a href="#_168、取得应用程序的安装路径" class="header-anchor">#</a> 168、取得应用程序的安装路径</h2> <p>使用自定义函数取得应用程序的安装路径，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Function</span> GetSetupPath<span class="token punctuation">(</span>AppName <span class="token keyword">As</span> <span class="token keyword">String</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> WSH <span class="token keyword">As</span> <span class="token keyword">Object</span>
	<span class="token keyword">Set</span> WSH <span class="token operator">=</span> CreateObject<span class="token punctuation">(</span><span class="token string">&quot;Wscript.Shell&quot;</span><span class="token punctuation">)</span>
	GetSetupPath <span class="token operator">=</span> WSH<span class="token punctuation">.</span>RegRead<span class="token punctuation">(</span><span class="token string">&quot;HKEY_LOCAL_MACHINE\Software&quot;</span> <span class="token operator">_</span>
		<span class="token operator">&amp;</span> <span class="token string">&quot;\Microsoft\Windows\CurrentVersion\App Paths\&quot;</span> <span class="token operator">_</span>
		<span class="token operator">&amp;</span> AppName <span class="token operator">&amp;</span> <span class="token string">&quot;\Path&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">Set</span> WSH <span class="token operator">=</span> <span class="token boolean">Nothing</span>
<span class="token keyword">End</span> <span class="token keyword">Function</span>
<span class="token keyword">Sub</span> WinRARPath<span class="token punctuation">(</span><span class="token punctuation">)</span>
	MsgBox GetSetupPath<span class="token punctuation">(</span><span class="token string">&quot;WinRAR.exe&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>代码解析：</p> <p>自定义 GetSetupPath 函数取得应用程序的安装路径，其中参数 AppName 代表指定的应用程序的名称。</p> <p>第 3 行代码使用 CreateObject 函数将 Wscript.Shell 对象的引用赋给变量 WSH。</p> <p>CreateObject 函数创建并返回一个对 ActiveX 对象的引用，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>CreateObject<span class="token punctuation">(</span><span class="token keyword">class</span><span class="token punctuation">,</span>[servername]<span class="token punctuation">)</span>

参数<span class="token keyword">class</span>是必需的，<span class="token keyword">Variant</span> <span class="token punctuation">(</span><span class="token keyword">String</span><span class="token punctuation">)</span>，要创建的应用程序名称和类。
参数servername是可选的，<span class="token keyword">Variant</span> <span class="token punctuation">(</span><span class="token keyword">String</span><span class="token punctuation">)</span>，要在其上创建对象的网络服务器名称。如果servername是一个空字符串<span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>，即使用本地机器。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>第 4 行代码取得 AppName 参数指定的应用程序在注册表中的路径。</p> <p>WinRARPath 过程使用消息框显示由自定义的 GetSetupPath 函数取得的应用程序“WinRAR”的安装路径。</p> <p>运行 WinRARPath 过程结果如图 168-1 所示。</p> <div class="custom-block center"><p><img src="data:image/png;base64,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" alt="" loading="lazy"></p> <p><u>图 168-1</u>	应用程序安装路径</p></div> <h2 id="_169、数组的使用"><a href="#_169、数组的使用" class="header-anchor">#</a> 169、数组的使用</h2> <h3 id="_1-代码运行时创建数组"><a href="#_1-代码运行时创建数组" class="header-anchor">#</a> 1）代码运行时创建数组</h3> <p>使用 Array 函数可以在代码运行时创建数组并把一系列数据保存在数组中，示例代码如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Option</span> Base <span class="token number">1</span>
<span class="token keyword">Sub</span> arr<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> arr <span class="token keyword">As</span> <span class="token keyword">Variant</span>
	<span class="token keyword">Dim</span> i <span class="token keyword">As</span> <span class="token keyword">Integer</span>
	arr <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token string">&quot;王晓明&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;吴胜玉&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;周志国&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;曹武伟&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;张新发&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;卓雪梅&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;沈煜婷&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;丁林平&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">For</span> i <span class="token operator">=</span> LBound<span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token keyword">To</span> UBound<span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
		Cells<span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> arr<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
	<span class="token keyword">Next</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>代码解析：</p> <p>Arr 过程使用 Array 函数创建一个数组用来保存数据并将其写入到工作表的单元格区域。</p> <p>第 1 行代码使用 Option Base 语句声明数组下标的缺省下界为 1，数组下标的缺省下界默认为 0。</p> <p>第 5 行代码使用 Array 函数创建数组用来保存数据。Array 函数返回一个包含数组的 Variant，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>Array<span class="token punctuation">(</span>arglist<span class="token punctuation">)</span>

Arglist参数是一个用逗号隔开的值表，这些值用于给<span class="token keyword">Variant</span>所包含的数组的各元素赋值。如果不提供Arglist参数，则创建一个长度为 <span class="token number">0</span> 的数组。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>第 6 行代码使用 LBound 函数和 UBound 函数取得数组的最小和最大下标。</p> <p>LBound 函数返回一个 Long 型数据，其值为指定数组维可用的最小下标，语法如下：</p> <p>UBound 函数返回一个 Long 型数据，其值为指定数组维可用的最大下标，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>LBound<span class="token punctuation">(</span>arrayname[<span class="token punctuation">,</span> dimension]<span class="token punctuation">)</span>
UBound<span class="token punctuation">(</span>arrayname[<span class="token punctuation">,</span> dimension]<span class="token punctuation">)</span>

参数arrayname是必需的，数组变量的名称。
参数dimension是可选的，指定返回哪一维的下界，<span class="token number">1</span>表示第一维，<span class="token number">2</span>表示第二维，如此类推。默认为<span class="token number">1</span>。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>UBound 函数与 LBound 函数一起使用，可以用来确定数组的大小。</p> <p>第 7 行代码确定数组的大小后使用 For...Next 语句遍历数组元素并将数组元素依次写入到工作表的 A 列单元格中，如图 169-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/169-1.4b533b97.png" alt="" loading="lazy"></p> <p><u>图 169-1</u>	将数组元素写入工作表</p></div> <h3 id="_2-文本转换为数组"><a href="#_2-文本转换为数组" class="header-anchor">#</a> 2）文本转换为数组</h3> <p>在处理字符串时可以使用 Split 函数将字符串按指定的分隔符分开并以数组返回，代码如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> Splitarr<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> Arr <span class="token keyword">As</span> <span class="token keyword">Variant</span>
	Arr <span class="token operator">=</span> Split<span class="token punctuation">(</span>Sheet2<span class="token punctuation">.</span>Cells<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span>
	Sheet1<span class="token punctuation">.</span>Cells<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Resize<span class="token punctuation">(</span>UBound<span class="token punctuation">(</span>Arr<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> Application<span class="token punctuation">.</span>Transpose<span class="token punctuation">(</span>Arr<span class="token punctuation">)</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>代码解析：</p> <p>Splitarr 过程使用 Split 函数将工作表 Sheet2 中 <code>A1</code> 单元格的姓名分别写入到工作表 Sheet1 中的 A 列单元格。</p> <p>Split 函数返回一个下标从零开始的一维数组，包含指定数目的子字符串，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>Split<span class="token punctuation">(</span>expression[<span class="token punctuation">,</span> delimiter[<span class="token punctuation">,</span> limit[<span class="token punctuation">,</span> compare]]]<span class="token punctuation">)</span>

参数expression是必需的，包含子字符串和分隔符的字符串表达式。
参数delimiter是必需的，用来标识子字符串边界的字符串字符。如果忽略，则使用空格字符<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>作为分隔符。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>第 4 行代码，首先使用 UBound 函数取得返回数组的最大下标后调整单元格区域，因为数组下标的缺省下界默认为 0，所以在使用 Resize 属性调整单元格区域时参数 RowSize 需要在返回数组的最大下标上加一。</p> <p>然后使用工作表 Transpose 函数将返回数组转置后写入到工作表调整后的单元格区域中。</p> <p>工作表 Transpose 函数返回转置单元格区域，即将一行单元格区域转置成一列单元格区域，反之亦然，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>TRANSPOSE<span class="token punctuation">(</span>array<span class="token punctuation">)</span>

参数 array 为需要进行转置的数组或工作表中的单元格区域。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Splitarr 过程将如图 169-2 所示的工作表单元格中的字符串以逗号分隔后依次写入到工作表的 A 列单元格中，如图 169-3 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/169-2.2c9ac196.png" alt="" loading="lazy"></p> <p><u>图 169-2</u>	工作表单元格中的字符串</p> <p><img src="/blog/assets/img/169-3.c8901083.png" alt="" loading="lazy"></p> <p><u>图 169-3</u>	文本转换为数组写入单元格</p></div> <h3 id="_3-使用动态数组去除重复值"><a href="#_3-使用动态数组去除重复值" class="header-anchor">#</a> 3）使用动态数组去除重复值</h3> <p>在 169-2 中使用数组函数将单元格中的文本进行分隔后写入到工作表 Sheet1 中的 A 列单元格，但是如果文本中含有大量的重复值，在写入时也会将重复值写入到工作表中，此时可以使用动态数组去除文本中的重复值，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> Splitarr<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> Splarr<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">String</span>
	<span class="token keyword">Dim</span> Arr<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">String</span>
	<span class="token keyword">Dim</span> Temp<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">String</span>
	<span class="token keyword">Dim</span> r <span class="token keyword">As</span> <span class="token keyword">Integer</span>
	<span class="token keyword">Dim</span> i <span class="token keyword">As</span> <span class="token keyword">Integer</span>
	<span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">Resume</span> <span class="token keyword">Next</span>
	Splarr <span class="token operator">=</span> Split<span class="token punctuation">(</span>Sheet2<span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">To</span> UBound<span class="token punctuation">(</span>Splarr<span class="token punctuation">)</span>
		Temp <span class="token operator">=</span> Filter<span class="token punctuation">(</span>Arr<span class="token punctuation">,</span> Splarr<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">If</span> UBound<span class="token punctuation">(</span>Temp<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">Then</span>
			r <span class="token operator">=</span> r <span class="token operator">+</span> <span class="token number">1</span>
			<span class="token keyword">ReDim</span> Preserve Arr<span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">To</span> r<span class="token punctuation">)</span>
			Arr<span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=</span> Splarr<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
		<span class="token keyword">End</span> <span class="token keyword">If</span>
	<span class="token keyword">Next</span>
	Sheet1<span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Resize<span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> Application<span class="token punctuation">.</span>Transpose<span class="token punctuation">(</span>Arr<span class="token punctuation">)</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>代码解析：</p> <p>Splitarr 过程将工作表 Sheet2 中 <code>A1</code> 单元格的文本去除重复值后写入到工作表 Sheet1 中的 A 列单元格。</p> <p>第 2 行代码声明数组 Splarr 用来保存 Sheet2 中 <code>A1</code> 单元格的文本。</p> <p>第 3 行代码声明数组 Arr 用来保存去除重复值后的文本。</p> <p>第 4 行代码声明数组 Temp 用来判断文本是否重复。</p> <p>第 5 行代码声明变量 r 用来保存去除重复值后的文本数量。</p> <p>第 7 行代码启动错误处理程序来忽略错误，因为在程序运行到第 11 行代码会发生下标越界错误。</p> <p>第 8 行代码使用 Split 函数以 Sheet2 中 <code>A1</code> 单元格的文本创建一个下标从零开始的一维数组。关于 Split 函数请参阅 169-2。</p> <p>第 9 行代码使用 For...Next 语句遍历数组 Splarr 的所有元素。</p> <p>第 10 行代码使用 Filter 函数创建一个数组 Temp 用来保存以当前 Splarr 数组的值在 Arr 数组中的搜索结果。Filter 函数返回一个下标从零开始的数组，该数组包含基于指定筛选条件的一个字符串数组的子集，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>Filter<span class="token punctuation">(</span>sourcesrray<span class="token punctuation">,</span> match[<span class="token punctuation">,</span> include[<span class="token punctuation">,</span> compare]]<span class="token punctuation">)</span>

参数sourcesrray是必需的，要执行搜索的一维字符串数组。
参数match是必需的，要搜索的字符串。
参数include是可选的，<span class="token keyword">Boolean</span>值，表示返回子串是否包含match字符串。如果参数include是<span class="token boolean">True</span>，Filter函数返回的是包含match参数子字符串的数组子集。如果参数include是<span class="token boolean">False</span>，Filter函数返回的是不包含match参数子字符串的数组子集。
参数compare是可选的，所使用的字符串比较类型。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>第 11 行代码根据返回的数组 Temp 的最大下标来判断当前 Splarr 数组的值是否重复。在使用使用 Filter 函数时如果没有相匹配的值，将返回一个空数组，最大下标小于 0。</p> <p>第 12 行代码如果当前 Splarr 数组的值不重复则将变量 r 的值加 1。</p> <p>第 13 行代码重新定义动态数组大小。ReDim 语句，在过程级别中使用，用于为动态数组变量重新分配存储空间，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">ReDim</span> [Preserve] varname<span class="token punctuation">(</span>subscripts<span class="token punctuation">)</span> [<span class="token keyword">As</span> <span class="token keyword">type</span>] [<span class="token punctuation">,</span> varname<span class="token punctuation">(</span>subscripts<span class="token punctuation">)</span> [<span class="token keyword">As</span> <span class="token keyword">type</span>]]

参数Preserve是可选的，关键字，当改变原有数组最末维的大小时，使用此关键字可以保持数组中原来的数据。
参数varname是必需的，变量的名称。
参数subscripts是必需的，数组变量的维数，最多可以定义 <span class="token number">60</span> 维的多维数组，使用下面的语法；

[lower <span class="token keyword">To</span>] upper [<span class="token punctuation">,</span>[lower <span class="token keyword">To</span>] upper]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>第 14 行代码将不重复值添加到数组 Arr 中。</p> <p>第 15 行代码使用工作表 Transpose 函数将去除重复值的的文本转置后写入到工作表的 A 列单元格中。</p> <p>如果需要将去除重复值的的文本写入到第一行单元格中，可以将第 15 行代码改成下面的代码：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>Sheet1<span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Resize<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">=</span> Arr
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果需要将去除重复值的的文本还是以逗号作为分隔符写入到 <code>A1</code> 单元格中，可以将第 15 行代码改成下面的代码：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>Sheet1<span class="token punctuation">.</span>Range<span class="token punctuation">(</span><span class="token string">&quot;a1&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> Join<span class="token punctuation">(</span>Arr<span class="token punctuation">,</span> <span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Join 函数返回一个字符串，该字符串是通过连接某个数组中的多个子字符串而创建的，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>Join<span class="token punctuation">(</span>sourcearray[<span class="token punctuation">,</span> delimiter]<span class="token punctuation">)</span>

参数sourcearray是必需的，包含被连接子字符串的一维数组。
参数delimiter是可选的，在返回字符串中用于分隔子字符串的字符，如果忽略则使用空格<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>来分隔子字符串。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/Ryukarin/blog/edit/main/project/Excel/13.VBA_function.md" target="_blank" rel="noopener noreferrer">编辑此页</a></div> <div class="meta-item update-time"><span class="label">上次编辑于:</span> <span class="info">2022年1月26日 14:11</span></div> <div class="meta-item contributors"><span class="label">贡献者: </span> <span class="info"><span title="email: ryuukaringo@gmail.com" class="contributor">
          ryuukarin
        </span> <!----></span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/blog/project/Excel/12.VBA_controls_form_3/" class="prev"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon prev-icon"><path d="M906.783 588.79c-.02 8.499-6.882 15.36-15.38 15.37l-443.7-.01 75.704 191.682c2.52 6.42.482 13.763-5.038 17.91-5.52 4.168-13.138 4.147-18.616-.092L123.228 524.175a15.362 15.362 0 0 1-6-12.165c0-4.782 2.222-9.277 6-12.185L499.753 210.35a15.388 15.388 0 0 1 9.38-3.195c3.236 0 6.502 1.034 9.236 3.103 5.52 4.147 7.578 11.49 5.038 17.91L447.683 419.84l443.72-.01c8.498.01 15.36 6.881 15.36 15.36l.02 153.6z" fill="currentColor"></path></svg>
        VBA 之 控件与用户窗体3
      </a></span> <span class="next"><a href="/blog/project/Excel/14.VBA_fso/">
        VBA 之 文件操作
        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon next-icon"><path d="M906.772 512c0 4.772-2.211 9.267-5.99 12.175L524.257 813.66a15.37 15.37 0 0 1-18.616.092 15.368 15.368 0 0 1-5.038-17.91l75.714-191.672h-443.73c-8.488 0-15.36-6.881-15.36-15.36v-153.6c0-8.489 6.872-15.36 15.36-15.36h443.73l-75.714-191.682a15.358 15.358 0 0 1 5.048-17.91c5.51-4.158 13.128-4.137 18.606.092l376.525 289.485a15.323 15.323 0 0 1 5.99 12.165z" fill="currentColor"></path></svg></a></span></p></div> <div class="comments-wrapper"><div class="waline-wrapper"><div id="waline-comment"></div></div></div> <!----> <div class="content__page-bottom"></div></main> <footer class="footer-wrapper"><div class="media-links-wrapper"><a href="https://gitee.com/ryuukarin" rel="noopener noreferrer" target="_blank" aria-label="Gitee" data-balloon-pos="up" class="media-link"><span class="sr-only">Gitee</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-gitee"><circle cx="512" cy="512" r="512" fill="#C71D23"></circle> <path d="M772.953 454.723H480.17v.006a25.46 25.46 0 0 0-25.46 25.453l-.025 63.649a25.46 25.46 0 0 0 25.46 25.466l178.242-.007a25.46 25.46 0 0 1 25.459 25.46v12.73c0 42.18-34.198 76.378-76.378 76.378H365.583a25.46 25.46 0 0 1-25.46-25.46V416.533h-.006c0-42.18 34.192-76.378 76.378-76.378h356.388v-.013a25.46 25.46 0 0 0 25.46-25.446l.057-63.65h.013a25.46 25.46 0 0 0-25.46-25.471l-356.432.012c-105.453 0-190.946 85.493-190.946 190.946v356.433a25.46 25.46 0 0 0 25.46 25.46H626.56c94.913 0 171.852-76.94 171.852-171.852V480.182a25.46 25.46 0 0 0-25.46-25.46z" fill="#fff"></path></svg></a><a href="https://github.com/Ryukarin" rel="noopener noreferrer" target="_blank" aria-label="Github" data-balloon-pos="up" class="media-link"><span class="sr-only">Github</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-github"><circle cx="512" cy="512" r="512" fill="#171515"></circle> <path d="M509.423 146.442c-200.317 0-362.756 162.42-362.756 362.8 0 160.266 103.936 296.24 248.109 344.217 18.139 3.327 24.76-7.872 24.76-17.486 0-8.613-.313-31.427-.49-61.702-100.912 21.923-122.205-48.63-122.205-48.63-16.495-41.91-40.28-53.067-40.28-53.067-32.937-22.51 2.492-22.053 2.492-22.053 36.407 2.566 55.568 37.386 55.568 37.386 32.362 55.438 84.907 39.43 105.58 30.143 3.296-23.444 12.667-39.43 23.032-48.498-80.557-9.156-165.246-40.28-165.246-179.297 0-39.604 14.135-71.988 37.342-97.348-3.731-9.178-16.18-46.063 3.556-96.009 0 0 30.46-9.754 99.76 37.19 28.937-8.048 59.97-12.071 90.823-12.211 30.807.14 61.843 4.165 90.822 12.21 69.26-46.944 99.663-37.189 99.663-37.189 19.792 49.946 7.34 86.831 3.61 96.01 23.25 25.359 37.29 57.742 37.29 97.347 0 139.366-84.82 170.033-165.637 179.013 13.026 11.2 24.628 33.342 24.628 67.182 0 48.498-.445 87.627-.445 99.521 0 9.702 6.535 20.988 24.945 17.444 144.03-48.067 247.881-183.95 247.881-344.175 0-200.378-162.442-362.798-362.802-362.798z" fill="#FFF"></path></svg></a></div> <div class="footer">MIT Licensed</div> <div class="copyright">Copyright © 2022 karin</div></footer></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="关闭" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">该应用可以安装在您的 PC 或移动设备上。这将使该 Web 应用程序外观和行为与其他应用程序相同。它将在出现在应用程序列表中，并可以固定到主屏幕，开始菜单或任务栏。此 Web 应用程序还将能够与其他应用程序和您的操作系统安全地进行交互。</p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>详情</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        安装 <span></span></button> <button class="cancel-button">
        取消
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="关闭" aria-label="关闭" class="pswp__button pswp__button--close"></button> <button title="分享" aria-label="分享" class="pswp__button pswp__button--share"></button> <button title="切换全屏" aria-label="切换全屏" class="pswp__button pswp__button--fs"></button> <button title="缩放" aria-label="缩放" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="上一个 (左箭头)" aria-label="上一个 (左箭头)" class="pswp__button pswp__button--arrow--left"></button> <button title="下一个 (右箭头)" aria-label="下一个 (右箭头)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/blog/assets/js/app.9f9c9b81.js" defer></script><script src="/blog/assets/js/vendors~layout-Layout.79b66223.js" defer></script><script src="/blog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.efafecdd.js" defer></script><script src="/blog/assets/js/page-VBA之函数的使用.60f6a8be.js" defer></script>
  </body>
</html>
