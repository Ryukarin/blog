<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VBA 之 菜单和工具栏 | KARIN</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <link rel="alternate" type="application/atom+xml" href="https://vuepress-theme-hope-demo.mrhope.site/blog/atom.xml" title="KARIN Atom Feed">
    <link rel="alternate" type="application/json" href="https://vuepress-theme-hope-demo.mrhope.site/blog/feed.json" title="KARIN JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="https://vuepress-theme-hope-demo.mrhope.site/blog/rss.xml" title="KARIN RSS Feed">
    <link rel="icon" href="/favicon.png">
    <link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512">
    <link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192">
    <link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512">
    <link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192">
    <link rel="manifest" href="/blog/manifest.webmanifest" crossorigin="use-credentials">
    <link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png">
    <meta name="description" content="KARIN的学习笔记">
    <meta property="og:url" content="/blog/project/Excel/09.VBA_menu_toolbar.html">
    <meta property="og:site_name" content="KARIN">
    <meta property="og:title" content="VBA 之 菜单和工具栏">
    <meta property="og:description" content="79、在菜单中添加菜单项 在 Excel 工作表的菜单中可以添加新的菜单项和子菜单，如下面的代码所示。 代码解析： myTools 过程使用 Add 方法在 Excel 工作表菜单栏中的“帮助”菜单中添加一个标题为“Excel Home 技术论坛”的菜单项和 5 个子菜单。 第 2 行到第 5 行代码声明变量类型。 第 6、7 行代码使用 Array 函数创">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="zh-CN">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="KARIN">
    <meta property="article:author" content="karin">
    <meta property="article:tag" content="Excel">
    <meta property="article:published_time" content="2021-07-02T00:00:00.000Z">
    <meta name="theme-color" content="#46bd87">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    
    <link rel="preload" href="/blog/assets/css/0.styles.5649bb21.css" as="style"><link rel="preload" href="/blog/assets/js/app.9f9c9b81.js" as="script"><link rel="preload" href="/blog/assets/js/vendors~layout-Layout.79b66223.js" as="script"><link rel="preload" href="/blog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.efafecdd.js" as="script"><link rel="preload" href="/blog/assets/js/page-VBA之菜单和工具栏.ec98d91f.js" as="script"><link rel="prefetch" href="/blog/assets/js/122.7ad47f04.js"><link rel="prefetch" href="/blog/assets/js/123.ae4a39df.js"><link rel="prefetch" href="/blog/assets/js/124.2715123b.js"><link rel="prefetch" href="/blog/assets/js/125.a4234a33.js"><link rel="prefetch" href="/blog/assets/js/126.8fa2f32c.js"><link rel="prefetch" href="/blog/assets/js/127.9bf5c918.js"><link rel="prefetch" href="/blog/assets/js/128.0c398c07.js"><link rel="prefetch" href="/blog/assets/js/layout-Blog.8dd576a3.js"><link rel="prefetch" href="/blog/assets/js/layout-Layout.3729e73b.js"><link rel="prefetch" href="/blog/assets/js/layout-NotFound.f1d2f2e6.js"><link rel="prefetch" href="/blog/assets/js/layout-Slide.7ed7d0aa.js"><link rel="prefetch" href="/blog/assets/js/page--3d4f54c7.4eab0894.js"><link rel="prefetch" href="/blog/assets/js/page-Docker数据管理.143b7f4f.js"><link rel="prefetch" href="/blog/assets/js/page-Excel函数.22369a36.js"><link rel="prefetch" href="/blog/assets/js/page-Excel快捷键.8fdc623f.js"><link rel="prefetch" href="/blog/assets/js/page-Excel笔记介绍.57c3fe06.js"><link rel="prefetch" href="/blog/assets/js/page-FTP笔记.2b8526c8.js"><link rel="prefetch" href="/blog/assets/js/page-Git介绍.82a25571.js"><link rel="prefetch" href="/blog/assets/js/page-Git分支管理.4f9c0210.js"><link rel="prefetch" href="/blog/assets/js/page-Git创建仓库.cabea66e.js"><link rel="prefetch" href="/blog/assets/js/page-Git基本操作.4e1f4734.js"><link rel="prefetch" href="/blog/assets/js/page-Git安装.cf6d44b4.js"><link rel="prefetch" href="/blog/assets/js/page-Git工作区、暂存区和版本库.5d561956.js"><link rel="prefetch" href="/blog/assets/js/page-Git工作流程.d2b8995f.js"><link rel="prefetch" href="/blog/assets/js/page-Git服务器搭建.7f6986af.js"><link rel="prefetch" href="/blog/assets/js/page-Git查看提交历史.40ff21ea.js"><link rel="prefetch" href="/blog/assets/js/page-Git标签.8f2c2cb6.js"><link rel="prefetch" href="/blog/assets/js/page-Git笔记.5e6ddcdf.js"><link rel="prefetch" href="/blog/assets/js/page-Git远程仓库（GitHub）.c8505cba.js"><link rel="prefetch" href="/blog/assets/js/page-Git配置.f141007c.js"><link rel="prefetch" href="/blog/assets/js/page-IT基础.e088bf26.js"><link rel="prefetch" href="/blog/assets/js/page-LAMP和LNMP环境搭建.adf92a39.js"><link rel="prefetch" href="/blog/assets/js/page-Markdown语法.76ecc03f.js"><link rel="prefetch" href="/blog/assets/js/page-SELinux管理.4075242b.js"><link rel="prefetch" href="/blog/assets/js/page-SFTP笔记.cdcf4d77.js"><link rel="prefetch" href="/blog/assets/js/page-Shell函数.775b51bc.js"><link rel="prefetch" href="/blog/assets/js/page-Shell变量.cda63b20.js"><link rel="prefetch" href="/blog/assets/js/page-Shell对文件的操作---sed命令.cd166768.js"><link rel="prefetch" href="/blog/assets/js/page-Shell对文本的搜索---grep命令.6083e37d.js"><link rel="prefetch" href="/blog/assets/js/page-Shell对输出流的处理---awk命令.0d48e00c.js"><link rel="prefetch" href="/blog/assets/js/page-Shell数组.4b8667ee.js"><link rel="prefetch" href="/blog/assets/js/page-Shell格式化输入.bf1e7958.js"><link rel="prefetch" href="/blog/assets/js/page-Shell格式化输出.6607e3e6.js"><link rel="prefetch" href="/blog/assets/js/page-Shell正则表达式.ebfdf1ff.js"><link rel="prefetch" href="/blog/assets/js/page-Shell流程控制---case分支语句.332bd80e.js"><link rel="prefetch" href="/blog/assets/js/page-Shell流程控制---for循环语句.de1b1b0b.js"><link rel="prefetch" href="/blog/assets/js/page-Shell流程控制---if判断语句.b0532849.js"><link rel="prefetch" href="/blog/assets/js/page-Shell流程控制---until循环语句.e7c9c7f3.js"><link rel="prefetch" href="/blog/assets/js/page-Shell流程控制---while循环语句.09fcf551.js"><link rel="prefetch" href="/blog/assets/js/page-Shell监控脚本.214dbdf6.js"><link rel="prefetch" href="/blog/assets/js/page-Shell脚本---lamp环境安装.02e925e4.js"><link rel="prefetch" href="/blog/assets/js/page-Shell脚本介绍.a9743a4a.js"><link rel="prefetch" href="/blog/assets/js/page-Shell脚本笔记.333fc9cf.js"><link rel="prefetch" href="/blog/assets/js/page-Shell语法.af36ce2b.js"><link rel="prefetch" href="/blog/assets/js/page-Shell运算.2f6e1b67.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之Application对象.dc3d863e.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之Range对象.aff14b9e.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之Shape、Chart对象.c8437d84.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之Sheet对象.40acafa7.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之Workbook对象.4b6ac3e5.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之使用对话框.32011bcc.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之函数的使用.60f6a8be.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之控件与用户窗体1.b004969b.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之控件与用户窗体2.0ca5f6c7.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之控件与用户窗体3.d9a20920.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之文件操作.5f150c21.js"><link rel="prefetch" href="/blog/assets/js/page-linux三剑客.e71431d8.js"><link rel="prefetch" href="/blog/assets/js/page-linux介绍.eae8610d.js"><link rel="prefetch" href="/blog/assets/js/page-linux关机和重启命令.13f93679.js"><link rel="prefetch" href="/blog/assets/js/page-linux其他权限管理命令.cedaf338.js"><link rel="prefetch" href="/blog/assets/js/page-linux压缩、解压缩命令.6908caa3.js"><link rel="prefetch" href="/blog/assets/js/page-linux基本操作命令.e8f72eb0.js"><link rel="prefetch" href="/blog/assets/js/page-linux大杂烩.9f8cdc5c.js"><link rel="prefetch" href="/blog/assets/js/page-linux帮助命令.4fdeff8c.js"><link rel="prefetch" href="/blog/assets/js/page-linux常用网络命令.8169fd78.js"><link rel="prefetch" href="/blog/assets/js/page-linux搜索命令.8d223c34.js"><link rel="prefetch" href="/blog/assets/js/page-linux数据备份与恢复.f202f4a1.js"><link rel="prefetch" href="/blog/assets/js/page-linux文件系统管理.859d9e24.js"><link rel="prefetch" href="/blog/assets/js/page-linux文件系统结构.a7348129.js"><link rel="prefetch" href="/blog/assets/js/page-linux文本编辑器.fa0a4df9.js"><link rel="prefetch" href="/blog/assets/js/page-linux权限管理命令.be5e8ebf.js"><link rel="prefetch" href="/blog/assets/js/page-linux用户和用户组管理.4079bdf7.js"><link rel="prefetch" href="/blog/assets/js/page-linux的管理建议.82f61a78.js"><link rel="prefetch" href="/blog/assets/js/page-linux系统启动管理.96ebf1d7.js"><link rel="prefetch" href="/blog/assets/js/page-linux系统工作管理.3c407e77.js"><link rel="prefetch" href="/blog/assets/js/page-linux系统日志管理.72ca77b7.js"><link rel="prefetch" href="/blog/assets/js/page-linux系统服务管理.46ae7426.js"><link rel="prefetch" href="/blog/assets/js/page-linux系统进程管理.d56234ab.js"><link rel="prefetch" href="/blog/assets/js/page-linux软件安装.cc84e331.js"><link rel="prefetch" href="/blog/assets/js/page-linux高级文件系统管理.9e3c9bf6.js"><link rel="prefetch" href="/blog/assets/js/page-【MSG1500】刷机.c9407606.js"><link rel="prefetch" href="/blog/assets/js/page-【OpenWRT】固件编译.0ef4cd6f.js"><link rel="prefetch" href="/blog/assets/js/page-【Padavan】固件编译.d2a97584.js"><link rel="prefetch" href="/blog/assets/js/page-【RM2100】刷机救转.c6946098.js"><link rel="prefetch" href="/blog/assets/js/page-【VuePress】博客搭建.11c20d91.js"><link rel="prefetch" href="/blog/assets/js/page-【bootimg】解包打包.9ffb0b1e.js"><link rel="prefetch" href="/blog/assets/js/page-【openwrt】编译F大N1固件.49fa444e.js"><link rel="prefetch" href="/blog/assets/js/page-【squashfs】解包打包.58587e3c.js"><link rel="prefetch" href="/blog/assets/js/page-【小娱C1C5】刷机.4e341876.js"><link rel="prefetch" href="/blog/assets/js/page-【小娱C1C5】改造计划.ce3479e5.js"><link rel="prefetch" href="/blog/assets/js/page-【斐讯N1】Armbian.3bec83f3.js"><link rel="prefetch" href="/blog/assets/js/page-【斐讯N1】开机第一屏logo替换.57e2b6fa.js"><link rel="prefetch" href="/blog/assets/js/page-【贝壳云】改造计划.89b5027b.js"><link rel="prefetch" href="/blog/assets/js/page-【魔百合Q5】改造计划.510447e8.js"><link rel="prefetch" href="/blog/assets/js/page-个人信息.60959644.js"><link rel="prefetch" href="/blog/assets/js/page-主要功能与配置演示.90c45f63.js"><link rel="prefetch" href="/blog/assets/js/page-使用Dockerfile创建镜像.39abbd05.js"><link rel="prefetch" href="/blog/assets/js/page-使用Docker镜像.f46cc3e5.js"><link rel="prefetch" href="/blog/assets/js/page-初识Docker与容器.03017897.js"><link rel="prefetch" href="/blog/assets/js/page-博客主页.ee0b8fe8.js"><link rel="prefetch" href="/blog/assets/js/page-常用网站.40b6c65e.js"><link rel="prefetch" href="/blog/assets/js/page-幻灯片页.d2d94e64.js"><link rel="prefetch" href="/blog/assets/js/page-操作Docker容器.fca5b876.js"><link rel="prefetch" href="/blog/assets/js/page-核心概念与安装配置.bf9114e2.js"><link rel="prefetch" href="/blog/assets/js/page-瞎折腾.1dfcca6f.js"><link rel="prefetch" href="/blog/assets/js/page-端口映射与容器互联.44a4b5aa.js"><link rel="prefetch" href="/blog/assets/js/page-虚拟化的发展.7ac33b9a.js"><link rel="prefetch" href="/blog/assets/js/page-访问Docker仓库.71b3e000.js"><link rel="prefetch" href="/blog/assets/js/page-项目主页.24aa2c8e.js"><link rel="prefetch" href="/blog/assets/js/vendors~flowchart.eb5798cd.js"><link rel="prefetch" href="/blog/assets/js/vendors~mermaid.f1e52241.js"><link rel="prefetch" href="/blog/assets/js/vendors~photo-swipe.46d64c2d.js"><link rel="prefetch" href="/blog/assets/js/vendors~reveal.3f88bab1.js"><link rel="prefetch" href="/blog/assets/js/vendors~waline.8e39946b.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.5649bb21.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.png" alt="KARIN" class="logo"> <!----> <span class="site-name can-hide">KARIN</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">主题色:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">主题模式:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  博客主页
</a></div><div class="nav-item"><a href="/blog/project/" class="nav-link router-link-active active"><i class="iconfont icon-folder"></i>
  项目总览
</a></div><div class="nav-item"><a href="/blog/IT/" class="nav-link"><i class="iconfont icon-blog"></i>
  知识要点
</a></div><div class="nav-item"><a href="/blog/operate/" class="nav-link"><i class="iconfont icon-operate"></i>
  捣鼓折腾
</a></div></nav> <!----> <a rel="noopener noreferrer" href="https://github.com/Ryukarin/blog" target="_blank" class="repo-link can-hide">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div vocab="https://schema.org/" typeof="Person" class="blogger-info mobile"><div data-balloon-pos="down" role="navigation" class="blogger hasIntro"><img property="image" alt="Blogger Avatar" src="/blog/logo.png" class="avatar round"> <div property="name" class="name">karin</div> <meta property="url" content="/blog/intro/"></div> <div class="num-wrapper"><div><div class="num">106</div> <div>文章</div></div> <div><div class="num">14</div> <div>分类</div></div> <div><div class="num">18</div> <div>标签</div></div> <div><div class="num">105</div> <div>时间轴</div></div></div> <div class="media-links-wrapper"><a href="https://gitee.com/ryuukarin" rel="noopener noreferrer" target="_blank" aria-label="Gitee" data-balloon-pos="up" class="media-link"><span class="sr-only">Gitee</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-gitee"><circle cx="512" cy="512" r="512" fill="#C71D23"></circle> <path d="M772.953 454.723H480.17v.006a25.46 25.46 0 0 0-25.46 25.453l-.025 63.649a25.46 25.46 0 0 0 25.46 25.466l178.242-.007a25.46 25.46 0 0 1 25.459 25.46v12.73c0 42.18-34.198 76.378-76.378 76.378H365.583a25.46 25.46 0 0 1-25.46-25.46V416.533h-.006c0-42.18 34.192-76.378 76.378-76.378h356.388v-.013a25.46 25.46 0 0 0 25.46-25.446l.057-63.65h.013a25.46 25.46 0 0 0-25.46-25.471l-356.432.012c-105.453 0-190.946 85.493-190.946 190.946v356.433a25.46 25.46 0 0 0 25.46 25.46H626.56c94.913 0 171.852-76.94 171.852-171.852V480.182a25.46 25.46 0 0 0-25.46-25.46z" fill="#fff"></path></svg></a><a href="https://github.com/Ryukarin" rel="noopener noreferrer" target="_blank" aria-label="Github" data-balloon-pos="up" class="media-link"><span class="sr-only">Github</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-github"><circle cx="512" cy="512" r="512" fill="#171515"></circle> <path d="M509.423 146.442c-200.317 0-362.756 162.42-362.756 362.8 0 160.266 103.936 296.24 248.109 344.217 18.139 3.327 24.76-7.872 24.76-17.486 0-8.613-.313-31.427-.49-61.702-100.912 21.923-122.205-48.63-122.205-48.63-16.495-41.91-40.28-53.067-40.28-53.067-32.937-22.51 2.492-22.053 2.492-22.053 36.407 2.566 55.568 37.386 55.568 37.386 32.362 55.438 84.907 39.43 105.58 30.143 3.296-23.444 12.667-39.43 23.032-48.498-80.557-9.156-165.246-40.28-165.246-179.297 0-39.604 14.135-71.988 37.342-97.348-3.731-9.178-16.18-46.063 3.556-96.009 0 0 30.46-9.754 99.76 37.19 28.937-8.048 59.97-12.071 90.823-12.211 30.807.14 61.843 4.165 90.822 12.21 69.26-46.944 99.663-37.189 99.663-37.189 19.792 49.946 7.34 86.831 3.61 96.01 23.25 25.359 37.29 57.742 37.29 97.347 0 139.366-84.82 170.033-165.637 179.013 13.026 11.2 24.628 33.342 24.628 67.182 0 48.498-.445 87.627-.445 99.521 0 9.702 6.535 20.988 24.945 17.444 144.03-48.067 247.881-183.95 247.881-344.175 0-200.378-162.442-362.798-362.802-362.798z" fill="#FFF"></path></svg></a></div></div> <hr> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  博客主页
</a></div><div class="nav-item"><a href="/blog/project/" class="nav-link router-link-active active"><i class="iconfont icon-folder"></i>
  项目总览
</a></div><div class="nav-item"><a href="/blog/IT/" class="nav-link"><i class="iconfont icon-blog"></i>
  知识要点
</a></div><div class="nav-item"><a href="/blog/operate/" class="nav-link"><i class="iconfont icon-operate"></i>
  捣鼓折腾
</a></div> <a rel="noopener noreferrer" href="https://github.com/Ryukarin/blog" target="_blank" class="repo-link">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><a href="/blog/" aria-current="page" class="sidebar-link"><i class="iconfont icon-home"></i>博客主页</a></li><li><a href="/blog/project/" aria-current="page" class="sidebar-link"><i class="iconfont icon-folder"></i>项目主页</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-blog"></i> <span class="title">知识要点</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-operate"></i> <span class="title">捣鼓折腾</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-linux"></i> <span class="title">Linux基础知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-linux"></i> <span class="title">Linux系统管理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-linux"></i> <span class="title">Linux大杂烩</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-shell"></i> <span class="title">Shell笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-geometry"></i> <span class="title">Docker笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-git"></i> <span class="title">Git笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable open"><i class="iconfont icon-note"></i> <span class="title">Excel修炼秘籍</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/project/Excel/" aria-current="page" class="sidebar-link">Excel 笔记介绍</a></li><li><a href="/blog/project/Excel/01.Excel_hotkey/" class="sidebar-link">Excel 快捷键</a></li><li><a href="/blog/project/Excel/02.Excel_function/" class="sidebar-link">Excel 函数</a></li><li><a href="/blog/project/Excel/03.VBA_Range/" class="sidebar-link">VBA 之 Range 对象</a></li><li><a href="/blog/project/Excel/04.VBA_Sheet/" class="sidebar-link">VBA 之 Sheet 对象</a></li><li><a href="/blog/project/Excel/05.VBA_Workbook/" class="sidebar-link">VBA 之 Workbook 对象</a></li><li><a href="/blog/project/Excel/06.VBA_Shape_Chart/" class="sidebar-link">VBA 之 Shape、Chart 对象</a></li><li><a href="/blog/project/Excel/07.VBA_Application/" class="sidebar-link">VBA 之 Application 对象</a></li><li><a href="/blog/project/Excel/08.VBA_dialog/" class="sidebar-link">VBA 之 使用对话框</a></li><li><a href="/blog/project/Excel/09.VBA_menu_toolbar/" aria-current="page" class="active sidebar-link">VBA 之 菜单和工具栏</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_79、在菜单中添加菜单项" class="sidebar-link">79、在菜单中添加菜单项</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_80、在菜单栏指定位置添加菜单" class="sidebar-link">80、在菜单栏指定位置添加菜单</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_81、屏蔽和删除工作表菜单" class="sidebar-link">81、屏蔽和删除工作表菜单</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_82、改变系统菜单的操作" class="sidebar-link">82、改变系统菜单的操作</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_83、定制自己的系统菜单" class="sidebar-link">83、定制自己的系统菜单</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_84、改变菜单按钮图标" class="sidebar-link">84、改变菜单按钮图标</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_85、右键快捷菜单增加菜单项" class="sidebar-link">85、右键快捷菜单增加菜单项</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_86、自定义右键快捷菜单" class="sidebar-link">86、自定义右键快捷菜单</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_87、使用右键菜单制作数据有效性" class="sidebar-link">87、使用右键菜单制作数据有效性</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_88、禁用工作表右键菜单" class="sidebar-link">88、禁用工作表右键菜单</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_89、创建自定义工具栏" class="sidebar-link">89、创建自定义工具栏</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_90、自定义工具栏按钮图标" class="sidebar-link">90、自定义工具栏按钮图标</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_91、自定义工作簿图标" class="sidebar-link">91、自定义工作簿图标</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_92、移除工作表的最小最大化和关闭按钮" class="sidebar-link">92、移除工作表的最小最大化和关闭按钮</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_93、在工具栏上添加下拉列表框" class="sidebar-link">93、在工具栏上添加下拉列表框</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_94、屏蔽工作表的复制功能" class="sidebar-link">94、屏蔽工作表的复制功能</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_95、禁用工具栏的自定义" class="sidebar-link">95、禁用工具栏的自定义</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_96、屏蔽所有的命令栏" class="sidebar-link">96、屏蔽所有的命令栏</a></li><li class="sidebar-sub-header"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_97、恢复-excel-的命令栏" class="sidebar-link">97、恢复 Excel 的命令栏</a></li></ul></li><li><a href="/blog/project/Excel/10.VBA_controls_form_1/" class="sidebar-link">VBA 之 控件与用户窗体1</a></li><li><a href="/blog/project/Excel/11.VBA_controls_form_2/" class="sidebar-link">VBA 之 控件与用户窗体2</a></li><li><a href="/blog/project/Excel/12.VBA_controls_form_3/" class="sidebar-link">VBA 之 控件与用户窗体3</a></li><li><a href="/blog/project/Excel/13.VBA_function/" class="sidebar-link">VBA 之 函数的使用</a></li><li><a href="/blog/project/Excel/14.VBA_fso/" class="sidebar-link">VBA 之 文件操作</a></li></ul></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav display="true" class="breadcrumb"><ol vocab="https://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a href="/blog/project/" property="item" typeof="WebPage" class="router-link-active"><i class="iconfont icon-folder"></i> <span property="name">项目主页</span></a> <meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem"><a href="/blog/project/Excel/" property="item" typeof="WebPage" class="router-link-active"><!----> <span property="name">Excel 笔记介绍</span></a> <meta property="position" content="2"></li><li property="itemListElement" typeof="ListItem" class="is-active"><a href="/blog/project/Excel/09.VBA_menu_toolbar/" aria-current="page" property="item" typeof="WebPage" class="router-link-exact-active router-link-active"><!----> <span property="name">VBA 之 菜单和工具栏</span></a> <meta property="position" content="3"></li></ol></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">VBA 之 菜单和工具栏</span></h1> <div class="page-info"><!----> <span aria-label="作者🖊" data-balloon-pos="down" categoryPath="/category/$category/" tagPath="/tag/$tag/"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon author-icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z" fill="currentColor"></path></svg> <span property="author">karin</span></span><span aria-label="访问量🔢" data-balloon-pos="down" defaultAuthor="karin" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="visitor-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon eye-icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 0 0-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z" fill="currentColor"></path></svg> <span id="/blog/project/Excel/09.VBA_menu_toolbar/" data-flag-title="VBA 之 菜单和工具栏" class="leancloud_visitors waline-visitor-count"><span class="leancloud-visitors-count">...</span></span></span><span aria-label="写作日期📅" data-balloon-pos="down" defaultAuthor="karin" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2021-07-02 </span></span><!----><span aria-label="标签🏷" data-balloon-pos="down" defaultAuthor="karin" categoryPath="/category/$category/"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon tag-icon"><path d="M939.902 458.563 910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 0 0 0 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z" fill="currentColor"></path></svg> <ul class="tags-wrapper"><li class="tag clickable tag0"><span role="navigation">Excel</span></li></ul> <meta property="keywords" content="Excel"></span><span aria-label="阅读时间⌛" data-balloon-pos="down" defaultAuthor="karin" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>大约 33 分钟</span> <meta property="timeRequired" content="PT33M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_79、在菜单中添加菜单项" class="anchor-link heading2"><div>79、在菜单中添加菜单项</div></a></li><li class="anchor"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_80、在菜单栏指定位置添加菜单" class="anchor-link heading2"><div>80、在菜单栏指定位置添加菜单</div></a></li><li class="anchor"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_81、屏蔽和删除工作表菜单" class="anchor-link heading2"><div>81、屏蔽和删除工作表菜单</div></a></li><li class="anchor"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_82、改变系统菜单的操作" class="anchor-link heading2"><div>82、改变系统菜单的操作</div></a></li><li class="anchor"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_83、定制自己的系统菜单" class="anchor-link heading2"><div>83、定制自己的系统菜单</div></a></li><li class="anchor"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_84、改变菜单按钮图标" class="anchor-link heading2"><div>84、改变菜单按钮图标</div></a></li><li class="anchor"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_85、右键快捷菜单增加菜单项" class="anchor-link heading2"><div>85、右键快捷菜单增加菜单项</div></a></li><li class="anchor"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_86、自定义右键快捷菜单" class="anchor-link heading2"><div>86、自定义右键快捷菜单</div></a></li><li class="anchor"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_87、使用右键菜单制作数据有效性" class="anchor-link heading2"><div>87、使用右键菜单制作数据有效性</div></a></li><li class="anchor"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_88、禁用工作表右键菜单" class="anchor-link heading2"><div>88、禁用工作表右键菜单</div></a></li><li class="anchor"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_89、创建自定义工具栏" class="anchor-link heading2"><div>89、创建自定义工具栏</div></a></li><li class="anchor"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_90、自定义工具栏按钮图标" class="anchor-link heading2"><div>90、自定义工具栏按钮图标</div></a></li><li class="anchor"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_91、自定义工作簿图标" class="anchor-link heading2"><div>91、自定义工作簿图标</div></a></li><li class="anchor"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_92、移除工作表的最小最大化和关闭按钮" class="anchor-link heading2"><div>92、移除工作表的最小最大化和关闭按钮</div></a></li><li class="anchor"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_93、在工具栏上添加下拉列表框" class="anchor-link heading2"><div>93、在工具栏上添加下拉列表框</div></a></li><li class="anchor"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_94、屏蔽工作表的复制功能" class="anchor-link heading2"><div>94、屏蔽工作表的复制功能</div></a></li><li class="anchor"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_95、禁用工具栏的自定义" class="anchor-link heading2"><div>95、禁用工具栏的自定义</div></a></li><li class="anchor"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_96、屏蔽所有的命令栏" class="anchor-link heading2"><div>96、屏蔽所有的命令栏</div></a></li><li class="anchor"><a href="/blog/project/Excel/09.VBA_menu_toolbar/#_97、恢复-excel-的命令栏" class="anchor-link heading2"><div>97、恢复 Excel 的命令栏</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h2 id="_79、在菜单中添加菜单项"><a href="#_79、在菜单中添加菜单项" class="header-anchor">#</a> 79、在菜单中添加菜单项</h2> <p>在 Excel 工作表的菜单中可以添加新的菜单项和子菜单，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> myTools<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> myTools <span class="token keyword">As</span> CommandBarPopup
	<span class="token keyword">Dim</span> myCap <span class="token keyword">As</span> <span class="token keyword">Variant</span>
	<span class="token keyword">Dim</span> myid <span class="token keyword">As</span> <span class="token keyword">Variant</span>
	<span class="token keyword">Dim</span> i <span class="token keyword">As</span> <span class="token keyword">Byte</span>
	myCap <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token string">&quot;基础应用&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;VBA程序开发&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;函数与公式&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;图表与图形&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;数据透视表&quot;</span><span class="token punctuation">)</span>
	myid <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token number">281</span><span class="token punctuation">,</span> <span class="token number">283</span><span class="token punctuation">,</span> <span class="token number">285</span><span class="token punctuation">,</span> <span class="token number">287</span><span class="token punctuation">,</span> <span class="token number">292</span><span class="token punctuation">)</span>
	<span class="token keyword">With</span> Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;Worksheet menu bar&quot;</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span>Reset
		<span class="token keyword">Set</span> myTools <span class="token operator">=</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">(</span><span class="token string">&quot;帮助(&amp;H)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlPopup<span class="token punctuation">,</span> Before<span class="token punctuation">:</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token keyword">With</span> myTools
			<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;Excel Home 技术论坛&quot;</span>
			<span class="token punctuation">.</span>BeginGroup <span class="token operator">=</span> <span class="token boolean">True</span>
			<span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">To</span> <span class="token number">5</span>
				<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">)</span>
					<span class="token punctuation">.</span>Caption <span class="token operator">=</span> myCap<span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
					<span class="token punctuation">.</span>FaceId <span class="token operator">=</span> myid<span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
					<span class="token punctuation">.</span>OnAction <span class="token operator">=</span> <span class="token string">&quot;myC&quot;</span>
			<span class="token keyword">End</span> <span class="token keyword">With</span>
			<span class="token keyword">Next</span>
		<span class="token keyword">End</span> <span class="token keyword">With</span>
	<span class="token keyword">End</span> <span class="token keyword">With</span>
	<span class="token keyword">Set</span> myTools <span class="token operator">=</span> <span class="token boolean">Nothing</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>代码解析：</p> <p>myTools 过程使用 Add 方法在 Excel 工作表菜单栏中的“帮助”菜单中添加一个标题为“Excel Home 技术论坛”的菜单项和 5 个子菜单。</p> <p>第 2 行到第 5 行代码声明变量类型。</p> <p>第 6、7 行代码使用 Array 函数创建两个数组用于保存子菜单的名称和图标 ID。</p> <p>第 9 行代码，在添加菜单项前先使用 Reset 方法重置菜单栏以免重复添加菜单项。Reset 方法重置一个内置控件，恢复该控件原来对应的动作，并将各属性恢复成初始状态，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>expression<span class="token punctuation">.</span>Reset

参数expression 是必需的，返回一个命令栏或命令栏控件对象。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>第 10 行代码，使用 Add 方法在 Excel 工作表菜单栏中的“帮助”菜单中添加菜单项。Add 方法应用于 CommandBarControls 对象时，新建一个 CommandBarControl 对象并添加到指定命令栏上的控件集合，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>expression<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">,</span> Id<span class="token punctuation">,</span> Parameter<span class="token punctuation">,</span> Before<span class="token punctuation">,</span> Temporary<span class="token punctuation">)</span>

参数expression 是必需的，返回一个CommandBarControls对象，代表命令栏中的所有控件。
参数<span class="token keyword">Type</span>是可选的，添加到指定命令栏的控件类型，可以为表格 <span class="token number">79</span><span class="token number">1</span>所列的MsoControlType常数之一。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><u>表格 79-1</u>	MsoControlType 常数</p> <table><thead><tr><th>常数</th> <th>值</th> <th>控件类型</th></tr></thead> <tbody><tr><td>msoControlButton</td> <td>1</td> <td>命令按钮</td></tr> <tr><td>msoControlEdit</td> <td>2</td> <td>文本框</td></tr> <tr><td>msoControlDropdown</td> <td>3</td> <td>下拉列表控制框</td></tr> <tr><td>msoControlComboBox</td> <td>4</td> <td>下拉组合控制框</td></tr> <tr><td>msoControlPopup</td> <td>10</td> <td>弹出式控件</td></tr></tbody></table> <p>因为在本例中将添加的是带有子菜单的菜单项，所以将参数 Type 设置为弹出式控件。</p> <p>参数 Id 是可选的，标识整数。如果将该参数设置为 1 或者忽略，将在命令栏中添加一个空的指定类型的自定义控件。</p> <p>参数 Parameter 是可选的，对于内置控件，该参数用于容器应用程序运行命令。对于自定义控件，可以使用该参数向 Visual Basic 过程传递信息，或用其存储控件信息。</p> <p>参数 Before 是可选的，表示新控件在命令栏上位置的数字。新控件将插入到该位置控件之前。如果忽略该参数，控件将添加到指定命令栏的末端。本例中将 Before 参数设置为 1，菜单项添加到“帮助”菜单的顶端。</p> <p>参数 Temporary 是可选的。设置为 True 将使添加的菜单项为临时的，在关闭应用程序时删除。默认值为 False。</p> <p>第 12 行代码，设定新添加菜单项的 Caption 属性为“Excel Home 技术论坛”。Caption 属性返回或设置命令栏控件的标题。</p> <p>第 13 行代码，设置新添加菜单项的 BeginGroup 属性为 True，分组显示。</p> <p>第 14 行到第 19 行代码，在“Excel Home 技术论坛”菜单项上添加五个子菜单并设置其 Caption 属性、FaceId 属性和 OnAction 属性。</p> <p>FaceId 属性设置出现在菜单标题左侧的图标，以数字表示，一个数字代表一个内置的图标。</p> <p>OnAction 属性设置一个 VBA 的过程名，该过程在用户单击子菜单时运行，本例中设置为下面的过程。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Public</span> <span class="token keyword">Sub</span> myC<span class="token punctuation">(</span><span class="token punctuation">)</span>
	MsgBox <span class="token string">&quot;您选择了： &quot;</span> <span class="token operator">&amp;</span> Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">.</span>ActionControl<span class="token punctuation">.</span>Caption
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>代码解析：</p> <p>myC 过程是单击新添加子菜单所运行过程，为了演示方便在这里只使用 MsgBox 函数显示所其 Caption 属性。</p> <p>删除新添加的菜单项及子菜单的代码如下所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> DelmyTools<span class="token punctuation">(</span><span class="token punctuation">)</span>
	Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;Worksheet menu bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Reset
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>代码解析：</p> <p>DelmyTools 过程使用 Reset 方法重置菜单栏，删除添加的菜单项及子菜单。</p> <p>为了在打开工作簿时自动添加菜单项，需要在工作簿的 Activate 事件中调用 myTools 过程，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Private</span> <span class="token keyword">Sub</span> Workbook_Activate<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Call</span> myTools
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>为了在关闭工作簿时删除新添加的菜单项，还需要在工作簿的 Deactivate 事件中调用 DelmyTools 过程，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Private</span> <span class="token keyword">Sub</span> Workbook_Deactivate<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Call</span> DelmyTools
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果希望这个菜单为所有工作簿使用，那么就应该在工作簿的 Open 事件中调用 myTools 过程，在 BeforeClose 事件中调用 DelmyTools 过程。</p> <p>运行 myTools 过程，将在 Excel 工作表菜单栏中的“帮助”菜单中添加一个名为“Excel Home 技术论坛”的菜单项及五个子菜单，如图 79-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/79-1.d90137d0.png" alt="" loading="lazy"></p> <p><u>图 79-1</u>	在“帮助”菜单中添加菜单项及子菜单</p></div> <h2 id="_80、在菜单栏指定位置添加菜单"><a href="#_80、在菜单栏指定位置添加菜单" class="header-anchor">#</a> 80、在菜单栏指定位置添加菜单</h2> <p>除了可以在工作表菜单中添加菜单项外，还可以在工作表菜单栏的指定位置添加菜单，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> AddNewMenu<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> HelpMenu <span class="token keyword">As</span> CommandBarControl
	<span class="token keyword">Dim</span> NewMenu <span class="token keyword">As</span> CommandBarPopup
	<span class="token keyword">With</span> Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;Worksheet menu bar&quot;</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span>Reset
		<span class="token keyword">Set</span> HelpMenu <span class="token operator">=</span> <span class="token punctuation">.</span>FindControl<span class="token punctuation">(</span>ID<span class="token punctuation">:</span><span class="token operator">=</span><span class="token punctuation">.</span>Controls<span class="token punctuation">(</span><span class="token string">&quot;帮助(&amp;H)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ID<span class="token punctuation">)</span>
		<span class="token keyword">If</span> HelpMenu <span class="token keyword">Is</span> <span class="token boolean">Nothing</span> <span class="token keyword">Then</span>
			<span class="token keyword">Set</span> NewMenu <span class="token operator">=</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlPopup<span class="token punctuation">)</span>
		<span class="token keyword">Else</span>
			<span class="token keyword">Set</span> NewMenu <span class="token operator">=</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlPopup<span class="token punctuation">,</span> <span class="token operator">_</span>
				Before<span class="token punctuation">:</span><span class="token operator">=</span>HelpMenu<span class="token punctuation">.</span>Index<span class="token punctuation">)</span>
		<span class="token keyword">End</span> <span class="token keyword">If</span>
		<span class="token keyword">With</span> NewMenu
			<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;统计(&amp;S)&quot;</span>
			<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">)</span>
				<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;输入数据(&amp;D)&quot;</span>
				<span class="token punctuation">.</span>FaceId <span class="token operator">=</span> <span class="token number">162</span>
				<span class="token punctuation">.</span>OnAction <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
			<span class="token keyword">End</span> <span class="token keyword">With</span>
			<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">)</span>
				<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;汇总数据(&amp;T)&quot;</span>
				<span class="token punctuation">.</span>FaceId <span class="token operator">=</span> <span class="token number">590</span>
				<span class="token punctuation">.</span>OnAction <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
			<span class="token keyword">End</span> <span class="token keyword">With</span>
		<span class="token keyword">End</span> <span class="token keyword">With</span>
	<span class="token keyword">End</span> <span class="token keyword">With</span>
	<span class="token keyword">Set</span> HelpMenu <span class="token operator">=</span> <span class="token boolean">Nothing</span>
	<span class="token keyword">Set</span> NewMenu <span class="token operator">=</span> <span class="token boolean">Nothing</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>代码解析：</p> <p>AddNewMenu 过程使用 Add 方法在工作表“帮助”菜单前添加一个标题为“统计”的菜单和两个菜单项。</p> <p>第 6 行代码，使用 FindControl 方法在工作表菜单栏中查找“帮助”菜单。应用于 CommandBars 对象的 FindControl 方法返回一个符合指定条件的 CommandBarControl 对象。语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>expression<span class="token punctuation">.</span>FindControl<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">,</span> Id<span class="token punctuation">,</span> Tag<span class="token punctuation">,</span> Visible<span class="token punctuation">,</span> Recursive<span class="token punctuation">)</span>

参数expression是必需的，返回一个CommandBars对象。
参数<span class="token keyword">Type</span>是可选的，要查找控件的类型。
参数Id是可选的，要查找控件的标识符。
参数Tag是可选的，要查找控件的标记值。
参数Visible是可选，如果该值为<span class="token boolean">True</span>，那么只查找屏幕上显示的命令栏控件。默认值为<span class="token boolean">False</span>。
参数Recursive是可选的，如果该值为<span class="token boolean">True</span>，那么将在命令栏及其全部弹出式子工具栏中查找。此参数仅应用于CommandBar对象。默认值为<span class="token boolean">False</span>。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>如果没有控件符合搜索条件，那么 FindControl 方法返回 Nothing。</p> <p>第 7 行到第 12 行代码，如果工作表菜单栏中存在“帮助”菜单，将“统计”菜单添加到“帮助”菜单之前，否则添加到工作表菜单栏末尾。</p> <p>第 12 行到第 25 行代码，在“统计”菜单中添加两个子菜单并设置其各种属性。</p> <p>运行 AddNewMenu 过程，将在工作表菜单栏的“帮助”菜单之前添加一个“统计”菜单，如图 80-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/80-1.10092cb7.png" alt="" loading="lazy"></p> <p><u>图 80-1</u>	在工作表菜单栏中添加菜单</p></div> <h2 id="_81、屏蔽和删除工作表菜单"><a href="#_81、屏蔽和删除工作表菜单" class="header-anchor">#</a> 81、屏蔽和删除工作表菜单</h2> <p>如果不希望用户使用工作表菜单栏的部分功能，可以把菜单或菜单项屏蔽或删除，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> Shibar<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">With</span> Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;Worksheet menu bar&quot;</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span>Reset
		<span class="token punctuation">.</span>Controls<span class="token punctuation">(</span><span class="token string">&quot;工具(&amp;T)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Controls<span class="token punctuation">(</span><span class="token string">&quot;宏(&amp;M)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">False</span>
		<span class="token punctuation">.</span>Controls<span class="token punctuation">(</span><span class="token string">&quot;数据(&amp;D)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Delete
	<span class="token keyword">End</span> <span class="token keyword">With</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>代码解析：</p> <p>Shibar 过程屏蔽 “工具”菜单中的“宏”菜单项，删除菜单栏中的“数据”菜单。</p> <p>第 3 行代码，使用 Reset 方法重置工作表菜单栏。</p> <p>第 4 行代码，将“宏”菜单项的 Enabled 属性设置为 False，使之无效。</p> <p>Enabled 属性决定命令栏或命令栏控件是否激活，如果将该属性设置为 False，那么该菜单项将无效。</p> <p>第 5 行代码，使用 Delete 方法将“数据”菜单从工作表菜单栏中删除。</p> <p>Delete 方法应用于命令栏或命令栏控件时，从集合中删除指定对象，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>expression<span class="token punctuation">.</span>Delete<span class="token punctuation">(</span>Temporary<span class="token punctuation">)</span>

参数expression是必需的，返回命令栏或命令栏控件对象之一。
参数Temporary是可选的，设置为<span class="token boolean">True</span>将从当前会话中删除控件，应用程序在下次会话时将再次显示控件。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>运行 Shibar 过程，将屏蔽工作表“工具”菜单中的“宏”菜单项和删除工作表菜单栏中的“数据”菜单，如图 81-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/81-1.d272d2cd.png" alt="" loading="lazy"></p> <p><u>图 81-1</u>	屏蔽和删除工作表菜单</p></div> <h2 id="_82、改变系统菜单的操作"><a href="#_82、改变系统菜单的操作" class="header-anchor">#</a> 82、改变系统菜单的操作</h2> <p>利用 VBA 甚至可以改变系统菜单的默认操作，使之达到自定义菜单的效果，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Dim</span> <span class="token keyword">WithEvents</span> Saveas <span class="token keyword">As</span> CommandBarButton
<span class="token keyword">Private</span> <span class="token keyword">Sub</span> Workbook_Open<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Set</span> Saveas <span class="token operator">=</span> Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;File&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Controls<span class="token punctuation">(</span><span class="token string">&quot;另存为(&amp;A)...&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
<span class="token keyword">Private</span> <span class="token keyword">Sub</span> Saveas_Click<span class="token punctuation">(</span><span class="token keyword">ByVal</span> Ctrl <span class="token keyword">As</span> Office<span class="token punctuation">.</span>CommandBarButton<span class="token punctuation">,</span> CancelDefault <span class="token keyword">As</span> <span class="token keyword">Boolean</span><span class="token punctuation">)</span>
	CancelDefault <span class="token operator">=</span> <span class="token boolean">True</span>
	MsgBox <span class="token string">&quot;本工作簿禁止另存!&quot;</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>代码解析：</p> <p>第 1 行代码，在模块级别中使用关键词 WithEvents 声明变量 Saveas 是用来响应由 CommandBarButton 对象触发事件的对象变量。</p> <p>第 2 行到第 4 代码工作簿的 Open 事件过程，在工作簿打开时将变量 Saveas 赋值为系统菜单的“另存为”菜单。</p> <p>因为在声明变量 Saveas 时使用了关键词 WithEvents，不能同时使用 New 关键词隐式地创建对象，所以在使用变量 Saveas 之前，必须使用 Set 语句将变量赋值为一个已有对象。</p> <p>第 5 行到第 8 代码变量 Saveas 的单击事件过程，改变系统菜单“另存为”的默认操作。</p> <p>变量 Saveas 的 Click 事件在用户单击系统菜单“另存为”时发生，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Private</span> <span class="token keyword">Sub</span> CommandBarButton_Click<span class="token punctuation">(</span><span class="token keyword">ByVal</span> Ctrl <span class="token keyword">As</span> CommandBarButton<span class="token punctuation">,</span><span class="token keyword">ByVal</span> CancelDefault <span class="token keyword">As</span> <span class="token keyword">Boolean</span><span class="token punctuation">)</span>

参数Ctrl是必需的，指示初始化该事件的CommandBarButton控件。
参数CancelDefault是必需的，<span class="token keyword">Boolean</span>类型，如果执行了与CommandBarButton控件关联的默认操作，该值为<span class="token boolean">False</span>。除非其他过程或加载项取消了此操作。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>第 6、7 行代码，将 CancelDefault 参数设置为 True，使单击“另存为”菜单时并不执行默认操作而只显示一个消息框。</p> <p>将工作簿保存、关闭后，重新打开，单击“另存为”菜单并不执行默认操作，只显示一个消息框，如图 82-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/82-1.06a89765.png" alt="" loading="lazy"></p> <p><u>图 82-1</u>	改变系统菜单的默认操作</p></div> <h2 id="_83、定制自己的系统菜单"><a href="#_83、定制自己的系统菜单" class="header-anchor">#</a> 83、定制自己的系统菜单</h2> <p>使用 VBA 开发的小型应用系统完成后，Excel 原有的菜单栏完全可以舍弃不用，只使用自定义的菜单栏，更加方便快捷，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> AddNowBar<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> NewBar <span class="token keyword">As</span> CommandBar
	<span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">Resume</span> <span class="token keyword">Next</span>
	<span class="token keyword">With</span> Application
		<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;Standard&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Visible <span class="token operator">=</span> <span class="token boolean">False</span> 
		<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;Formatting&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Visible <span class="token operator">=</span> <span class="token boolean">False</span> 
		<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;Stop Recording&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Visible <span class="token operator">=</span> <span class="token boolean">False</span>
		<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;toolbar list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">False</span>
		<span class="token punctuation">.</span>CommandBars<span class="token punctuation">.</span>DisableAskAQuestionDropdown <span class="token operator">=</span> <span class="token boolean">True</span>
		<span class="token punctuation">.</span>DisplayFormulaBar <span class="token operator">=</span> <span class="token boolean">False</span> 
		<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;NewBar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Delete
	<span class="token keyword">End</span> <span class="token keyword">With</span>
	<span class="token keyword">Set</span> NewBar <span class="token operator">=</span> Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">.</span>Add<span class="token punctuation">(</span>Name<span class="token punctuation">:</span><span class="token operator">=</span><span class="token string">&quot;NewBar&quot;</span><span class="token punctuation">,</span> Position<span class="token punctuation">:</span><span class="token operator">=</span>msoBarTop<span class="token punctuation">,</span> MenuBar<span class="token punctuation">:</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> Temporary<span class="token punctuation">:</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
	<span class="token keyword">With</span> NewBar
		<span class="token punctuation">.</span>Visible <span class="token operator">=</span> <span class="token boolean">True</span>
		<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlPopup<span class="token punctuation">)</span>
			<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;系统设置(&amp;X)&quot;</span>
			<span class="token punctuation">.</span>BeginGroup <span class="token operator">=</span> <span class="token boolean">True</span>
			<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">)</span>
				<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;保存(&amp;S)&quot;</span>
				<span class="token punctuation">.</span>BeginGroup <span class="token operator">=</span> <span class="token boolean">True</span>
				<span class="token punctuation">.</span>FaceId <span class="token operator">=</span> <span class="token number">1975</span>
			<span class="token keyword">End</span> <span class="token keyword">With</span>
			<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">)</span>
				<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;备份(&amp;B)&quot;</span>
				<span class="token punctuation">.</span>BeginGroup <span class="token operator">=</span> <span class="token boolean">True</span>
				<span class="token punctuation">.</span>FaceId <span class="token operator">=</span> <span class="token number">747</span>
			<span class="token keyword">End</span> <span class="token keyword">With</span>
		<span class="token keyword">End</span> <span class="token keyword">With</span>
		<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlPopup<span class="token punctuation">)</span>
			<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;会计凭证(&amp;P)&quot;</span>
			<span class="token punctuation">.</span>BeginGroup <span class="token operator">=</span> <span class="token boolean">True</span>
			<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">)</span>
				<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;录入(&amp;L)&quot;</span>
				<span class="token punctuation">.</span>BeginGroup <span class="token operator">=</span> <span class="token boolean">True</span>
				<span class="token punctuation">.</span>FaceId <span class="token operator">=</span> <span class="token number">197</span>
			<span class="token keyword">End</span> <span class="token keyword">With</span>
			<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">)</span>
				<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;审核(&amp;S)&quot;</span>
				<span class="token punctuation">.</span>BeginGroup <span class="token operator">=</span> <span class="token boolean">True</span>
				<span class="token punctuation">.</span>FaceId <span class="token operator">=</span> <span class="token number">714</span>
			<span class="token keyword">End</span> <span class="token keyword">With</span>
		<span class="token keyword">End</span> <span class="token keyword">With</span>
		<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlPopup<span class="token punctuation">)</span>
			<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;会计账簿(&amp;Z)&quot;</span>
			<span class="token punctuation">.</span>BeginGroup <span class="token operator">=</span> <span class="token boolean">True</span>
			<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">)</span>
				<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;记账(&amp;L)&quot;</span>
				<span class="token punctuation">.</span>BeginGroup <span class="token operator">=</span> <span class="token boolean">True</span>
				<span class="token punctuation">.</span>FaceId <span class="token operator">=</span> <span class="token number">65</span>
			<span class="token keyword">End</span> <span class="token keyword">With</span>
			<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">)</span>
				<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;结账(&amp;S)&quot;</span>
				<span class="token punctuation">.</span>BeginGroup <span class="token operator">=</span> <span class="token boolean">True</span>
				<span class="token punctuation">.</span>FaceId <span class="token operator">=</span> <span class="token number">47</span>
			<span class="token keyword">End</span> <span class="token keyword">With</span>
		<span class="token keyword">End</span> <span class="token keyword">With</span>
		<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlPopup<span class="token punctuation">)</span>
			<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;会计报表(&amp;B)&quot;</span>
			<span class="token punctuation">.</span>BeginGroup <span class="token operator">=</span> <span class="token boolean">True</span>
			<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlPopup<span class="token punctuation">)</span>
				<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;资产负债表(&amp;Y)&quot;</span>
				<span class="token punctuation">.</span>BeginGroup <span class="token operator">=</span> <span class="token boolean">True</span>
				<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">)</span>
					<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;月报(&amp;M)&quot;</span>
					<span class="token punctuation">.</span>BeginGroup <span class="token operator">=</span> <span class="token boolean">True</span>
					<span class="token punctuation">.</span>FaceId <span class="token operator">=</span> <span class="token number">1180</span>
				<span class="token keyword">End</span> <span class="token keyword">With</span>
					<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">)</span>
						<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;年报(&amp;Y)&quot;</span>
						<span class="token punctuation">.</span>BeginGroup <span class="token operator">=</span> <span class="token boolean">True</span>
						<span class="token punctuation">.</span>FaceId <span class="token operator">=</span> <span class="token number">1188</span>
					<span class="token keyword">End</span> <span class="token keyword">With</span>
				<span class="token keyword">End</span> <span class="token keyword">With</span>
			<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlPopup<span class="token punctuation">)</span>
				<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;损益表(&amp;S)&quot;</span>
				<span class="token punctuation">.</span>BeginGroup <span class="token operator">=</span> <span class="token boolean">True</span>
				<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">)</span>
					<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;月报(&amp;M)&quot;</span>
					<span class="token punctuation">.</span>BeginGroup <span class="token operator">=</span> <span class="token boolean">True</span>
					<span class="token punctuation">.</span>FaceId <span class="token operator">=</span> <span class="token number">1180</span>
				<span class="token keyword">End</span> <span class="token keyword">With</span>
				<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">)</span>
					<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;年报(&amp;Y)&quot;</span>
					<span class="token punctuation">.</span>BeginGroup <span class="token operator">=</span> <span class="token boolean">True</span>
					<span class="token punctuation">.</span>FaceId <span class="token operator">=</span> <span class="token number">1188</span>
				<span class="token keyword">End</span> <span class="token keyword">With</span>
			<span class="token keyword">End</span> <span class="token keyword">With</span>
		<span class="token keyword">End</span> <span class="token keyword">With</span>
		<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">)</span>
			<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;退出系统(&amp;C)&quot;</span>
			<span class="token punctuation">.</span>BeginGroup <span class="token operator">=</span> <span class="token boolean">True</span>
			<span class="token punctuation">.</span>Style <span class="token operator">=</span> msoButtonCaption
		<span class="token keyword">End</span> <span class="token keyword">With</span>
	<span class="token keyword">End</span> <span class="token keyword">With</span>
	<span class="token keyword">Set</span> NewBar <span class="token operator">=</span> <span class="token boolean">Nothing</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br></div></div><p>代码解析：</p> <p>AddNowBar 过程使用 Add 方法创建自定义菜单栏替换工作表菜单栏。</p> <p>第 2 行代码定义变量 NwBar 为命令栏。</p> <p>第 3 行代码忽略错误语句，以免第 11 行代码在删除可能不存在的“NewBar”菜单栏时发生错误。</p> <p>第 5 行代码隐藏“常用”工具栏。</p> <p>第 6 行代码隐藏“格式”工具栏。</p> <p>第 7 行代码隐藏“停止录制”工具栏。</p> <p>第 8 行代码屏蔽工具栏的右键快捷菜单。</p> <p>第 9 行代码屏蔽工具栏的“键入需要帮助的问题”下拉框。</p> <p>第 10 行代码屏蔽工具栏的编辑栏。</p> <p>第 11 行代码，在添加命令栏前先删除“NewBar”菜单栏，以免重复增加。</p> <p>第 13 行代码，使用 Add 方法创建命令栏。Add 方法应用于 CommandBars 对象的语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>expression<span class="token punctuation">.</span>Add<span class="token punctuation">(</span>Name<span class="token punctuation">,</span> Position<span class="token punctuation">,</span> MenuBar<span class="token punctuation">,</span> Temporary<span class="token punctuation">)</span>

参数expression是必需的，返回一个CommandBars对象，该对象代表应用程序中的命令栏，新建命令栏的控件均以该对象为载体。
参数Name是可选的，设置新建命令栏的标题。如果忽略该参数，则为新建命令栏指定默认标题，本例中设置新建命令栏的标题为<span class="token string">“NewBar”</span>。
参数Position是可选的，设置新建命令栏的位置或类型，可以为表格 <span class="token number">83</span><span class="token number">1</span>所列的 MsoBarPosition常数之一。
参数MenuBar是可选的，设置为<span class="token boolean">True</span> 将以新命令栏替换活动菜单栏，默认值为<span class="token boolean">False</span>。
参数Temporary是可选的，设置为<span class="token boolean">True</span>将使新建命令栏为临时命令栏，在关闭应用程序时删除，默认值为<span class="token boolean">False</span>。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><u>表格 83-1</u>	MsoBarPosition 常数</p> <table><thead><tr><th>常数</th> <th>说明</th></tr></thead> <tbody><tr><td>msoBarLeft、msoBarTop、msoBarRight 和 msoBarBottom</td> <td>指定新命令栏的左侧、顶部、右侧和底部坐标</td></tr> <tr><td>msoBarFloating</td> <td>指定新命令栏不固定</td></tr> <tr><td>msoBarPopup</td> <td>指定新命令栏为快捷菜单</td></tr> <tr><td>msoBarMenuBar</td> <td>仅适用于 Macintosh 机</td></tr></tbody></table> <p>本例中设置“NewBar”命令栏的 Position 参数为 msoBarTop，使“NewBar”命令栏位于 Excel 窗口的顶部。</p> <p>在本例中，设置“NewBar”命令栏的 MenuBar 属性为 True，以“NewBar”命令栏替换活动菜单栏。</p> <p>在本例中，设置“NewBar”命令栏的 Temporary 属性为 True，使“NewBar”命令栏为临时命令栏，在关闭应用程序时删除。</p> <p>第 15 行代码，设置“NewBar”命令栏为可见的。</p> <p>第 16 行到 95 行代码，使用 Add 方法在“NewBar”命令栏中添加菜单、菜单项及子菜单并设置其各项属性，参阅 79 。</p> <p>恢复 Excel 原有的菜单栏的代码如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> DelNowBar<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">Resume</span> <span class="token keyword">Next</span>
	<span class="token keyword">With</span> Application
		<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;Standard&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Visible <span class="token operator">=</span> <span class="token boolean">True</span>
		<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;Formatting&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Visible <span class="token operator">=</span> <span class="token boolean">True</span>
		<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;Stop Recording&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Visible <span class="token operator">=</span> <span class="token boolean">True</span>
		<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;toolbar list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">True</span>
		<span class="token punctuation">.</span>CommandBars<span class="token punctuation">.</span>DisableAskAQuestionDropdown <span class="token operator">=</span> <span class="token boolean">False</span>
		<span class="token punctuation">.</span>DisplayFormulaBar <span class="token operator">=</span> <span class="token boolean">True</span>
		<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;NewBar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Delete
	<span class="token keyword">End</span> <span class="token keyword">With</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>代码解析：</p> <p>DelNowBar 过程取消 “常用”、“格式”和“停止录制”工具栏的的隐藏，恢复“键入需要帮助的问题”下拉框和编辑栏，删除“NewBar”命令栏。</p> <p>运行 AddNowBar 过程，工作表菜单栏如图 83-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/83-1.9b15ded1.png" alt="" loading="lazy"></p> <p><u>图 83-1</u>	定制自己的系统菜单</p></div> <h2 id="_84、改变菜单按钮图标"><a href="#_84、改变菜单按钮图标" class="header-anchor">#</a> 84、改变菜单按钮图标</h2> <p>利用 VBA 可以改变系统菜单的默认图标，使之达到自定义按钮图标的效果，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> myCbarCnt<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> myCbarCnt <span class="token keyword">As</span> CommandBarControl
	<span class="token keyword">With</span> Sheet1<span class="token punctuation">.</span>Shapes<span class="token punctuation">.</span>AddShape<span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span>Fill<span class="token punctuation">.</span>ForeColor<span class="token punctuation">.</span>SchemeColor <span class="token operator">=</span> <span class="token number">29</span>
		<span class="token punctuation">.</span>CopyPicture
		<span class="token punctuation">.</span>Delete
	<span class="token keyword">End</span> <span class="token keyword">With</span>
	<span class="token keyword">Set</span> myCbarCnt <span class="token operator">=</span> Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;Standard&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Controls<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	myCbarCnt<span class="token punctuation">.</span>PasteFace
	<span class="token keyword">Set</span> myCbarCnt <span class="token operator">=</span> <span class="token boolean">Nothing</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
<span class="token keyword">Sub</span> DelmyCbarCnt<span class="token punctuation">(</span><span class="token punctuation">)</span>
	Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;Standard&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Controls<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Reset
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>代码解析：</p> <p>myCbarCnt 过程改变系统菜单的“新建”按钮的图标。</p> <p>第 3 行代码使用 Shape 对象的 AddShape 方法在工作表中新建一个自选图形。应用于 Shape 对象的 AddShape 方法请参阅 53 。</p> <p>在本例中将新建图形的 Left 参数和 Top 参数设置为较大的数值使新建的自选图形不在当前窗口的可视区域内。</p> <p>第 4 行代码设置新建自选图形的颜色。</p> <p>第 5 行代码使用 CopyPicture 方法将新建自选图形作为图片复制到剪贴板。CopyPicture 方法的语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>expression<span class="token punctuation">.</span>CopyPicture<span class="token punctuation">(</span>Appearance<span class="token punctuation">,</span> Format<span class="token punctuation">)</span>

参数expression是必需的，一个有效的对象。
参数Appearance是可选的，指定图片的复制方式。
参数Format是可选的，图片的格式。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>第 6 行代码使用 Delete 方法删除新建的自选图形。</p> <p>第 8 行代码使用 Set 语句将系统菜单的“新建”按钮赋给变量 myCbarCnt。</p> <p>第 9 行代码 PasteFace 方法将新建的自选图形粘贴到“新建”按钮中。PasteFace 方法将“剪贴板”的内容粘贴到指定命令栏按钮控件上，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>expression<span class="token punctuation">.</span>PasteFace

参数expression是必需的，返回一个CommandBarButton对象。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>DelmyCbarCnt 过程使用 Reset 方法恢复“新建”按钮的默认图标。</p> <p>运行 myCbarCnt 过程结果如图 84-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/84-1.93950fb9.png" alt="" loading="lazy"></p> <p><u>图 84-1</u>	定制自己的系统菜单</p></div> <h2 id="_85、右键快捷菜单增加菜单项"><a href="#_85、右键快捷菜单增加菜单项" class="header-anchor">#</a> 85、右键快捷菜单增加菜单项</h2> <p>在 Excel 的右键快捷菜单中可以添加新的菜单项，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> MyCmb<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> MyCmb <span class="token keyword">As</span> CommandBarButton
	<span class="token keyword">With</span> Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;Cell&quot;</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span>Reset
		<span class="token keyword">Set</span> MyCmb <span class="token operator">=</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">,</span> <span class="token operator">_</span>
			ID<span class="token punctuation">:</span><span class="token operator">=</span><span class="token number">2521</span><span class="token punctuation">,</span> Before<span class="token punctuation">:</span><span class="token operator">=</span><span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Count<span class="token punctuation">,</span> Temporary<span class="token punctuation">:</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
			MyCmb<span class="token punctuation">.</span>BeginGroup <span class="token operator">=</span> <span class="token boolean">True</span>
		<span class="token keyword">End</span> <span class="token keyword">With</span>
	<span class="token keyword">Set</span> MyCmb <span class="token operator">=</span> <span class="token boolean">Nothing</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>代码解析：</p> <p>MyCmb 过程使用 Add 方法在 Excel 的右键快捷菜单中添加内置的“打印”菜单项。</p> <p>在使用 Add 方法添加菜单项时将 Id 参数设置为 2521，添加的就是内置的“打印”菜单项。将 Before 属性设置成右键快捷菜单中最后一个控件的值，使“打印”菜单项添加到右键快捷菜单中最后一个控件之前。将 Temporary 参数设置成 True，在关闭应用程序时从右键快捷菜单中删除“打印”菜单项。</p> <p>运行 MyCmb 过程，将在 Excel 右键快捷菜单中添加 “打印”菜单项，如图 85-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/85-1.3844c5ef.png" alt="" loading="lazy"></p> <p><u>图 85-1</u>	在右键快捷菜单中添加菜单项</p></div> <h2 id="_86、自定义右键快捷菜单"><a href="#_86、自定义右键快捷菜单" class="header-anchor">#</a> 86、自定义右键快捷菜单</h2> <p>在工作表中创建自定义的右键快捷菜单替换 Excel 默认的右键快捷菜单，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> Mycell<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">With</span> Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token string">&quot;Mycell&quot;</span><span class="token punctuation">,</span> msoBarPopup<span class="token punctuation">)</span>
		<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">)</span>
			<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;会计凭证&quot;</span>
			<span class="token punctuation">.</span>FaceId <span class="token operator">=</span> <span class="token number">9893</span>
		<span class="token keyword">End</span> <span class="token keyword">With</span>
		<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">)</span>
			<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;会计账簿&quot;</span>
			<span class="token punctuation">.</span>FaceId <span class="token operator">=</span> <span class="token number">284</span>
		<span class="token keyword">End</span> <span class="token keyword">With</span>
		<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlPopup<span class="token punctuation">)</span>
			<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;会计报表&quot;</span>
			<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">)</span>
				<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;月报&quot;</span>
				<span class="token punctuation">.</span>FaceId <span class="token operator">=</span> <span class="token number">9590</span>
			<span class="token keyword">End</span> <span class="token keyword">With</span>
			<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">)</span>
				<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;季报&quot;</span>
				<span class="token punctuation">.</span>FaceId <span class="token operator">=</span> <span class="token number">9591</span>
			<span class="token keyword">End</span> <span class="token keyword">With</span>
			<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">)</span>
				<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;年报&quot;</span>
				<span class="token punctuation">.</span>FaceId <span class="token operator">=</span> <span class="token number">9592</span>
			<span class="token keyword">End</span> <span class="token keyword">With</span>
		<span class="token keyword">End</span> <span class="token keyword">With</span>
		<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">)</span>
			<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;凭证打印&quot;</span>
			<span class="token punctuation">.</span>FaceId <span class="token operator">=</span> <span class="token number">9614</span>
			<span class="token punctuation">.</span>BeginGroup <span class="token operator">=</span> <span class="token boolean">True</span>
		<span class="token keyword">End</span> <span class="token keyword">With</span>
		<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">)</span>
			<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;账簿打印&quot;</span>
			<span class="token punctuation">.</span>FaceId <span class="token operator">=</span> <span class="token number">707</span>
		<span class="token keyword">End</span> <span class="token keyword">With</span>
		<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">)</span>
			<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;报表打印&quot;</span>
			<span class="token punctuation">.</span>FaceId <span class="token operator">=</span> <span class="token number">986</span>
		<span class="token keyword">End</span> <span class="token keyword">With</span>
	<span class="token keyword">End</span> <span class="token keyword">With</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>代码解析：</p> <p>Mycell 过程在 Excel 工作表中创建自定义的右键快捷菜单。</p> <p>第 2 行代码，使用 Add 方法添加名称为“Mycell”命令栏，设置“Mycell”命令栏的 Position 属性为 msoBarPopup，使“Mycell”命令栏为快捷菜单。关于 Position 参数的 MsoBarPosition 常数请参阅 83 中的表格 83-1。</p> <p>第 3 行到第 39 行代码，使用 Add 方法在“Mycell”命令栏中添加菜单和菜单项，并设置其各项属性。</p> <p>为了让自定义右键快捷菜单替换 Excel 默认的右键快捷菜单，并且只在右键单击 Sheet1 工作表时显示，需要在 Sheet1 工作表的 BeforeRightClick 事件中写入下面的代码。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Private</span> <span class="token keyword">Sub</span> Worksheet_BeforeRightClick<span class="token punctuation">(</span><span class="token keyword">ByVal</span> Target <span class="token keyword">As</span> Range<span class="token punctuation">,</span> Cancel <span class="token keyword">As</span> <span class="token keyword">Boolean</span><span class="token punctuation">)</span>
	Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;Mycell&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ShowPopup
	Cancel <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>代码解析：</p> <p>工作表的 BeforeRightClick 事件过程，在右键单击工作表时，将“Mycell”命令栏作为右键快捷菜单，在当前光标位置显示。</p> <p>工作表 BeforeRightClick 事件语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Private</span> <span class="token keyword">Sub</span> expression_BeforeRightClick<span class="token punctuation">(</span><span class="token keyword">ByVal</span> Target <span class="token keyword">As</span> Range<span class="token punctuation">,</span> Cancel <span class="token keyword">As</span> <span class="token keyword">Boolean</span><span class="token punctuation">)</span>

参数expression是必需的，Worksheet类型对象。
参数Target 是可选的，右键单击发生时最靠近鼠标指针的单元格。
参数Cancel是可选的，当事件发生时为<span class="token boolean">False</span>。如果在事件过程中将Cancel参数设为<span class="token boolean">True</span>，则该过程执行结束之后不进行默认的右键单击操作。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>第 2 行代码，使用 ShowPopup 方法将“Mycell”命令栏作为右键快捷菜单，在当前光标位置显示。</p> <p>ShowPopup 方法的语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>expression<span class="token punctuation">.</span>ShowPopup<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>

参数expression是必需的，返回一个CommandBar对象。
参数x是可选的，快捷菜单所在位置的 x 坐标。如果省略此参数，将使用当前光标位置的x坐标。
参数y是可选的，快捷菜单所在位置的y坐标。如果省略此参数，将使用当前光标位置的y坐标。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>当用鼠标右键单击工作表中任意单元格时激活 BeforeRightClick 事件，此事件先于默认的右键单击操作。在使用 ShowPopup 方法显示“Mycell”命令栏后，将 Cancel 参数设置为 True，过程执行结束之后不进行默认的右键单击操作，Excel 右键快捷菜单就不会显示。</p> <p>运行 Mycell 过程后，右键单击 Sheet1 工作表，在工作表中显示自定义右键快捷菜单，如图 86-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/86-1.8f7995da.png" alt="" loading="lazy"></p> <p><u>图 86-1</u>	自定义右键快捷菜单</p></div> <h2 id="_87、使用右键菜单制作数据有效性"><a href="#_87、使用右键菜单制作数据有效性" class="header-anchor">#</a> 87、使用右键菜单制作数据有效性</h2> <p>在工作表中输入数据时可以使用自定义右键菜单制作数据有效性，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> Mycell<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> arr <span class="token keyword">As</span> <span class="token keyword">Variant</span>
	<span class="token keyword">Dim</span> i <span class="token keyword">As</span> <span class="token keyword">Integer</span>
	<span class="token keyword">Dim</span> Mycell <span class="token keyword">As</span> CommandBar
	<span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">Resume</span> <span class="token keyword">Next</span>
	Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;Mycell&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Delete
	arr <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token string">&quot;经理室&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;办公室&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;生技科&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;财务科&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;营业部&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">Set</span> Mycell <span class="token operator">=</span> Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token string">&quot;Mycell&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
	<span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">To</span> <span class="token number">4</span>
		<span class="token keyword">With</span> Mycell<span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span>Caption <span class="token operator">=</span> arr<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
			<span class="token punctuation">.</span>OnAction <span class="token operator">=</span> <span class="token string">&quot;MyOnAction&quot;</span>
		<span class="token keyword">End</span> <span class="token keyword">With</span>
	<span class="token keyword">Next</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
<span class="token keyword">Sub</span> MyOnAction<span class="token punctuation">(</span><span class="token punctuation">)</span>
	ActiveCell <span class="token operator">=</span> Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">.</span>ActionControl<span class="token punctuation">.</span>Caption
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>代码解析：</p> <p>Mycell 过程创建自定义的右键菜单，请参阅 86 。</p> <p>MyOnAction 过程是点击自定义右键菜单所运行的过程，将所选右键菜单的名称写入活动单元格。</p> <p>为了使自定义的右键菜单在 Sheet1 工作表的特定区域中显示，需要在 VBE 中双击 Sheet1 表后写入下面的代码。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Private</span> <span class="token keyword">Sub</span> Worksheet_BeforeRightClick<span class="token punctuation">(</span><span class="token keyword">ByVal</span> Target <span class="token keyword">As</span> Range<span class="token punctuation">,</span> Cancel <span class="token keyword">As</span> <span class="token keyword">Boolean</span><span class="token punctuation">)</span>
	<span class="token keyword">If</span> Target<span class="token punctuation">.</span>Column <span class="token operator">=</span> <span class="token number">2</span> <span class="token keyword">Then</span>
		<span class="token keyword">Call</span> Mycell
		Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;Mycell&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ShowPopup
		Cancel <span class="token operator">=</span> <span class="token boolean">True</span>
	<span class="token keyword">End</span> <span class="token keyword">If</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>代码解析：</p> <p>工作表的 BeforeRightClick 事件过程，在右键单击工作表时，将“Mycell”命令栏作为右键快捷菜单，在当前光标位置显示，请参阅 86 。</p> <p>在工作表的 B 列中点击右键结果如图 87-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/87-1.ee790729.png" alt="" loading="lazy"></p> <p><u>图 87-1</u>	使用右键菜单制作数据有效性</p></div> <h2 id="_88、禁用工作表右键菜单"><a href="#_88、禁用工作表右键菜单" class="header-anchor">#</a> 88、禁用工作表右键菜单</h2> <p>有时并不希望用户使用工作表中的右键菜单对工作表进行操作，那么可以使用下面的代码禁用工作表右键菜单。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> DisBar<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> myBar <span class="token keyword">As</span> CommandBar
	<span class="token keyword">For</span> <span class="token keyword">Each</span> myBar <span class="token keyword">In</span> CommandBars
		<span class="token keyword">If</span> myBar<span class="token punctuation">.</span><span class="token keyword">Type</span> <span class="token operator">=</span> msoBarTypePopup <span class="token keyword">Then</span>
			myBar<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">False</span>
		<span class="token keyword">End</span> <span class="token keyword">If</span>
	<span class="token keyword">Next</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>代码解析：</p> <p>DisBar 过程禁用工作表中所有的右键菜单。</p> <p>第 3 行代码使用 For Each...Next 语句遍历 CommandBars 集合。CommandBars 集合代表应用程序中所有的命令栏。</p> <p>第 4 行代码根据命令栏的 Type 属性判断命令栏是否为右键菜单。应用于 CommandBar 对象的 Type 属性返回命令栏的类型，可以为表格 88-1 所列的 MsoBarType 常量之一。</p> <p>表格 88-1	MsoBarType 常量</p> <table><thead><tr><th>常量</th> <th>值</th> <th>描述</th></tr></thead> <tbody><tr><td>msoBarTypeMenuBar</td> <td>1</td> <td>菜单栏</td></tr> <tr><td>msoBarTypeNormal</td> <td>0</td> <td>工具栏</td></tr> <tr><td>msoBarTypePopup</td> <td>2</td> <td>右键快捷菜单</td></tr></tbody></table> <p>第 5 行代码将 CommandBars 集合中右键快捷菜的 Enabled 属性设置为 False，使之无效。</p> <p>运行 DisBar 过程将禁用工作表中所有的右键菜单，需要恢复时只需将其 Enabled 属性设置为 True 即可。</p> <h2 id="_89、创建自定义工具栏"><a href="#_89、创建自定义工具栏" class="header-anchor">#</a> 89、创建自定义工具栏</h2> <p>为了方便用户操作，在 Excel 原有的的工具栏上，还可以创建自定义的工具栏，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> NowToolbar<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> arr <span class="token keyword">As</span> <span class="token keyword">Variant</span>
	<span class="token keyword">Dim</span> id <span class="token keyword">As</span> <span class="token keyword">Variant</span>
	<span class="token keyword">Dim</span> i <span class="token keyword">As</span> <span class="token keyword">Integer</span>
	<span class="token keyword">Dim</span> Toolbar <span class="token keyword">As</span> CommandBar
	<span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">Resume</span> <span class="token keyword">Next</span>
	Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;MyToolbar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Delete
	arr <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token string">&quot;会计凭证&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;会计账簿&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;会计报表&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;凭证打印&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;账簿打印&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;报表打印&quot;</span><span class="token punctuation">)</span>
	id <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token number">9893</span><span class="token punctuation">,</span> <span class="token number">284</span><span class="token punctuation">,</span> <span class="token number">9590</span><span class="token punctuation">,</span> <span class="token number">9614</span><span class="token punctuation">,</span> <span class="token number">707</span><span class="token punctuation">,</span> <span class="token number">986</span><span class="token punctuation">)</span>
	<span class="token keyword">Set</span> Toolbar <span class="token operator">=</span> Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token string">&quot;MyToolbar&quot;</span><span class="token punctuation">,</span> msoBarTop<span class="token punctuation">)</span>
		<span class="token keyword">With</span> Toolbar
			<span class="token punctuation">.</span>Protection <span class="token operator">=</span> msoBarNoResize
			<span class="token punctuation">.</span>Visible <span class="token operator">=</span> <span class="token boolean">True</span>
			<span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">To</span> <span class="token number">5</span>
				<span class="token keyword">With</span> <span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlButton<span class="token punctuation">)</span>
					<span class="token punctuation">.</span>Caption <span class="token operator">=</span> arr<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
					<span class="token punctuation">.</span>FaceId <span class="token operator">=</span> id<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
					<span class="token punctuation">.</span>BeginGroup <span class="token operator">=</span> <span class="token boolean">True</span>
					<span class="token punctuation">.</span>Style <span class="token operator">=</span> msoButtonIconAndCaptionBelow
				<span class="token keyword">End</span> <span class="token keyword">With</span>
			<span class="token keyword">Next</span>
		<span class="token keyword">End</span> <span class="token keyword">With</span>
	<span class="token keyword">Set</span> Toolbar <span class="token operator">=</span> <span class="token boolean">Nothing</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>代码解析：</p> <p>NowToolbar 过程使用 Add 方法在 Excel 窗口中创建自定义工具栏。应用于 CommandBars 对象的 Add 方法请参阅 83 。</p> <p>第 10 行代码，使用 Add 方法在菜单栏上创建名称为“MyToolbar”的命令栏，创建时设置新命令栏的 Position 参数为 msoBarTop，使新命令栏位于应用程序窗口的顶部。如果将 Position 参数设置成 msoBarFloating，新命令栏为浮动工具栏，如图 89-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/89-1.f761c6dd.png" alt="" loading="lazy"></p> <p><u>图 89-1</u>	浮动命令栏</p></div> <p>关于 Position 参数的 MsoBarPosition 常数请参阅 83 中的表格 83-1。</p> <p>第 12 行代码，设置“MyToolbar”命令栏的 Protection 属性为 msoBarNoResize。应用于 CommandBar 对象的 Protection 属性指定命令栏的保护类型，可以为表格 89-1 所列的 MsoBarProtection 常数之一。</p> <p><u>表格 89-1</u>	MsoBarProtection常数</p> <table><thead><tr><th>常数</th> <th>值</th> <th>说明</th></tr></thead> <tbody><tr><td>msoBarNoProtection</td> <td>0</td> <td>不受保护，可自定义(缺省值)</td></tr> <tr><td>msoBarNoCustomize</td> <td>1</td> <td>不能自定义</td></tr> <tr><td>msoBarNoResize</td> <td>2</td> <td>不能调整大小</td></tr> <tr><td>msoBarNoMove</td> <td>4</td> <td>不能移动</td></tr> <tr><td>msoBarNoChangeVisible</td> <td>8</td> <td>不能更改可见状态</td></tr> <tr><td>msoBarNoChangeDock</td> <td>16</td> <td>不能改变停靠的位置</td></tr> <tr><td>msoBarNoVerticalDock</td> <td>32</td> <td>不能沿窗口左侧或右侧停放</td></tr> <tr><td>msoBarNoHorizontalDock</td> <td>64</td> <td>不能沿窗口顶部或底部停放</td></tr></tbody></table> <p>第 14 行到第 21 代码，使用 Add 方法在新命令栏中添加按钮控件，设置按钮控件的各项属性。其中第 19 行代码，设置按钮控件的 Style 属性为 msoButtonIconAndCaptionBelow，使工具栏按钮显示时包含图标和标题，且标题位于图标之下。</p> <p>应用于 CommandBar 对象的 Style 属性返回或设置工具栏按钮的显示方式，可以为表格 89-2 所列的 MsoButtonStyle 常数之一。</p> <p><u>表格 89-2</u>	MsoButtonStyle 常数</p> <table><thead><tr><th>常数</th> <th>值</th> <th>说明</th></tr></thead> <tbody><tr><td>msoButtonIcon</td> <td>1</td> <td>包含图标的按钮</td></tr> <tr><td>msoButtonCaption</td> <td>2</td> <td>包含标题的按钮</td></tr> <tr><td>ButtonIconandCaption</td> <td>3</td> <td>包含图标和标题的按钮</td></tr> <tr><td>msoButtonIconAndCaptionBelow</td> <td>11</td> <td>包含图标和标题，且标题位于底部的按钮</td></tr> <tr><td>msoButtonIconAndWrapCaption</td> <td>7</td> <td>包含图标和标题，且标题自动换行的按钮</td></tr> <tr><td>msoButtonWrapCaption</td> <td>14</td> <td>包含标题，且标题自动换行的按钮</td></tr></tbody></table> <p>运行 NowToolbar 过程，将在 Excel 窗口的顶部创建一个自定义的工具栏，如图 89-2 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/89-2.fd9f1cbb.png" alt="" loading="lazy"></p> <p><u>图 89-2</u>	创建自定义工具栏</p></div> <h2 id="_90、自定义工具栏按钮图标"><a href="#_90、自定义工具栏按钮图标" class="header-anchor">#</a> 90、自定义工具栏按钮图标</h2> <p>在创建自定义的工具栏时，除了可以为工具栏按钮添加 Excel 内置的图标外，还能为工具栏按钮添加自定义的图标，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> AddCustomButton<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> xBar <span class="token keyword">As</span> CommandBar
	<span class="token keyword">Dim</span> xButton <span class="token keyword">As</span> CommandBarButton
	<span class="token keyword">On</span> <span class="token keyword">Error</span> <span class="token keyword">Resume</span> <span class="token keyword">Next</span>
	Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;CustomBar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Delete
	<span class="token keyword">Set</span> xBar <span class="token operator">=</span> CommandBars<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token string">&quot;CustomBar&quot;</span><span class="token punctuation">,</span> msoBarTop<span class="token punctuation">)</span>
	<span class="token keyword">Set</span> xButton <span class="token operator">=</span> xBar<span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>Add<span class="token punctuation">(</span>msoControlButton<span class="token punctuation">)</span>
	<span class="token keyword">With</span> xButton
		<span class="token punctuation">.</span>Picture <span class="token operator">=</span> LoadPicture<span class="token punctuation">(</span>ThisWorkbook<span class="token punctuation">.</span>Path <span class="token operator">&amp;</span> <span class="token string">&quot;\P.BMP&quot;</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span>Mask <span class="token operator">=</span> LoadPicture<span class="token punctuation">(</span>ThisWorkbook<span class="token punctuation">.</span>Path <span class="token operator">&amp;</span> <span class="token string">&quot;\M.BMP&quot;</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span>TooltipText <span class="token operator">=</span> <span class="token string">&quot;Excel Home 论坛&quot;</span>
	<span class="token keyword">End</span> <span class="token keyword">With</span>
	xBar<span class="token punctuation">.</span>Visible <span class="token operator">=</span> <span class="token boolean">True</span>
	<span class="token keyword">Set</span> xBar <span class="token operator">=</span> <span class="token boolean">Nothing</span>
	<span class="token keyword">Set</span> xButton <span class="token operator">=</span> <span class="token boolean">Nothing</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>代码解析：</p> <p>AddCustomButton 过程创建自定义工具栏，并设置工具栏的按钮自定义图标。</p> <p>第 6、7 行代码，使用 Add 方法在 Excel 窗口中添加自定义工具栏和按钮。请参阅 89 。</p> <p>第 9 行代码，设置工具栏按钮的 Picture 属性为同一目录中的 p.bmp 图片。</p> <p>应用于 CommandBarButton 对象的 Picture 属性返回一个 IPictureDisp 对象，表示  CommandBarButton 对象的图像，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>expression<span class="token punctuation">.</span>Picture

参数是必需的，返回一个CommandBarButton对象。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>指定对象的 Picture 属性就能设置对象的图像。</p> <p>第 10 行代码，设置工具栏按钮的 Mask 属性为同一目录中的 m.bmp 图片。</p> <p>为了使工具栏按钮图标透明显示，在指定对象的 Picture 属性后，还需要指定对象的 Mask 属性。</p> <p>应用于 CommandBarButton 对象的 Mask 属性返回表示 CommandBarButton 对象的屏蔽图像的 IPictureDisp 对象，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>expression<span class="token punctuation">.</span>Mask

参数是必需的，返回一个CommandBarButton对象。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>屏蔽图像决定按钮图像透明的部分。在创建作为屏蔽图像使用的图像时，所有要透明的区域应该为白色，所有要显示的区域应该为黑色。</p> <p>第 11 行代码，设置按钮的“屏幕提示”为“ExcelHome论坛”。</p> <p>运行 AddCustomButton 过程，创建自定义工具栏，并设置工具栏按钮的图标，如图 90-1 所示。</p> <div class="custom-block center"><p><img src="data:image/png;base64,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" alt="" loading="lazy"></p> <p><u>图 90-1</u>	自定义工具栏图标</p></div> <h2 id="_91、自定义工作簿图标"><a href="#_91、自定义工作簿图标" class="header-anchor">#</a> 91、自定义工作簿图标</h2> <p>Excel 标题栏的图标是默认的，而借助 API 函数可以自定义工作簿标题栏图标，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Private</span> <span class="token keyword">Declare</span> <span class="token keyword">Function</span> FindWindow <span class="token keyword">Lib</span> <span class="token string">&quot;user32&quot;</span> <span class="token keyword">Alias</span> <span class="token string">&quot;FindWindowA&quot;</span> <span class="token punctuation">(</span><span class="token keyword">ByVal</span> lpClassName <span class="token keyword">As</span> <span class="token keyword">String</span><span class="token punctuation">,</span> <span class="token keyword">ByVal</span> lpWindowName <span class="token keyword">As</span> <span class="token keyword">String</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Long</span>
<span class="token keyword">Private</span> <span class="token keyword">Declare</span> <span class="token keyword">Function</span> DrawMenuBar <span class="token keyword">Lib</span> <span class="token string">&quot;user32&quot;</span> <span class="token punctuation">(</span><span class="token keyword">ByVal</span> hWnd <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Long</span>
<span class="token keyword">Private</span> <span class="token keyword">Declare</span> <span class="token keyword">Function</span> SetFocus <span class="token keyword">Lib</span> <span class="token string">&quot;user32&quot;</span> <span class="token punctuation">(</span><span class="token keyword">ByVal</span> hWnd <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Long</span>
<span class="token keyword">Private</span> <span class="token keyword">Declare</span> <span class="token keyword">Function</span> SendMessage <span class="token keyword">Lib</span> <span class="token string">&quot;user32&quot;</span> <span class="token keyword">Alias</span> <span class="token string">&quot;SendMessageA&quot;</span> <span class="token punctuation">(</span><span class="token keyword">ByVal</span> hWnd <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">,</span> <span class="token keyword">ByVal</span> wMsg <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">,</span> <span class="token keyword">ByVal</span> wParam <span class="token keyword">As</span> <span class="token keyword">Integer</span><span class="token punctuation">,</span> <span class="token keyword">ByVal</span> lParam <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Long</span>
<span class="token keyword">Private</span> <span class="token keyword">Declare</span> <span class="token keyword">Function</span> ExtractIcon <span class="token keyword">Lib</span> <span class="token string">&quot;shell32.dll&quot;</span> <span class="token keyword">Alias</span> <span class="token string">&quot;ExtractIconA&quot;</span> <span class="token punctuation">(</span><span class="token keyword">ByVal</span> hInst <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">,</span> <span class="token keyword">ByVal</span> lpszExeFileName <span class="token keyword">As</span> <span class="token keyword">String</span><span class="token punctuation">,</span> <span class="token keyword">ByVal</span> nIconIndex <span class="token keyword">As</span> <span class="token keyword">Long</span><span class="token punctuation">)</span> <span class="token keyword">As</span> <span class="token keyword">Long</span>
<span class="token keyword">Private</span> <span class="token keyword">Const</span> WM_SETICON <span class="token operator">=</span> <span class="token number">&amp;H80</span>
<span class="token keyword">Private</span> <span class="token keyword">Sub</span> Workbook_Open<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> IStyle <span class="token keyword">As</span> <span class="token keyword">Long</span>
	<span class="token keyword">Dim</span> hIcon <span class="token keyword">As</span> <span class="token keyword">Long</span>
	<span class="token keyword">Dim</span> hWndForm <span class="token keyword">As</span> <span class="token keyword">Long</span>
	hWndForm <span class="token operator">=</span> FindWindow<span class="token punctuation">(</span>vbNullString<span class="token punctuation">,</span> Application<span class="token punctuation">.</span>Caption<span class="token punctuation">)</span>
	hIcon <span class="token operator">=</span> ExtractIcon<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> ActiveWorkbook<span class="token punctuation">.</span>Path <span class="token operator">&amp;</span> <span class="token string">&quot;\p.bmp&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
	SendMessage hWndForm<span class="token punctuation">,</span> WM_SETICON<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> hIcon
	SendMessage hWndForm<span class="token punctuation">,</span> WM_SETICON<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> hIcon
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>代码解析：</p> <p>工作簿打开后使用 API 函数自定义工作簿标题栏的图标。</p> <p>第 1 行到第 6 行代码，API 函数声明。</p> <p>第 7 行到第 15 行代码，工作簿的 Open 事件过程，把工作簿标题栏默认的图标更改为同一文件夹下的 p.bmp 图片。</p> <p>工作簿打开后标题栏如图 91-1 所示，任务栏图标如图 91-2 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/91-1.8b9acfd9.png" alt="" loading="lazy"></p> <p><u>图 91-1</u>	自定义工作簿标题和图标</p> <p><img src="data:image/png;base64,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" alt="" loading="lazy"></p> <p><u>图 91-2</u>	任务栏图标</p></div> <h2 id="_92、移除工作表的最小最大化和关闭按钮"><a href="#_92、移除工作表的最小最大化和关闭按钮" class="header-anchor">#</a> 92、移除工作表的最小最大化和关闭按钮</h2> <p>如果不希望工作表的最小、最大化和关闭按钮出现在菜单栏中，可以使用以下代码去除：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>ActiveWorkbook<span class="token punctuation">.</span>Protect <span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token boolean">True</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>代码解析：</p> <p>使用 Protect 方法对工作簿进行保护。Protect 方法应用于 Workbook 对象的时保护工作簿使其不至被修改，语法如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>expression<span class="token punctuation">.</span>Protect<span class="token punctuation">(</span>Password<span class="token punctuation">,</span> <span class="token keyword">Structure</span><span class="token punctuation">,</span> Windows<span class="token punctuation">)</span>

参数expression是必需的，该表达式返回一个Workbook对象。
参数Password是可选的，为工作表或工作簿指定区分大小写的密码。
参数<span class="token keyword">Structure</span>是可选的，如果为<span class="token boolean">True</span>，则保护工作簿结构（工作表的相对位置）。默认值为<span class="token boolean">False</span>。
参数Windows是可选的，如果为<span class="token boolean">True</span>，则保护工作簿窗口。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>恢复工作表的最大、最小化和关闭按钮的代码如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>ActiveWorkbook<span class="token punctuation">.</span>Protect <span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token boolean">False</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在本例中将 Windows 参数设置为 True，使工作簿窗口受到保护，工作表的最小、最大化和关闭按钮及图标不出现在菜单栏中，如图 92-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/92-1.7562e61f.png" alt="" loading="lazy"></p> <p><u>图 92-1</u>	移除工作表最小、最大化和关闭按钮</p></div> <h2 id="_93、在工具栏上添加下拉列表框"><a href="#_93、在工具栏上添加下拉列表框" class="header-anchor">#</a> 93、在工具栏上添加下拉列表框</h2> <p>如果需要在工具栏中添加类似“字体”这样的下拉列表控制框控件，那么可以使用下面的代码。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> AddDropdown<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> myDropdown <span class="token keyword">As</span> <span class="token keyword">Object</span>
	<span class="token keyword">Dim</span> myCap <span class="token keyword">As</span> <span class="token keyword">Variant</span>
	<span class="token keyword">Dim</span> i <span class="token keyword">As</span> <span class="token keyword">Integer</span>
	myCap <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token string">&quot;基础应用&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;VBA程序开发&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;函数与公式&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">Call</span> DeleteButton
	<span class="token keyword">Set</span> myDropdown <span class="token operator">=</span> Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;Formatting&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Controls <span class="token operator">_</span>
		<span class="token punctuation">.</span>Add<span class="token punctuation">(</span><span class="token keyword">Type</span><span class="token punctuation">:</span><span class="token operator">=</span>msoControlDropdown<span class="token punctuation">,</span> Before<span class="token punctuation">:</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token keyword">With</span> myDropdown
		<span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;请选择版块&quot;</span>
		<span class="token punctuation">.</span>OnAction <span class="token operator">=</span> <span class="token string">&quot;myOnA&quot;</span>
		<span class="token punctuation">.</span>Style <span class="token operator">=</span> msoComboNormal
		<span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">To</span> UBound<span class="token punctuation">(</span>myCap<span class="token punctuation">)</span>
			<span class="token punctuation">.</span>AddItem myCap<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
		<span class="token keyword">Next</span>
		<span class="token punctuation">.</span>ListIndex <span class="token operator">=</span> <span class="token number">1</span>
	<span class="token keyword">End</span> <span class="token keyword">With</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
<span class="token keyword">Sub</span> DeleteButton<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">With</span> Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;Formatting&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Controls<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token keyword">If</span> <span class="token punctuation">.</span>Caption <span class="token operator">=</span> <span class="token string">&quot;请选择版块&quot;</span> <span class="token keyword">Then</span> <span class="token punctuation">.</span>Delete
	<span class="token keyword">End</span> <span class="token keyword">With</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
<span class="token keyword">Sub</span> myOnA<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> myList <span class="token keyword">As</span> <span class="token keyword">Byte</span>
	myList <span class="token operator">=</span> Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span><span class="token string">&quot;Formatting&quot;</span><span class="token punctuation">)</span> <span class="token operator">_</span>
		<span class="token punctuation">.</span>Controls<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ListIndex
	ActiveWorkbook<span class="token punctuation">.</span>FollowHyperlink <span class="token operator">_</span>
	Address<span class="token punctuation">:</span><span class="token operator">=</span><span class="token string">&quot;http://club.excelhome.net/forum-&quot;</span> <span class="token operator">&amp;</span> myList <span class="token operator">&amp;</span> <span class="token string">&quot;-1.html&quot;</span><span class="token punctuation">,</span> NewWindow<span class="token punctuation">:</span><span class="token operator">=</span><span class="token boolean">True</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>代码解析：</p> <p>AddDropdown 过程使用 Add 方法在工具栏中添加下拉列表控制框控件。</p> <p>第 5 行代码使用 Array 函数创建一个数组用于保存下拉列表控制框控件加载列表项所需的元素。</p> <p>第 6 行代码先运行第 19 行到第 23 行的 DeleteButton 过程删除可能存在的下拉列表控制框控件，以免重复添加。DeleteButton 过程判断工具栏中第一个控件的 Caption 属性是否为“请选择版块”，如果是则删除该下拉列表控制框控件。</p> <p>第 7、8 行代码使用 Add 方法在工具栏中添加下拉列表控制框控件。应用于  CommandBarControls 对象的 Add 方法请参阅 79 。示例中将其参数 Type 设置为 msoControlDropdown，添加的就是下拉列表控制框控件。</p> <p>第 10 行代码设置下拉列表控制框控件的 Caption 属性，应用于 CommandBarControls 对象的 Caption 属性返回或设置指定命令栏控件的题注文字，也可作为默认的“屏幕提示”显示。</p> <p>第 11 行代码设置改变下拉列表控制框控件的内容时要运行的过程为第 24 行到第 30 行代码的 myOnA 过程。myOnA 过程根据下拉列表控制框控件的 ListIndex 属性值打开 Excel Home 论坛中相应的版块。</p> <p>第 12 行代码设置下拉列表控制框控件的样式。Style 属性返回或设置命令栏控件的显示方式，该属性值可设置为表格 93-1 所列 MsoComboStyle 常量之一。</p> <p>表格 93-1	MsoComboStyle 常量</p> <table><thead><tr><th>常量</th> <th>值</th> <th>描述</th></tr></thead> <tbody><tr><td>msoComboLabel</td> <td>1</td> <td>显示标签</td></tr> <tr><td>msoComboNormal</td> <td>0</td> <td>不显示标签</td></tr></tbody></table> <p>第 13 行到第 15 行代码使用 AddItem 方法将数组中的元素添加到下拉列表控制框控件的列表项中。</p> <p>第 16 行代码将下拉列表控制框控件的 ListIndex 属性设置为 1，使其显示第一条列表项。</p> <p>运行 AddDropdown 过程，工具栏如图 93-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/93-1.bbb72656.png" alt="" loading="lazy"></p> <p><u>图 93-1</u>	添加下拉列表控制框控件</p></div> <h2 id="_94、屏蔽工作表的复制功能"><a href="#_94、屏蔽工作表的复制功能" class="header-anchor">#</a> 94、屏蔽工作表的复制功能</h2> <p>有时我们并不希望用户对工作表中的数据进行复制粘贴操作，此时可以把所有的复制功能都屏蔽，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code>	<span class="token keyword">Dim</span> CmdCtrls <span class="token keyword">As</span> CommandBarControls
	<span class="token keyword">Dim</span> Cmd <span class="token keyword">As</span> CommandBarControl
<span class="token keyword">Sub</span> ProCopy<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Set</span> CmdCtrls <span class="token operator">=</span> Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">.</span>FindControls<span class="token punctuation">(</span>ID<span class="token punctuation">:</span><span class="token operator">=</span><span class="token number">19</span><span class="token punctuation">)</span>
	<span class="token keyword">For</span> <span class="token keyword">Each</span> Cmd <span class="token keyword">In</span> CmdCtrls
		Cmd<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">False</span>
	<span class="token keyword">Next</span>
	Application<span class="token punctuation">.</span>CellDragAndDrop <span class="token operator">=</span> <span class="token boolean">False</span>
	Application<span class="token punctuation">.</span>OnKey <span class="token punctuation">(</span><span class="token string">&quot;^c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
<span class="token keyword">Sub</span> StaCopy<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Set</span> CmdCtrls <span class="token operator">=</span> Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">.</span>FindControls<span class="token punctuation">(</span>ID<span class="token punctuation">:</span><span class="token operator">=</span><span class="token number">19</span><span class="token punctuation">)</span>
	<span class="token keyword">For</span> <span class="token keyword">Each</span> Cmd <span class="token keyword">In</span> CmdCtrls
		Cmd<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">True</span>
	<span class="token keyword">Next</span>
	Application<span class="token punctuation">.</span>CellDragAndDrop <span class="token operator">=</span> <span class="token boolean">True</span>
	Application<span class="token punctuation">.</span>OnKey <span class="token punctuation">(</span><span class="token string">&quot;^c&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>代码解析：</p> <p>第 1、2 行代码在模块顶部声明两个模块级的变量。</p> <p>第 3 行到第 10 行代码 ProCopy 过程，屏蔽工作表中所有的复制功能。其中第 4 行到第 7 行代码使用 FindControls 方法将所有与“复制”相关的命令栏控件赋给变量 CmdCtrls 后将其 Enabled 设置为 False。关于 FindControls 方法请参阅 80 。</p> <p>第 8 行代码屏蔽单元格拖放功能，关于应用于 Application 对象的 CellDragAndDrop 属性请参阅 10 。</p> <p>第 9 行代码屏蔽 &lt;Ctrl+C&gt; 组合键功能，关于应用于 Application 对象的 OnKey 方法请参阅 68 。</p> <p>第 11 行到第 18 行代码 StaCopy 过程，恢复所有的复制功能。</p> <h2 id="_95、禁用工具栏的自定义"><a href="#_95、禁用工具栏的自定义" class="header-anchor">#</a> 95、禁用工具栏的自定义</h2> <p>在 Excel 中，用户可以通过依次单击菜单“视图”→“工具栏”→“自定义”，显示“自定义”选项卡来调整菜单栏和工具栏，如图 95-1、图 95-2 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/95-1.fcacf0bf.png" alt="" loading="lazy"></p> <p><u>图 95-1</u>	自定义功能</p> <p><img src="/blog/assets/img/95-2.191070c5.png" alt="" loading="lazy"></p> <p><u>图 95-2</u>	自定义选项卡</p></div> <p>如果不希望用户使用“自定义”选项卡来调整菜单栏和工具栏，可以禁用工具栏的自定义功能，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> nCustomize<span class="token punctuation">(</span><span class="token punctuation">)</span>
	Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">.</span>DisableCustomize <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>代码解析：</p> <p>nCustomize 过程禁用工具栏的自定义功能，应用于 CommandBars 集合对象的DisableCustomize 属性设置是否禁用工具栏的自定义。如果禁用，返回 True，否则返回 False。</p> <p>用于启用工具栏的自定义的代码是：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> yCustomize<span class="token punctuation">(</span><span class="token punctuation">)</span>
	Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">.</span>DisableCustomize <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>运行 nCustomize 过程，禁用工具栏的自定义对话框，自定义菜单项消失,如图 95-3 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/95-3.49393003.png" alt="" loading="lazy"></p> <p><u>图 95-3</u>	禁用工具栏的自定义</p> <h2 id="_96、屏蔽所有的命令栏"><a href="#_96、屏蔽所有的命令栏" class="header-anchor">#</a> 96、屏蔽所有的命令栏</h2> <p>在使用自定义的操作界面时，需要屏蔽 Excel 中所有的命令栏，可以使用下面的代码。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> Shielding_1<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> i <span class="token keyword">As</span> <span class="token keyword">Integer</span>
	<span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">To</span> Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">.</span>Count
		Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">False</span>
	<span class="token keyword">Next</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>代码解析：</p> <p>Shielding_1 过程使用 For...Next 语句遍历 Excel 命令栏，并将其 Enabled 属性设置为 False，使之无效。</p> <p>还可以使用 For Each...Next 语句遍历所有的 CommandBars 对象，代码如下：</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> Shielding_2<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> Cmd <span class="token keyword">As</span> CommandBar
	<span class="token keyword">For</span> <span class="token keyword">Each</span> Cmd <span class="token keyword">In</span> Application<span class="token punctuation">.</span>CommandBars
		Cmd<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">False</span>
	<span class="token keyword">Next</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>运行 Shielding_1 或 Shielding_2 过程工作簿如图 96-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/96-1.c5f2751b.png" alt="" loading="lazy"></p> <p><u>图 96-1</u>	屏蔽所有的命令栏</p></div></div> <p>在需要恢复时只需将 Enabled 属性设置为 True 即可，如下面的代码所示。</p> <div class="language-vb line-numbers-mode"><pre class="language-vb"><code><span class="token keyword">Sub</span> Recovery_1<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> i <span class="token keyword">As</span> <span class="token keyword">Integer</span>
	<span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">To</span> Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">.</span>Count
		Application<span class="token punctuation">.</span>CommandBars<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">True</span>
	<span class="token keyword">Next</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
<span class="token keyword">Sub</span> Recover_2<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">Dim</span> Cmd <span class="token keyword">As</span> CommandBar
	<span class="token keyword">For</span> <span class="token keyword">Each</span> Cmd <span class="token keyword">In</span> Application<span class="token punctuation">.</span>CommandBars
		Cmd<span class="token punctuation">.</span>Enabled <span class="token operator">=</span> <span class="token boolean">True</span>
	<span class="token keyword">Next</span>
<span class="token keyword">End</span> <span class="token keyword">Sub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>代码解析：</p> <p>Recovery_1 和 Recover_2 过程分别使用 For...Next 语句和 For Each...Next 语句遍历所有的 CommandBars 对象，设置其 Enabled 属性为 True，显示所有的命令栏。</p> <h2 id="_97、恢复-excel-的命令栏"><a href="#_97、恢复-excel-的命令栏" class="header-anchor">#</a> 97、恢复 Excel 的命令栏</h2> <p>如果用户经常添加、删除 Excel 的菜单和工具栏而又没有及时恢复的话，有时会破坏 Excel 默认的用户界面，即使用 Reset 方法也不能恢复成初始状态。</p> <p>此时可以在电脑的本地硬盘中查找扩展名为 *.xlb 的文件，该文件在电脑中的位置会因 Excel 版本的不同而不同，在 XP 操作系统中，该文件位于系统盘的 <code>Documents and Settings\Administrator\Application Data\Microsoft\Excel</code> 文件夹，其中 Administrator 是电脑的用户名。找到它最简单的方法是使用 Windows 的搜索功能。按 &lt;Win+F&gt; 组合键调出 Windows 的搜索窗口，然后用 *.xlb 为目标在本地硬盘中进行搜索，如图 97-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/97-1.cc805fbd.png" alt="" loading="lazy"></p> <p><u>图 97-1</u>	搜索 *.xlb 文件</p></div> <p>如果搜索没有结果，请检查“更多高级选项”中是否选中“搜索隐藏的文件和文件夹”选项，如图 97-2 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/97-2.f86272ff.png" alt="" loading="lazy"></p> <p><u>图 97-2</u>	搜索隐藏的文件和文件夹</p></div> <p>对 Excel 用户界面的任何修改都会保存在 *.xlb 文件中，找到后删除该文件，然后重新启动 Excel。Excel 会重新创建一个 *.xlb 文件，而菜单和工具栏也会全部恢复成初始状态。</p></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/Ryukarin/blog/edit/main/project/Excel/09.VBA_menu_toolbar.md" target="_blank" rel="noopener noreferrer">编辑此页</a></div> <div class="meta-item update-time"><span class="label">上次编辑于:</span> <span class="info">2022年1月26日 14:11</span></div> <div class="meta-item contributors"><span class="label">贡献者: </span> <span class="info"><span title="email: ryuukaringo@gmail.com" class="contributor">
          ryuukarin
        </span> <!----></span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/blog/project/Excel/08.VBA_dialog/" class="prev"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon prev-icon"><path d="M906.783 588.79c-.02 8.499-6.882 15.36-15.38 15.37l-443.7-.01 75.704 191.682c2.52 6.42.482 13.763-5.038 17.91-5.52 4.168-13.138 4.147-18.616-.092L123.228 524.175a15.362 15.362 0 0 1-6-12.165c0-4.782 2.222-9.277 6-12.185L499.753 210.35a15.388 15.388 0 0 1 9.38-3.195c3.236 0 6.502 1.034 9.236 3.103 5.52 4.147 7.578 11.49 5.038 17.91L447.683 419.84l443.72-.01c8.498.01 15.36 6.881 15.36 15.36l.02 153.6z" fill="currentColor"></path></svg>
        VBA 之 使用对话框
      </a></span> <span class="next"><a href="/blog/project/Excel/10.VBA_controls_form_1/">
        VBA 之 控件与用户窗体1
        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon next-icon"><path d="M906.772 512c0 4.772-2.211 9.267-5.99 12.175L524.257 813.66a15.37 15.37 0 0 1-18.616.092 15.368 15.368 0 0 1-5.038-17.91l75.714-191.672h-443.73c-8.488 0-15.36-6.881-15.36-15.36v-153.6c0-8.489 6.872-15.36 15.36-15.36h443.73l-75.714-191.682a15.358 15.358 0 0 1 5.048-17.91c5.51-4.158 13.128-4.137 18.606.092l376.525 289.485a15.323 15.323 0 0 1 5.99 12.165z" fill="currentColor"></path></svg></a></span></p></div> <div class="comments-wrapper"><div class="waline-wrapper"><div id="waline-comment"></div></div></div> <!----> <div class="content__page-bottom"></div></main> <footer class="footer-wrapper"><div class="media-links-wrapper"><a href="https://gitee.com/ryuukarin" rel="noopener noreferrer" target="_blank" aria-label="Gitee" data-balloon-pos="up" class="media-link"><span class="sr-only">Gitee</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-gitee"><circle cx="512" cy="512" r="512" fill="#C71D23"></circle> <path d="M772.953 454.723H480.17v.006a25.46 25.46 0 0 0-25.46 25.453l-.025 63.649a25.46 25.46 0 0 0 25.46 25.466l178.242-.007a25.46 25.46 0 0 1 25.459 25.46v12.73c0 42.18-34.198 76.378-76.378 76.378H365.583a25.46 25.46 0 0 1-25.46-25.46V416.533h-.006c0-42.18 34.192-76.378 76.378-76.378h356.388v-.013a25.46 25.46 0 0 0 25.46-25.446l.057-63.65h.013a25.46 25.46 0 0 0-25.46-25.471l-356.432.012c-105.453 0-190.946 85.493-190.946 190.946v356.433a25.46 25.46 0 0 0 25.46 25.46H626.56c94.913 0 171.852-76.94 171.852-171.852V480.182a25.46 25.46 0 0 0-25.46-25.46z" fill="#fff"></path></svg></a><a href="https://github.com/Ryukarin" rel="noopener noreferrer" target="_blank" aria-label="Github" data-balloon-pos="up" class="media-link"><span class="sr-only">Github</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-github"><circle cx="512" cy="512" r="512" fill="#171515"></circle> <path d="M509.423 146.442c-200.317 0-362.756 162.42-362.756 362.8 0 160.266 103.936 296.24 248.109 344.217 18.139 3.327 24.76-7.872 24.76-17.486 0-8.613-.313-31.427-.49-61.702-100.912 21.923-122.205-48.63-122.205-48.63-16.495-41.91-40.28-53.067-40.28-53.067-32.937-22.51 2.492-22.053 2.492-22.053 36.407 2.566 55.568 37.386 55.568 37.386 32.362 55.438 84.907 39.43 105.58 30.143 3.296-23.444 12.667-39.43 23.032-48.498-80.557-9.156-165.246-40.28-165.246-179.297 0-39.604 14.135-71.988 37.342-97.348-3.731-9.178-16.18-46.063 3.556-96.009 0 0 30.46-9.754 99.76 37.19 28.937-8.048 59.97-12.071 90.823-12.211 30.807.14 61.843 4.165 90.822 12.21 69.26-46.944 99.663-37.189 99.663-37.189 19.792 49.946 7.34 86.831 3.61 96.01 23.25 25.359 37.29 57.742 37.29 97.347 0 139.366-84.82 170.033-165.637 179.013 13.026 11.2 24.628 33.342 24.628 67.182 0 48.498-.445 87.627-.445 99.521 0 9.702 6.535 20.988 24.945 17.444 144.03-48.067 247.881-183.95 247.881-344.175 0-200.378-162.442-362.798-362.802-362.798z" fill="#FFF"></path></svg></a></div> <div class="footer">MIT Licensed</div> <div class="copyright">Copyright © 2022 karin</div></footer></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="关闭" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">该应用可以安装在您的 PC 或移动设备上。这将使该 Web 应用程序外观和行为与其他应用程序相同。它将在出现在应用程序列表中，并可以固定到主屏幕，开始菜单或任务栏。此 Web 应用程序还将能够与其他应用程序和您的操作系统安全地进行交互。</p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>详情</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        安装 <span></span></button> <button class="cancel-button">
        取消
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="关闭" aria-label="关闭" class="pswp__button pswp__button--close"></button> <button title="分享" aria-label="分享" class="pswp__button pswp__button--share"></button> <button title="切换全屏" aria-label="切换全屏" class="pswp__button pswp__button--fs"></button> <button title="缩放" aria-label="缩放" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="上一个 (左箭头)" aria-label="上一个 (左箭头)" class="pswp__button pswp__button--arrow--left"></button> <button title="下一个 (右箭头)" aria-label="下一个 (右箭头)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/blog/assets/js/app.9f9c9b81.js" defer></script><script src="/blog/assets/js/vendors~layout-Layout.79b66223.js" defer></script><script src="/blog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.efafecdd.js" defer></script><script src="/blog/assets/js/page-VBA之菜单和工具栏.ec98d91f.js" defer></script>
  </body>
</html>
