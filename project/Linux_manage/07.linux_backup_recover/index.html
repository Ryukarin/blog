<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>linux数据备份与恢复 | KARIN</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <link rel="alternate" type="application/atom+xml" href="https://vuepress-theme-hope-demo.mrhope.site/blog/atom.xml" title="KARIN Atom Feed">
    <link rel="alternate" type="application/json" href="https://vuepress-theme-hope-demo.mrhope.site/blog/feed.json" title="KARIN JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="https://vuepress-theme-hope-demo.mrhope.site/blog/rss.xml" title="KARIN RSS Feed">
    <link rel="icon" href="/favicon.png">
    <link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512">
    <link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192">
    <link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512">
    <link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192">
    <link rel="manifest" href="/blog/manifest.webmanifest" crossorigin="use-credentials">
    <link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png">
    <meta name="description" content="KARIN的学习笔记">
    <meta property="og:url" content="/blog/project/Linux_manage/07.linux_backup_recover.html">
    <meta property="og:site_name" content="KARIN">
    <meta property="og:title" content="linux数据备份与恢复">
    <meta property="og:description" content="不知道大家有没有丢失过重要的数据呢？ 丢失数据的理由是多种多样的，有人是因为重装系统时，没有把加密文件的密钥导出，重装系统后密钥丢失，导致所有的加密数据不能解密；也有人是因为在火车上笔记本电脑被别人调包，从而导致硬盘中的重要数据丢失；还有人是因为在系统中误执行了 rm -rf 命令，导致整个根目录被人为清空。但由此带来的后果是一样严重的。 保护重要数据的最有">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="zh-CN">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="KARIN">
    <meta property="article:author" content="karin">
    <meta property="article:tag" content="linux">
    <meta property="article:published_time" content="2021-05-31T16:00:00.000Z">
    <meta name="theme-color" content="#46bd87">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    
    <link rel="preload" href="/blog/assets/css/0.styles.5649bb21.css" as="style"><link rel="preload" href="/blog/assets/js/app.9f9c9b81.js" as="script"><link rel="preload" href="/blog/assets/js/vendors~layout-Layout.79b66223.js" as="script"><link rel="preload" href="/blog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.efafecdd.js" as="script"><link rel="preload" href="/blog/assets/js/page-linux数据备份与恢复.f202f4a1.js" as="script"><link rel="prefetch" href="/blog/assets/js/122.7ad47f04.js"><link rel="prefetch" href="/blog/assets/js/123.ae4a39df.js"><link rel="prefetch" href="/blog/assets/js/124.2715123b.js"><link rel="prefetch" href="/blog/assets/js/125.a4234a33.js"><link rel="prefetch" href="/blog/assets/js/126.8fa2f32c.js"><link rel="prefetch" href="/blog/assets/js/127.9bf5c918.js"><link rel="prefetch" href="/blog/assets/js/128.0c398c07.js"><link rel="prefetch" href="/blog/assets/js/layout-Blog.8dd576a3.js"><link rel="prefetch" href="/blog/assets/js/layout-Layout.3729e73b.js"><link rel="prefetch" href="/blog/assets/js/layout-NotFound.f1d2f2e6.js"><link rel="prefetch" href="/blog/assets/js/layout-Slide.7ed7d0aa.js"><link rel="prefetch" href="/blog/assets/js/page--3d4f54c7.4eab0894.js"><link rel="prefetch" href="/blog/assets/js/page-Docker数据管理.143b7f4f.js"><link rel="prefetch" href="/blog/assets/js/page-Excel函数.22369a36.js"><link rel="prefetch" href="/blog/assets/js/page-Excel快捷键.8fdc623f.js"><link rel="prefetch" href="/blog/assets/js/page-Excel笔记介绍.57c3fe06.js"><link rel="prefetch" href="/blog/assets/js/page-FTP笔记.2b8526c8.js"><link rel="prefetch" href="/blog/assets/js/page-Git介绍.82a25571.js"><link rel="prefetch" href="/blog/assets/js/page-Git分支管理.4f9c0210.js"><link rel="prefetch" href="/blog/assets/js/page-Git创建仓库.cabea66e.js"><link rel="prefetch" href="/blog/assets/js/page-Git基本操作.4e1f4734.js"><link rel="prefetch" href="/blog/assets/js/page-Git安装.cf6d44b4.js"><link rel="prefetch" href="/blog/assets/js/page-Git工作区、暂存区和版本库.5d561956.js"><link rel="prefetch" href="/blog/assets/js/page-Git工作流程.d2b8995f.js"><link rel="prefetch" href="/blog/assets/js/page-Git服务器搭建.7f6986af.js"><link rel="prefetch" href="/blog/assets/js/page-Git查看提交历史.40ff21ea.js"><link rel="prefetch" href="/blog/assets/js/page-Git标签.8f2c2cb6.js"><link rel="prefetch" href="/blog/assets/js/page-Git笔记.5e6ddcdf.js"><link rel="prefetch" href="/blog/assets/js/page-Git远程仓库（GitHub）.c8505cba.js"><link rel="prefetch" href="/blog/assets/js/page-Git配置.f141007c.js"><link rel="prefetch" href="/blog/assets/js/page-IT基础.e088bf26.js"><link rel="prefetch" href="/blog/assets/js/page-LAMP和LNMP环境搭建.adf92a39.js"><link rel="prefetch" href="/blog/assets/js/page-Markdown语法.76ecc03f.js"><link rel="prefetch" href="/blog/assets/js/page-SELinux管理.4075242b.js"><link rel="prefetch" href="/blog/assets/js/page-SFTP笔记.cdcf4d77.js"><link rel="prefetch" href="/blog/assets/js/page-Shell函数.775b51bc.js"><link rel="prefetch" href="/blog/assets/js/page-Shell变量.cda63b20.js"><link rel="prefetch" href="/blog/assets/js/page-Shell对文件的操作---sed命令.cd166768.js"><link rel="prefetch" href="/blog/assets/js/page-Shell对文本的搜索---grep命令.6083e37d.js"><link rel="prefetch" href="/blog/assets/js/page-Shell对输出流的处理---awk命令.0d48e00c.js"><link rel="prefetch" href="/blog/assets/js/page-Shell数组.4b8667ee.js"><link rel="prefetch" href="/blog/assets/js/page-Shell格式化输入.bf1e7958.js"><link rel="prefetch" href="/blog/assets/js/page-Shell格式化输出.6607e3e6.js"><link rel="prefetch" href="/blog/assets/js/page-Shell正则表达式.ebfdf1ff.js"><link rel="prefetch" href="/blog/assets/js/page-Shell流程控制---case分支语句.332bd80e.js"><link rel="prefetch" href="/blog/assets/js/page-Shell流程控制---for循环语句.de1b1b0b.js"><link rel="prefetch" href="/blog/assets/js/page-Shell流程控制---if判断语句.b0532849.js"><link rel="prefetch" href="/blog/assets/js/page-Shell流程控制---until循环语句.e7c9c7f3.js"><link rel="prefetch" href="/blog/assets/js/page-Shell流程控制---while循环语句.09fcf551.js"><link rel="prefetch" href="/blog/assets/js/page-Shell监控脚本.214dbdf6.js"><link rel="prefetch" href="/blog/assets/js/page-Shell脚本---lamp环境安装.02e925e4.js"><link rel="prefetch" href="/blog/assets/js/page-Shell脚本介绍.a9743a4a.js"><link rel="prefetch" href="/blog/assets/js/page-Shell脚本笔记.333fc9cf.js"><link rel="prefetch" href="/blog/assets/js/page-Shell语法.af36ce2b.js"><link rel="prefetch" href="/blog/assets/js/page-Shell运算.2f6e1b67.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之Application对象.dc3d863e.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之Range对象.aff14b9e.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之Shape、Chart对象.c8437d84.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之Sheet对象.40acafa7.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之Workbook对象.4b6ac3e5.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之使用对话框.32011bcc.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之函数的使用.60f6a8be.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之控件与用户窗体1.b004969b.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之控件与用户窗体2.0ca5f6c7.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之控件与用户窗体3.d9a20920.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之文件操作.5f150c21.js"><link rel="prefetch" href="/blog/assets/js/page-VBA之菜单和工具栏.ec98d91f.js"><link rel="prefetch" href="/blog/assets/js/page-linux三剑客.e71431d8.js"><link rel="prefetch" href="/blog/assets/js/page-linux介绍.eae8610d.js"><link rel="prefetch" href="/blog/assets/js/page-linux关机和重启命令.13f93679.js"><link rel="prefetch" href="/blog/assets/js/page-linux其他权限管理命令.cedaf338.js"><link rel="prefetch" href="/blog/assets/js/page-linux压缩、解压缩命令.6908caa3.js"><link rel="prefetch" href="/blog/assets/js/page-linux基本操作命令.e8f72eb0.js"><link rel="prefetch" href="/blog/assets/js/page-linux大杂烩.9f8cdc5c.js"><link rel="prefetch" href="/blog/assets/js/page-linux帮助命令.4fdeff8c.js"><link rel="prefetch" href="/blog/assets/js/page-linux常用网络命令.8169fd78.js"><link rel="prefetch" href="/blog/assets/js/page-linux搜索命令.8d223c34.js"><link rel="prefetch" href="/blog/assets/js/page-linux文件系统管理.859d9e24.js"><link rel="prefetch" href="/blog/assets/js/page-linux文件系统结构.a7348129.js"><link rel="prefetch" href="/blog/assets/js/page-linux文本编辑器.fa0a4df9.js"><link rel="prefetch" href="/blog/assets/js/page-linux权限管理命令.be5e8ebf.js"><link rel="prefetch" href="/blog/assets/js/page-linux用户和用户组管理.4079bdf7.js"><link rel="prefetch" href="/blog/assets/js/page-linux的管理建议.82f61a78.js"><link rel="prefetch" href="/blog/assets/js/page-linux系统启动管理.96ebf1d7.js"><link rel="prefetch" href="/blog/assets/js/page-linux系统工作管理.3c407e77.js"><link rel="prefetch" href="/blog/assets/js/page-linux系统日志管理.72ca77b7.js"><link rel="prefetch" href="/blog/assets/js/page-linux系统服务管理.46ae7426.js"><link rel="prefetch" href="/blog/assets/js/page-linux系统进程管理.d56234ab.js"><link rel="prefetch" href="/blog/assets/js/page-linux软件安装.cc84e331.js"><link rel="prefetch" href="/blog/assets/js/page-linux高级文件系统管理.9e3c9bf6.js"><link rel="prefetch" href="/blog/assets/js/page-【MSG1500】刷机.c9407606.js"><link rel="prefetch" href="/blog/assets/js/page-【OpenWRT】固件编译.0ef4cd6f.js"><link rel="prefetch" href="/blog/assets/js/page-【Padavan】固件编译.d2a97584.js"><link rel="prefetch" href="/blog/assets/js/page-【RM2100】刷机救转.c6946098.js"><link rel="prefetch" href="/blog/assets/js/page-【VuePress】博客搭建.11c20d91.js"><link rel="prefetch" href="/blog/assets/js/page-【bootimg】解包打包.9ffb0b1e.js"><link rel="prefetch" href="/blog/assets/js/page-【openwrt】编译F大N1固件.49fa444e.js"><link rel="prefetch" href="/blog/assets/js/page-【squashfs】解包打包.58587e3c.js"><link rel="prefetch" href="/blog/assets/js/page-【小娱C1C5】刷机.4e341876.js"><link rel="prefetch" href="/blog/assets/js/page-【小娱C1C5】改造计划.ce3479e5.js"><link rel="prefetch" href="/blog/assets/js/page-【斐讯N1】Armbian.3bec83f3.js"><link rel="prefetch" href="/blog/assets/js/page-【斐讯N1】开机第一屏logo替换.57e2b6fa.js"><link rel="prefetch" href="/blog/assets/js/page-【贝壳云】改造计划.89b5027b.js"><link rel="prefetch" href="/blog/assets/js/page-【魔百合Q5】改造计划.510447e8.js"><link rel="prefetch" href="/blog/assets/js/page-个人信息.60959644.js"><link rel="prefetch" href="/blog/assets/js/page-主要功能与配置演示.90c45f63.js"><link rel="prefetch" href="/blog/assets/js/page-使用Dockerfile创建镜像.39abbd05.js"><link rel="prefetch" href="/blog/assets/js/page-使用Docker镜像.f46cc3e5.js"><link rel="prefetch" href="/blog/assets/js/page-初识Docker与容器.03017897.js"><link rel="prefetch" href="/blog/assets/js/page-博客主页.ee0b8fe8.js"><link rel="prefetch" href="/blog/assets/js/page-常用网站.40b6c65e.js"><link rel="prefetch" href="/blog/assets/js/page-幻灯片页.d2d94e64.js"><link rel="prefetch" href="/blog/assets/js/page-操作Docker容器.fca5b876.js"><link rel="prefetch" href="/blog/assets/js/page-核心概念与安装配置.bf9114e2.js"><link rel="prefetch" href="/blog/assets/js/page-瞎折腾.1dfcca6f.js"><link rel="prefetch" href="/blog/assets/js/page-端口映射与容器互联.44a4b5aa.js"><link rel="prefetch" href="/blog/assets/js/page-虚拟化的发展.7ac33b9a.js"><link rel="prefetch" href="/blog/assets/js/page-访问Docker仓库.71b3e000.js"><link rel="prefetch" href="/blog/assets/js/page-项目主页.24aa2c8e.js"><link rel="prefetch" href="/blog/assets/js/vendors~flowchart.eb5798cd.js"><link rel="prefetch" href="/blog/assets/js/vendors~mermaid.f1e52241.js"><link rel="prefetch" href="/blog/assets/js/vendors~photo-swipe.46d64c2d.js"><link rel="prefetch" href="/blog/assets/js/vendors~reveal.3f88bab1.js"><link rel="prefetch" href="/blog/assets/js/vendors~waline.8e39946b.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.5649bb21.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.png" alt="KARIN" class="logo"> <!----> <span class="site-name can-hide">KARIN</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">主题色:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">主题模式:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  博客主页
</a></div><div class="nav-item"><a href="/blog/project/" class="nav-link router-link-active active"><i class="iconfont icon-folder"></i>
  项目总览
</a></div><div class="nav-item"><a href="/blog/IT/" class="nav-link"><i class="iconfont icon-blog"></i>
  知识要点
</a></div><div class="nav-item"><a href="/blog/operate/" class="nav-link"><i class="iconfont icon-operate"></i>
  捣鼓折腾
</a></div></nav> <!----> <a rel="noopener noreferrer" href="https://github.com/Ryukarin/blog" target="_blank" class="repo-link can-hide">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div vocab="https://schema.org/" typeof="Person" class="blogger-info mobile"><div data-balloon-pos="down" role="navigation" class="blogger hasIntro"><img property="image" alt="Blogger Avatar" src="/blog/logo.png" class="avatar round"> <div property="name" class="name">karin</div> <meta property="url" content="/blog/intro/"></div> <div class="num-wrapper"><div><div class="num">106</div> <div>文章</div></div> <div><div class="num">14</div> <div>分类</div></div> <div><div class="num">18</div> <div>标签</div></div> <div><div class="num">105</div> <div>时间轴</div></div></div> <div class="media-links-wrapper"><a href="https://gitee.com/ryuukarin" rel="noopener noreferrer" target="_blank" aria-label="Gitee" data-balloon-pos="up" class="media-link"><span class="sr-only">Gitee</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-gitee"><circle cx="512" cy="512" r="512" fill="#C71D23"></circle> <path d="M772.953 454.723H480.17v.006a25.46 25.46 0 0 0-25.46 25.453l-.025 63.649a25.46 25.46 0 0 0 25.46 25.466l178.242-.007a25.46 25.46 0 0 1 25.459 25.46v12.73c0 42.18-34.198 76.378-76.378 76.378H365.583a25.46 25.46 0 0 1-25.46-25.46V416.533h-.006c0-42.18 34.192-76.378 76.378-76.378h356.388v-.013a25.46 25.46 0 0 0 25.46-25.446l.057-63.65h.013a25.46 25.46 0 0 0-25.46-25.471l-356.432.012c-105.453 0-190.946 85.493-190.946 190.946v356.433a25.46 25.46 0 0 0 25.46 25.46H626.56c94.913 0 171.852-76.94 171.852-171.852V480.182a25.46 25.46 0 0 0-25.46-25.46z" fill="#fff"></path></svg></a><a href="https://github.com/Ryukarin" rel="noopener noreferrer" target="_blank" aria-label="Github" data-balloon-pos="up" class="media-link"><span class="sr-only">Github</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-github"><circle cx="512" cy="512" r="512" fill="#171515"></circle> <path d="M509.423 146.442c-200.317 0-362.756 162.42-362.756 362.8 0 160.266 103.936 296.24 248.109 344.217 18.139 3.327 24.76-7.872 24.76-17.486 0-8.613-.313-31.427-.49-61.702-100.912 21.923-122.205-48.63-122.205-48.63-16.495-41.91-40.28-53.067-40.28-53.067-32.937-22.51 2.492-22.053 2.492-22.053 36.407 2.566 55.568 37.386 55.568 37.386 32.362 55.438 84.907 39.43 105.58 30.143 3.296-23.444 12.667-39.43 23.032-48.498-80.557-9.156-165.246-40.28-165.246-179.297 0-39.604 14.135-71.988 37.342-97.348-3.731-9.178-16.18-46.063 3.556-96.009 0 0 30.46-9.754 99.76 37.19 28.937-8.048 59.97-12.071 90.823-12.211 30.807.14 61.843 4.165 90.822 12.21 69.26-46.944 99.663-37.189 99.663-37.189 19.792 49.946 7.34 86.831 3.61 96.01 23.25 25.359 37.29 57.742 37.29 97.347 0 139.366-84.82 170.033-165.637 179.013 13.026 11.2 24.628 33.342 24.628 67.182 0 48.498-.445 87.627-.445 99.521 0 9.702 6.535 20.988 24.945 17.444 144.03-48.067 247.881-183.95 247.881-344.175 0-200.378-162.442-362.798-362.802-362.798z" fill="#FFF"></path></svg></a></div></div> <hr> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  博客主页
</a></div><div class="nav-item"><a href="/blog/project/" class="nav-link router-link-active active"><i class="iconfont icon-folder"></i>
  项目总览
</a></div><div class="nav-item"><a href="/blog/IT/" class="nav-link"><i class="iconfont icon-blog"></i>
  知识要点
</a></div><div class="nav-item"><a href="/blog/operate/" class="nav-link"><i class="iconfont icon-operate"></i>
  捣鼓折腾
</a></div> <a rel="noopener noreferrer" href="https://github.com/Ryukarin/blog" target="_blank" class="repo-link">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><a href="/blog/" aria-current="page" class="sidebar-link"><i class="iconfont icon-home"></i>博客主页</a></li><li><a href="/blog/project/" aria-current="page" class="sidebar-link"><i class="iconfont icon-folder"></i>项目主页</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-blog"></i> <span class="title">知识要点</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-operate"></i> <span class="title">捣鼓折腾</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-linux"></i> <span class="title">Linux基础知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable open"><i class="iconfont icon-linux"></i> <span class="title">Linux系统管理</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/project/Linux_manage/" aria-current="page" class="sidebar-link">linux高级文件系统管理</a></li><li><a href="/blog/project/Linux_manage/01.linux_boot/" class="sidebar-link">linux系统启动管理</a></li><li><a href="/blog/project/Linux_manage/02.linux_service/" class="sidebar-link">linux系统服务管理</a></li><li><a href="/blog/project/Linux_manage/03.linux_process/" class="sidebar-link">linux系统进程管理</a></li><li><a href="/blog/project/Linux_manage/04.linux_work/" class="sidebar-link">linux系统工作管理</a></li><li><a href="/blog/project/Linux_manage/05.linux_log/" class="sidebar-link">linux系统日志管理</a></li><li><a href="/blog/project/Linux_manage/06.LAMP_LNMP_evn/" class="sidebar-link">LAMP和LNMP环境搭建</a></li><li><a href="/blog/project/Linux_manage/07.linux_backup_recover/" aria-current="page" class="active sidebar-link">linux数据备份与恢复</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#备份的重要性" class="sidebar-link">备份的重要性</a></li><li class="sidebar-sub-header"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#linux-中的哪些数据需要备份" class="sidebar-link">Linux 中的哪些数据需要备份</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#linux-服务器中的重要数据" class="sidebar-link heading3">Linux 服务器中的重要数据</a></li><li class="sidebar-sub-header"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#安装服务的数据" class="sidebar-link heading3">安装服务的数据</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#备份策略" class="sidebar-link">备份策略</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#完全备份" class="sidebar-link heading3">完全备份</a></li><li class="sidebar-sub-header"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#累计增量备份" class="sidebar-link heading3">累计增量备份</a></li><li class="sidebar-sub-header"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#差异增量备份" class="sidebar-link heading3">差异增量备份</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#备份和恢复" class="sidebar-link">备份和恢复</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#dump-命令" class="sidebar-link heading3">dump 命令</a></li><li class="sidebar-sub-header"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#restore-命令" class="sidebar-link heading3">restore 命令</a></li><li class="sidebar-sub-header"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#dd命令" class="sidebar-link heading3">dd命令</a></li></ul></li></ul></li><li><a href="/blog/project/Linux_manage/08.SELinux/" class="sidebar-link">SELinux管理</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-linux"></i> <span class="title">Linux大杂烩</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-shell"></i> <span class="title">Shell笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-geometry"></i> <span class="title">Docker笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-git"></i> <span class="title">Git笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable"><i class="iconfont icon-note"></i> <span class="title">Excel修炼秘籍</span> <span class="arrow right"></span></p> <!----></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav display="true" class="breadcrumb"><ol vocab="https://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a href="/blog/project/" property="item" typeof="WebPage" class="router-link-active"><i class="iconfont icon-folder"></i> <span property="name">项目主页</span></a> <meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem"><a href="/blog/project/Linux_manage/" property="item" typeof="WebPage" class="router-link-active"><!----> <span property="name">linux高级文件系统管理</span></a> <meta property="position" content="2"></li><li property="itemListElement" typeof="ListItem" class="is-active"><a href="/blog/project/Linux_manage/07.linux_backup_recover/" aria-current="page" property="item" typeof="WebPage" class="router-link-exact-active router-link-active"><!----> <span property="name">linux数据备份与恢复</span></a> <meta property="position" content="3"></li></ol></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">linux数据备份与恢复</span></h1> <div class="page-info"><!----> <span aria-label="作者🖊" data-balloon-pos="down" categoryPath="/category/$category/" tagPath="/tag/$tag/"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon author-icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z" fill="currentColor"></path></svg> <span property="author">karin</span></span><span aria-label="访问量🔢" data-balloon-pos="down" defaultAuthor="karin" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="visitor-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon eye-icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 0 0-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z" fill="currentColor"></path></svg> <span id="/blog/project/Linux_manage/07.linux_backup_recover/" data-flag-title="linux数据备份与恢复" class="leancloud_visitors waline-visitor-count"><span class="leancloud-visitors-count">...</span></span></span><span aria-label="写作日期📅" data-balloon-pos="down" defaultAuthor="karin" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2021-06-1</span></span><!----><span aria-label="标签🏷" data-balloon-pos="down" defaultAuthor="karin" categoryPath="/category/$category/"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon tag-icon"><path d="M939.902 458.563 910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 0 0 0 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z" fill="currentColor"></path></svg> <ul class="tags-wrapper"><li class="tag clickable tag0"><span role="navigation">Linux</span></li></ul> <meta property="keywords" content="Linux"></span><span aria-label="阅读时间⌛" data-balloon-pos="down" defaultAuthor="karin" categoryPath="/category/$category/" tagPath="/tag/$tag/" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>大约 29 分钟</span> <meta property="timeRequired" content="PT29M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#备份的重要性" class="anchor-link heading2"><div>备份的重要性</div></a></li><li class="anchor"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#linux-中的哪些数据需要备份" class="anchor-link heading2"><div>Linux 中的哪些数据需要备份</div></a></li><li class="anchor"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#linux-服务器中的重要数据" class="anchor-link heading3"><div>Linux 服务器中的重要数据</div></a></li><li class="anchor"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#安装服务的数据" class="anchor-link heading3"><div>安装服务的数据</div></a></li><li class="anchor"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#备份策略" class="anchor-link heading2"><div>备份策略</div></a></li><li class="anchor"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#完全备份" class="anchor-link heading3"><div>完全备份</div></a></li><li class="anchor"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#累计增量备份" class="anchor-link heading3"><div>累计增量备份</div></a></li><li class="anchor"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#差异增量备份" class="anchor-link heading3"><div>差异增量备份</div></a></li><li class="anchor"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#备份和恢复" class="anchor-link heading2"><div>备份和恢复</div></a></li><li class="anchor"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#dump-命令" class="anchor-link heading3"><div>dump 命令</div></a></li><li class="anchor"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#restore-命令" class="anchor-link heading3"><div>restore 命令</div></a></li><li class="anchor"><a href="/blog/project/Linux_manage/07.linux_backup_recover/#dd命令" class="anchor-link heading3"><div>dd命令</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><p>不知道大家有没有丢失过重要的数据呢？</p> <p>丢失数据的理由是多种多样的，有人是因为重装系统时，没有把加密文件的密钥导出，重装系统后密钥丢失，导致所有的加密数据不能解密；也有人是因为在火车上笔记本电脑被别人调包，从而导致硬盘中的重要数据丢失；还有人是因为在系统中误执行了 <code>rm -rf</code> 命令，导致整个根目录被人为清空。但由此带来的后果是一样严重的。</p> <p>保护重要数据的最有效的方法就是“不要把鸡蛋都放在一只篮子里”，这就是数据备份最主要的作用。</p> <h2 id="备份的重要性"><a href="#备份的重要性" class="header-anchor">#</a> 备份的重要性</h2> <p>前面我们已经学习了很多有关 Linux  系统的安全防范策略（例如用户管理、权限管理等），但安全永远是相对的，而不是绝对的。系统硬件的损坏，黑客的无孔不入，都是系统安全的大敌。在这种情况下，如果我们要保证系统安全和应用安全，备份是必不可少的一个步骤。</p> <p>虽然 Linux 系统难免会因内部环境、底层硬件、外来黑客等因素的影响出现问题，但作为一名系统管理人员，自身的职责并不是要保证系统永远不出问题（事实上也是不可能做到的），而是要在系统出现故障或者崩溃时，能以最快的速度，用最短时间恢复系统的运行，保证数据的安全，从而将故障带来的损失降到最低。</p> <p>要实现这样的目标，就要求系统管理人员对系统和业务应用有一个合理的备份恢复策略，完美的备份策略可以保证业务的 0 宕机时间和数据的完全恢复。有人说，既然数据备份非常重要，那我把重要数据在硬盘中保存一份，在移动硬盘中也保存一份，再刻录一张光盘，这样数据应该非常安全了吧？</p> <p>对个人用户来讲，这样保存数据已经足够了；但是对企业用户来讲，还是有安全隐患的，因为这些数据还是放在同一个地方的。还记得美国的“9·11”事件吗？像美国纽约世贸中心那样的庞然大物也轰然倒塌。当然，相比这样的灾难来讲，数据的损失已经是微不足道的了，不过这仍然说明异地备份的重要性。所以，我们在备份数据的时候，不仅要把数据保存在多个存储介质中，还要考虑把重要数据异地保存。</p> <p>至于在 Linux 系统中，有哪些数据应该被视为重要数据，又该如何备份？</p> <h2 id="linux-中的哪些数据需要备份"><a href="#linux-中的哪些数据需要备份" class="header-anchor">#</a> Linux 中的哪些数据需要备份</h2> <p>既然备份这么重要，那么对 Linux 服务器来讲，我们到底需要备份哪些数据呢？当然最理想的就是把整块硬盘中的数据都备份，甚至连分区和文件系统都备份，这样如果硬盘损坏，那么我们可以直接把备份硬盘中的数据导入损坏的硬盘，甚至可以直接用备份硬盘代替损坏的硬盘。从数据恢复角度来说，这样的整盘备份是最方便的（<code>dd</code> 命令就可以实现整盘备份，类似于 Windows 中的 GHOST 软件)。不过这种备份的备份时间比较长，占用的硬盘空间较大，不太适合经常进行。我们最常进行的备份还是把系统中的重要数据进行备份。那么，哪些数据是 Linux 服务器中较为重要的、需要定时备份的数据呢？</p> <h3 id="linux-服务器中的重要数据"><a href="#linux-服务器中的重要数据" class="header-anchor">#</a> Linux 服务器中的重要数据</h3> <p>Linux 服务器中的哪些数据需要备份，可能不同的管理员有不同的理解，不过有这样一些数据是大家公认的需要备份的数据。</p> <ul><li><p><code>/root/</code> 目录：<code>/toot/</code> 目录是管理员的家目录，很多管理员会习惯在这个目录中保存一些相关数据，那么，当进行数据备份时，需要备份此目录。</p></li> <li><p><code>/home/</code> 目录：<code>/home/</code> 目录是普通用户的家目录。如果是生产服务器，那么这个目录中也会保存大量的重要数据，应该备份。</p></li> <li><p><code>/var/spool/mail/</code> 目录：在默认情况下，所有的用户未读的邮件会保存在 <code>/var/spool/mail/</code> 目录下和用户名相同的邮箱文件中，已读的邮件会保存在用户家目录下的 <code>mbox</code> 文件中（<code>mail</code> 命令默认如此保存，不过如果使用了 <code>hold</code> 命令，那么不管邮件是否已读，都保存在 <code>/var/spool/mail/</code> 目录中。可以使用 <code>mbox</code> 命令恢复已读邮件保存在 <code>~/mbox</code> 文件中）。一般情况下，用户的邮件也是需要备份的重要数据。</p></li> <li><p><code>/etc/</code> 目录：系统重要的配置文件保存目录，当然需要备份。</p></li> <li><p>其他目录：根据系统的具体情况，备份你认为重要的目录。比如，我们的系统中有重要的日志，或者安装了 RPM 包的 MySQL 服务器（RPM 包安装的 mysql 服务，数据库保存在 <code>/var/lib/mysql/</code>目录中)，那么 <code>/var/</code> 目录就需要备份；如果我们的服务器中安装了多个操作系统，或编译过新的内核，那么 <code>/boot</code> 目录就需要备份。</p></li></ul> <h3 id="安装服务的数据"><a href="#安装服务的数据" class="header-anchor">#</a> 安装服务的数据</h3> <p>我们的 Linux 服务器中会安装各种各样的应用程序，这些程序当然也有重要数据需要备份。不过应用程序是多种多样的，每种应用程序到底应该备份什么数据也不尽相同，要具体情况具体对待。这里拿最常见的 apache 服务和 mysql 服务来举例。</p> <ul><li>apache 服务需要备份如下内容：
<ul><li>配置文件。RPM 包安装的 apache 需要备份 <code>/etc/httpd/con/hpptd.conf</code>；源码包安装的 apache 则需要备份 <code>/usr/local/apache2/conf/httpd.conf</code>。</li> <li>网页主目录。RPM 包安装的 apache 需要备份 <code>/var/www/html/</code> 目录中所有的数据；源码包安装的 apache 需要备份 <code>/usr/local/apache2/htdocs/</code> 目录中所有的数据。</li> <li>日志文件。RPM 包安装的 apache 需要备份 <code>/var/log/httpd/</code> 目录中所有的日志；源码包安装的 apache 需要备份 <code>/usr/local/apache2/logs/</code> 目录中所有的日志。</li></ul></li></ul> <p>其实，对源码包安装的 apache 来讲，只要备份 <code>/usr/ocal/apache2/</code> 目录中所有的数据即可，因为源码包安装的服务的所有数据都会保存到指定目录中。但如果是 RPM 包安装的服务，就需要单独记忆和指定了。</p> <ul><li>mysql 服务需要备份如下内容：
<ul><li>对于源码包安装的 mysql 服务，数据库默认安装到 <code>/usr/local/mysql/data/</code> 目录中，只需备份此目录即可。</li> <li>对于 RPM 包安装的 mysql 服务，数据库默认安装到 <code>/var/lib/mysql/</code> 目录中，只需备份此目录即可。</li></ul></li></ul> <p>如果是源码包安装的服务，则可以直接备份 <code>/usr/local/</code> 目录，因为一般源码包服务都会安装到 <code>/usr/local/</code> 目录中。如果是 RPM 包安装的服务，则需要具体服务具体对待，备份正确的数据。</p> <h2 id="备份策略"><a href="#备份策略" class="header-anchor">#</a> 备份策略</h2> <p>常用的备份策略有<strong>完全备份</strong>和<strong>增量备份</strong>，而增量备份有可细分为累计增量备份和差异增量备份。下面来分别讲述不同备份策略以及之间的区别。</p> <h3 id="完全备份"><a href="#完全备份" class="header-anchor">#</a> 完全备份</h3> <p>完全备份是指把所有需要备份的数据全部备份。当然，完全备份可以备份整块硬盘、整个分区或某个具体的目录。对于 Linux 操作系统来说，完全备份指的就是将根目录下的所有文件进行备份。</p> <p>完全备份的好处是，所有数据都进行了备份，系统中任何数据丢失都能恢复，且恢复效率较高。如果完全备份备份的是整块硬盘，那么甚至不需要数据恢复，只要把备份硬盘安装上，服务器就会恢复正常。</p> <p>完全备份的缺点也很明显，那就是需要备份的数据量较大，备份时间较长，备份了很多无用数据，占用的空间较大，所以完全备份不可能每天执行。</p> <p>我们一般会对关键服务器进行整盘完全备份，如果出现问题，则可以很快地使用备份硬盘进行替换，从而减少损失。我们甚至会对关键服务器搭设一台一模一样的服务器，这样只要远程几个命令（或使用 Shell 脚本自动检测，自动进行服务器替换），备份服务器就会接替原本的服务器，使故障响应时间大大缩短。</p> <h3 id="累计增量备份"><a href="#累计增量备份" class="header-anchor">#</a> 累计增量备份</h3> <p>在一个数据量很大的业务应用中，每天对 Linux 系统进行完全备份是不现实的，这就需要用到增量备份策略。</p> <p>累计增量备份是指先进行一次完全备份，服务器运行一段时间之后，比较当前系统和完全备份的备份数据之间的差异，只备份有差异的数据。服务器继续运行，再经过一段时间，进行第二次增量备份。在进行第二次增量备份时，当前系统和第一次增量备份的数据进行比较，也是只备份有差异的数据。第三次增量备份是和第二次增量备份的数据进行比较，以此类推。</p> <p>因此，累计增量备份就是只备份每天增加或者变化的数据，而不备份系统中没有变动的数据。我们画一张示意图，如图8-1 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/bk1.3a51e758.jpg" alt="累计增量备份" loading="lazy"></p> <p><strong>图8-1 <u>累计增量备份</u></strong></p></div> <p>假设我们在第一天进行一次完全备份。第二天增量备份时，只会备份第二天和第一天之间的差异数据，但是第二天的总备份数据是完全备份加第一次增量备份的数据。第三天增量备份时，只会备份第三天和第二天之间的差异数据，但是第三天的总备份数据是完全备份加第一次增量备份的数据，再加第二次增量备份的数据。当然，第四天增量备份时，只会备份第四天和第三天的差异数据，但是第四天的总备份数据是完全备份加第一次增量备份的数据，加第二次增量备份的数据，再加第三次增量备份的数据。</p> <p>采用累计增量备份的好处是，每次备份需要备份的数据较少，耗时较短，占用的空间较小；坏处是数据恢复比较麻烦，如果是图1  的例子，那么当进行数据恢复时，就要先恢复完全备份的数据，再依次恢复第一次增量备份的数据、第二次增量备份的数据和第三次增量备份的数据，最终才能恢复所有的数据。</p> <h3 id="差异增量备份"><a href="#差异增量备份" class="header-anchor">#</a> 差异增量备份</h3> <p>差异增量备份（后续简称差异备份）也要先进行一次完全备份，但是和累计增量备份不同的是，每次差异备份都备份和原始的完全备份不同的数据。也就是说，差异备份每次备份的参照物都是原始的完全备份，而不是上一次的差异备份。我们也画一张示意图，如图8-2 所示。</p> <div class="custom-block center"><p><img src="/blog/assets/img/bk2.a26379a1.jpg" alt="差异增量备份" loading="lazy"></p> <p><strong>图8-2	<u>差异增量备份</u></strong></p></div> <p>假设我们在第一天也进行一次完全备份。第二天差异备份时，会备份第二天和第一天之间的差异数据，而第二天的备份数据是完全备份加第一次差异备份的数据。第三天进行差异备份时，仍和第一天的原始数据进行对比，把第二天和第三天所有的数据都备份在第二次差异备份中，第三天的备份数据是完全备份加第二次差异备份的数据。第四天进行差异备份时，仍和第一天的原始数据进行对比，把第二天、第三天和第四天所有的不同数据都备份到第三次差异备份中，第四天的备份数据是完全备份加第三次差异备份的数据。</p> <p>相比较而言，差异备份既不像完全备份一样把所有数据都进行备份，也不像增量备份在进行数据恢复时那么麻烦，只要先恢复完全备份的数据，再恢复差异备份的数据即可。不过，随着时间的增加，和完全备份相比，变动的数据越来越多，那么差异备份也可能会变得数据量庞大、备份速度缓慢、占用空间较大。</p> <p>一个比较的备份策略是，对于数据量不大，并且每天数据量增加不多的系统，优先选择完全备份；对于数据量巨大，每天新增数据也很多的系统，视情况选择差异备份或者增量备份。</p> <h2 id="备份和恢复"><a href="#备份和恢复" class="header-anchor">#</a> 备份和恢复</h2> <p>其实数据备份就是把数据复制一份保存在其他位置，如果能够压缩一下，当然就更好了。那我们使用 <code>tar</code> 或 <code>cp</code> 命令可以实现数据的备份吗？当然可以，不过它们只能实现完全备份，如果要实现增量备份和差异备份，就必须写 Shell 脚本来实现了。</p> <p>作为 Linux 系统管理员，最经常使用的备份工具就是 <code>tar</code> 和 <code>cpio</code> 命令。前面已经学过，此处不做说明。</p> <div class="custom-block tip"><p class="custom-block-title">tar 备份脚本示例</p> <p>下面通过 <code>tar</code> 命令做的一个 Web 服务器的备份脚本，详细了解 <code>tar</code> 命令作为备份工具时的具体用法。</p> <p>以下是一个有关 Web 服务器的备份脚本：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token shebang important">#!/bin/sh</span>
<span class="token assign-left variable">BAKDATE</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%y%m%d<span class="token variable">`</span></span>
<span class="token assign-left variable">DATA3</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">&quot;3 days ago&quot;</span> +%y%m%d<span class="token variable">`</span></span>
<span class="token assign-left variable">osdata</span><span class="token operator">=</span>/disk1
<span class="token assign-left variable">userdata</span><span class="token operator">=</span>/disk2
<span class="token builtin class-name">echo</span> <span class="token string">&quot;backup OS data starting&quot;</span>
<span class="token function">tar</span> -zcvf /<span class="token variable">$osdata</span>/etc.data/etc_<span class="token variable">$BAKDATE</span>.tar.gz /etc
<span class="token function">tar</span> -zcvf /<span class="token variable">$osdata</span>/boot.data/boot_<span class="token variable">$BAKDATE</span>.tar.gz /boot
<span class="token function">tar</span> -zcvf /<span class="token variable">$osdata</span>/home.data/home_<span class="token variable">$BAKDATE</span>.tar.gz /home
<span class="token function">tar</span> -zcvf /<span class="token variable">$osdata</span>/root.data/root_<span class="token variable">$BAKDATE</span>.tar.gz /root
<span class="token function">tar</span> -zcvf /<span class="token variable">$userdata</span>/usr_data/usrlocal_<span class="token variable">$BAKDATE</span>.tar.gz /usr/local
<span class="token function">tar</span> -zcvf /<span class="token variable">$userdata</span>/var_www/www_<span class="token variable">$BAKDATE</span>.tar.gz /var/www
<span class="token function">cp</span> -r /<span class="token variable">$osdata</span>/* /<span class="token variable">$userdata</span>
<span class="token function">cp</span> -r /<span class="token variable">$userdata</span>/* /<span class="token variable">$osdata</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Backup OS data complete!&quot;</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;delete OS data 3 days ago&quot;</span>
<span class="token function">rm</span> -rf /<span class="token variable">$osdata</span>/etc.data/etc_<span class="token variable">$DATA3</span>.tar.gz
<span class="token function">rm</span> -rf /<span class="token variable">$osdata</span>/boot.data/boot_<span class="token variable">$DATA3</span>.tar.gz
<span class="token function">rm</span> -rf /<span class="token variable">$osdata</span>/home.data/home_<span class="token variable">$DATA3</span>.tar.gz
<span class="token function">rm</span> -rf /<span class="token variable">$osdata</span>/root.data/root_<span class="token variable">$DATA3</span>.tar.gz
<span class="token function">rm</span> -rf /<span class="token variable">$osdata</span>/usr_data/usrlocal_<span class="token variable">$DATA3</span>.tar.gz
<span class="token function">rm</span> -rf /<span class="token variable">$osdata</span>/var_www/www_<span class="token variable">$DATA3</span>.tar.gz

<span class="token function">rm</span> -rf /<span class="token variable">$userdata</span>/etc.data/etc_<span class="token variable">$DATA3</span>.tar.gz
<span class="token function">rm</span> -rf /<span class="token variable">$userdata</span>/boot.data/boot_<span class="token variable">$DATA3</span>.tar.gz
<span class="token function">rm</span> -rf /<span class="token variable">$userdata</span>/home.data/home_<span class="token variable">$DATA3</span>.tar.gz
<span class="token function">rm</span> -rf /<span class="token variable">$userdata</span>/root.data/root_<span class="token variable">$DATA3</span>.tar.gz
<span class="token function">rm</span> -rf /<span class="token variable">$userdata</span>/usr_data/usrlocal_<span class="token variable">$DATA3</span>.tar.gz
<span class="token function">rm</span> -rf /<span class="token variable">$userdata</span>/var_www/www_<span class="token variable">$DATA3</span>.tar.gz
<span class="token builtin class-name">echo</span> <span class="token string">&quot;delete cws ok!&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>上面这段脚本完成的工作是，将系统和用户的备份数据分别保存在两个不同的本地磁盘 disk1 和 disk2 中，并且保留最近 3 天的数据，3 天前的数据自动删除。主要备份的数据有 <code>/etc</code> 目录、<code>/boot</code> 目录、<code>/home</code> 目录、<code>/root</code> 目录、<code>/usr/local</code> 目录和 <code>/var/www</code> 目录。当然这里只是举个例子，凡是存放数据的重要目录，都需要进行备份。</p> <p>将此脚本放到系统守护进程（类似于 Windows 下的计划任务）crontab 下，设定备份时间，即可实现定时数据备份。有关 crontab 的详细介绍，请看前面的 Linux 工作管理。</p></div> <h3 id="dump-命令"><a href="#dump-命令" class="header-anchor">#</a> dump 命令</h3> <p>在 Linux 中给我们准备了专用的备份和恢复命令，那就是 <code>dump</code> 和 <code>restore</code>，它们可以轻松地实现数据备份和数据恢复，而且它们是可以直接实现增量备份和差异备份的。</p> <p>在系统学习 <code>dump</code> 命令之前，由于 CentOS 6.x 系统默认是没有安装此命令的，因此需要我们手动安装 <code>dump</code> 命令，安装命令如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ～<span class="token punctuation">]</span><span class="token comment"># yum -y install dump</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>dump</code> 命令使用“备份级别”来实现增量备份，它支持 0～9 共 10 个备份级别。其中，0 级别指的就是完全备份，1～9 级别都是增量备份级别。</p> <p>举个列子，当我们备份一份数据时，第一次备份应该使用 0 级别，会把所有数据完全备份一次；第二次备份就可以使用 1 级别了，它会和 0 级别进行比较，把 0 级别备份之后变化的数据进行备份；第三次备份使用 2 级别，2 级别会和 1 级别进行比较，把 1 级别备份之后变化的数据进行备份，以此类推。</p> <p><u>需要注意的是，只有在备份整个分区或整块硬盘时，才能支持 1～9 的增量备份级别；如果只是备份某个文件或不是分区的目录，则只能使用 0 级别进行完全备份。</u></p> <p><code>dump</code> 命令的基本格式如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># dump [选项] 备份之后的文件名 原文件或目录</span>
选项：
	-level		：就是我们说的 <span class="token number">0</span>～9 共 <span class="token number">10</span> 个备份级别
	-f 文件名	：指定备份之后的文件名
	-u			：备份成功之后，把备份时间、备份级别以及实施备份的文件系统等信息，都记录在 /etc/dumpdates 文件中
	-v			：显示备份过程中更多的输出信息
	-j			：调用 bzlib 库压缩备份文件，其实就是把备份文件压缩为 .bz2 格式，默认压缩等级是 <span class="token number">2</span>
	-W			：显示允许被 dump 的分区的备份等级及备份时间
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>dump</code> 命令是一个较为复杂的命令，如果我们只是想要实现数据的备份与恢复，那么掌握以上几个选项就足够了。</p> <h4 id="备份分区"><a href="#备份分区" class="header-anchor">#</a> 备份分区</h4> <p>​</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># df -h</span>
文件系统	容量	已用	可用	已用%	挂载点
/dev/sda3	20G		<span class="token number">3</span>.0G	16G		<span class="token number">17</span>%		/
tmpfs		306M	<span class="token number">0</span>		306M	<span class="token number">0</span>%		/dev/shm
/dev/sda1	194M	26M		158M	<span class="token number">15</span>%		/boot
/dev/sr0	<span class="token number">3</span>.5G	<span class="token number">3</span>.5G	<span class="token number">0</span>		<span class="token number">100</span>%	/mnt/cdrom
<span class="token comment">#系统中我们就分了/分区和/boot分区。根分区太大,备份速度太慢,我们还是备份/boot分区吧</span>
<span class="token punctuation">[</span>rootSlocalhost ~<span class="token punctuation">]</span><span class="token comment"># dump -0uj -f /root/boot.bak.bz2 /boot/</span>
<span class="token comment">#备份命令。先执行一次完全备份,并压缩和更新备份时间</span>
DUMP: Date of this level <span class="token number">0</span> dump: Wed Jun <span class="token number">5</span> 03:08:22 <span class="token number">2013</span>
<span class="token comment">#备份的级别和时间</span>
DUMP: Dumping /dev/sdal <span class="token punctuation">(</span>/boot<span class="token punctuation">)</span> to /root/boot.bak.bz2
<span class="token comment">#备份源和目标</span>
DUMP: Label: none
<span class="token comment">#分区没有卷标</span>
DUMP: Writing <span class="token number">10</span> Kilobyte records
DUMP: Compressing output at compression level <span class="token number">2</span> <span class="token punctuation">(</span>bzlib<span class="token punctuation">)</span>
<span class="token comment">#备份时压缩</span>
DUMP: mapping <span class="token punctuation">(</span>Pass I<span class="token punctuation">)</span> <span class="token punctuation">[</span>regular files<span class="token punctuation">]</span>
DUMP: mapping <span class="token punctuation">(</span>Pass II<span class="token punctuation">)</span> <span class="token punctuation">[</span>directories<span class="token punctuation">]</span>
DUMP: estimated <span class="token number">21846</span> blocks.
DUMP: Volume <span class="token number">1</span> started with block <span class="token number">1</span> at： Wed Jun <span class="token number">5</span> 03:08:22 <span class="token number">2013</span>
DUMP: dumping <span class="token punctuation">(</span>Pass III<span class="token punctuation">)</span> <span class="token punctuation">[</span>directories<span class="token punctuation">]</span>
<span class="token comment">#开始dump 备份</span>
DUMP: dumping <span class="token punctuation">(</span>Pass XV<span class="token punctuation">)</span> <span class="token punctuation">[</span>regular files<span class="token punctuation">]</span>
DUMP: Closing /root/boot.bak.bz2
<span class="token comment">#备份结朿，生成备份文件</span>
DUMP: Volume <span class="token number">1</span> completed at: Wed Jun <span class="token number">5</span> 03:08:30 <span class="token number">2013</span>
DUMP: Volume <span class="token number">1</span> took <span class="token number">0</span>:00:08
DUMP: Volume <span class="token number">1</span> transfer rate: <span class="token number">2370</span> kB/s
DUMP: Volume <span class="token number">1</span> 21930kB uncompressed, 18962kB compressed, <span class="token number">1.157</span>:1
<span class="token comment">#数据容量</span>
DUMP: 2X930 blocks <span class="token punctuation">(</span><span class="token number">21</span>.42MB<span class="token punctuation">)</span> on <span class="token number">1</span> volume<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
DUMP: finished <span class="token keyword">in</span> <span class="token number">7</span> seconds, throughput <span class="token number">3132</span> kBytes/sec
DUMP: Date of this level <span class="token number">0</span> dump: Wed Jun <span class="token number">5</span> 03:08:22 <span class="token number">2013</span>
DUMP: Date this dump completed: Wed Jun <span class="token number">5</span> 03:08:30 <span class="token number">2013</span>
DUMP: Average transfer rate: <span class="token number">2370</span> kB/s
DUMP: Wrote 21930kB uncompressed, 18962kB compressed, <span class="token number">1.157</span>:1
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/dumpdates</span>
<span class="token comment">#查看备份时间文件</span>
/dev/sdal	<span class="token number">0</span>	Wed Jun <span class="token number">5</span> 03:08:22 <span class="token number">2013</span> +0800
<span class="token comment">#备份的分区	备份级别	备份曰期</span>
<span class="token punctuation">[</span>root@localhost @<span class="token punctuation">]</span><span class="token comment"># ll -h /root/boot.bak.bz2</span>
-rw-r--r--. <span class="token number">1</span> root root 19M <span class="token number">6</span> 月 <span class="token number">5</span> 03:08 /root/boot.bak.bz2
<span class="token comment">#备份文件生成了</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>如果 <code>/boot</code> 分区的内容发生了变化，则可以使用 1 级别进行增量备份。当然，如果数据会继续发生变化，则可以继续使用 2～9 级别增量备份。命令如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ll -h /root/install.log</span>
-rw-r--r--.1 root root 25K <span class="token number">4</span>月 <span class="token number">10</span> <span class="token number">21</span>：49 /root/install.log
<span class="token comment">#查看安装软件包日志的大小为25KB</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cp install.log /boot/</span>
<span class="token comment">#复制日志文件到/boot分区</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># dump -1uj -f /root/boot.bak1.bz2 /boot/</span>
<span class="token comment">#增量备份/boot分区，并压缩</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ll -h boot.bak*</span>
-rw-r--r--.1 root root 18K <span class="token number">6</span>月 <span class="token number">5</span> 03：16 boot.bak1.bz2
-rw-r--r--.1 root root 19M <span class="token number">6</span>月 <span class="token number">5</span> 03：08 boot.bak.bz2
<span class="token comment">#boot.bak1.bz2压缩文件只有18KB，证明增量备份只备份了0级别以后变化的数据</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>如果备份的是整个分区，那么是可以使用 <code>dump -W</code> 命令来查询分区的备份时间及备份级别的。不过要注意，如果备份时没有使用“-u”选项，那么 <code>dump -W</code> 命令是不会记录备份的时间和级别的。命令如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># dump -W</span>
Last dump<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">done</span> <span class="token punctuation">(</span>Dump <span class="token string">'&gt;'</span> <span class="token function">file</span> systems<span class="token punctuation">)</span>：
/dev/sda3 <span class="token punctuation">(</span>		/<span class="token punctuation">)</span> Last dump：Level <span class="token number">1</span>， Date Wed Jun <span class="token number">5</span> 02：31：50 <span class="token number">2013</span>
/dev/sda1 <span class="token punctuation">(</span>	/boot<span class="token punctuation">)</span> Last dump：Level <span class="token number">1</span>， Date Wed Jun <span class="token number">5</span> 03：16：27 <span class="token number">2013</span>
<span class="token comment">#/分区和/boot分区都进行过dump备份，/boot分区的最新备份级别是1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>dump</code> 命令可以非常方便地实现增量备份，但是如何实现差异备份呢？其实也很简单，先使用 0 级别完全备份一次，以后的每次备份都使用 1 级别进行备份。</p> <h4 id="备份文件或目录"><a href="#备份文件或目录" class="header-anchor">#</a> 备份文件或目录</h4> <p><code>dump</code> 命令也可以文件或目录，不过，只要不是备份分区，就只能使用 0 级别进行完全备份，而不再支持增量备份。同时，不能使用“-u”选项更新分区的备份时间，当然也不能使用 <code>dump -W</code> 命令查询到文件或目录的备份。</p> <p>我们说 <code>/etc/</code> 目录是重要的配置文件目录，那么我们就备份这个目录来看看吧。命令如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># dump -0j -f /root/etc.dump.bz2 /etc/</span>
<span class="token comment">#完全备份/etc/目录</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ll -h /root/etc.dump.bz2</span>
-rw-r--r--.1 root root <span class="token number">8</span>.6M <span class="token number">6</span>月 <span class="token number">5</span> 03：26 /root/etc.dump.bz2
<span class="token comment">#查看备份文件</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>不过，如果使用增量备份会怎么样呢？命令如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># dump -1j -f /root/etc.dump1.bz2 /etc/</span>
DUMP：Only level <span class="token number">0</span> dumps are allowed on a subdirectory
DUMP：The ENTIRE dump is aborted.
<span class="token comment">#备份失败了，目录备份只能使用0级别</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="restore-命令"><a href="#restore-命令" class="header-anchor">#</a> restore 命令</h3> <p><code>restore</code> 命令是 <code>dump</code> 命令的配套命令，<code>dump</code> 命令是用来备份分区和数据的，而 <code>restore</code> 命令是用来恢复数据的。</p> <p><code>restore</code> 命令的基本格式如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># restore [模式选项] [-f]</span>
模式选项：
	restore 命令常用的模式有以下 <span class="token number">4</span> 种，这 <span class="token number">4</span> 种模式不能混用：
	-C：比较备份数据和实际数据的变化。如果实际数据中的现有数据发生了变化，那么这个选项能够检测到这个变化。
		但是如果实际数据中新增了数据，那么这个选项是不能检测到变化的
	-i：进入交互模式，手工选择需要恢复的文件
	-t：查看模式，用于查看备份文件中拥有哪些数据
	-r：还原模式，用于数据还原
	
选项：	
	-f：选项用于指定备份文件的文件名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="比较备份数据和实际数据的变化"><a href="#比较备份数据和实际数据的变化" class="header-anchor">#</a> 比较备份数据和实际数据的变化</h4> <p>这里大家需要注意，数据比较只有在原有数据减少或发生变化时才能检测到变化，而新增的数据是不会被检测到的。命令如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># touch /boot/abc</span>
<span class="token comment">#在/boot/目录中新建abc文件</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># restore -C -f /root/boot.bak.bz2</span>
Dump tape is compressed.
Dump date：Wed Jun <span class="token number">5</span> 08：20：02 <span class="token number">2013</span>
Dumped from：the epoch
Level <span class="token number">0</span> dump of /boot on localhost：/dev/sda1
Label：none
filesys <span class="token operator">=</span> /boot
<span class="token comment">#restore检测，没有发现任何变化（当然，因为备份数据在备份时没有abc文件，所以restore命令是不能识别新建文件的）</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># mv /boot/vmlinuz-2.6.32-279.el6.i686 /boot/vmlinuz-2.6.32-279.el6.i686.bak</span>
<span class="token comment">#把/boot/目录中的内核镜像文件改一个名字</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># restore -C -f /root/boot.bak.bz2</span>
Dump tape is compressed.
Dump date：Wed Jun <span class="token number">5</span> 08：20：02 <span class="token number">2013</span>
Dumped from：the epoch
Level <span class="token number">0</span> dump of /boot on localhost：/dev/sda1
Label：none
filesys <span class="token operator">=</span> /boot
restore：unable to <span class="token function">stat</span> ./vmlinuz-2.6.32-279.el6.i686：No such <span class="token function">file</span> or directory Some files were modified！ <span class="token number">1</span> compare errors
<span class="token comment">#restore发现内核镜像文件丢失</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>这个实验比较危险，一定要记得把内核镜像文件的名字改回来，否则一旦重启，系统就会无法正常启动。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># mv /boot/vmlinuz-2.6.32-279.el6.i686.bak /boot/vmlinuz2.6.32-279.el6.i686</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="查看模式"><a href="#查看模式" class="header-anchor">#</a> 查看模式</h4> <p>这种模式比较简单，就是查看备份文件中到底包含什么内容。命令如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># restore -t -f boot.bak.bz2</span>
Dump tape is compressed．
<span class="token comment">#备份数据是压缩的</span>
Dump date：Wed Jun <span class="token number">5</span> 08：20：02 <span class="token number">2013</span>
<span class="token comment">#数据备份时间</span>
Dumped from：the epoch
Level <span class="token number">0</span> dump of /boot on localhost：/dev/sda1
<span class="token comment">#备份等级</span>
Label：none
<span class="token comment">#分区的卷标，没有设定卷标</span>
<span class="token number">2</span>.
<span class="token number">11</span> ./lost+found
<span class="token number">12</span> ./grub
<span class="token number">24</span> ./grub/grub.conf
<span class="token number">13</span> ./grub/splash.xpm.gz
<span class="token punctuation">..</span>.省略部分输出<span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="还原模式"><a href="#还原模式" class="header-anchor">#</a> 还原模式</h4> <p><code>restore</code> 命令的还原模式既可以用于还原整个分区，也可以用于还原文件或目录。命令格式是一样的，不过要注意，如果要还原增量备份的数据，则一定要先还原完全备份的数据。命令如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#还原boot.bak.bz2分区备份</span>
<span class="token comment">#先还原完全备份的数据</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># mkdir boot.test</span>
<span class="token comment">#建立准备解压缩的目录。当然，如果这个目录是我新建的分区，就可以直接把数据恢复到分区中</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cd boot.test/</span>
<span class="token comment">#进入解压缩目录</span>
<span class="token punctuation">[</span>root@localhost boot.test<span class="token punctuation">]</span><span class="token comment"># restore -r -f /root/boot.bak.bz2</span>
Dump tape is compressed.
<span class="token comment">#备份数据是压缩数据</span>
<span class="token comment">#解压缩</span>
<span class="token punctuation">[</span>root@localhost boot.test<span class="token punctuation">]</span><span class="token comment"># ll</span>
<span class="token comment">#查看一下解压缩的文件</span>
总用量21300
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">106611</span> <span class="token number">6</span>月 <span class="token number">22</span> <span class="token number">20</span>:12 config-2.6.32-279.el6.i686
drwxr-xr-x. <span class="token number">3</span> root root <span class="token number">4096</span> <span class="token number">4</span> 月 <span class="token number">10</span> <span class="token number">21</span>:47 efi
drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">4096</span> <span class="token number">4</span> 月 <span class="token number">10</span> <span class="token number">21</span>:49 grub
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">14708399</span> <span class="token number">4</span> 月 <span class="token number">10</span> <span class="token number">21</span>:49 initrara£s-2.6.32-279.el6.i686.img
drwx------. <span class="token number">2</span> root root <span class="token number">4096</span> <span class="token number">4</span> 月 <span class="token number">10</span> <span class="token number">21</span>:44 lost+found
-rw-------. <span class="token number">1</span> root root <span class="token number">47504</span> <span class="token number">6</span> 月 <span class="token number">5</span> 09:44 restoresymtable
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">175903</span> <span class="token number">6</span> 月 <span class="token number">22</span> <span class="token number">20</span>:12 symvers-2.6.32-279.el6.i686.gz
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">1846041</span> <span class="token number">6</span> 月 <span class="token number">22</span> <span class="token number">20</span>:12 System.map-2.6.32-279.el6.i686
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">1048576</span> <span class="token number">6</span> 月 <span class="token number">5</span> 02:38 <span class="token builtin class-name">test</span>
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">3856608</span> <span class="token number">6</span> 月 <span class="token number">22</span> <span class="token number">20</span>:12 vmlinuz-2.6.32-279.el6.i686
<span class="token comment">#再还原增量备份的数据</span>
<span class="token punctuation">[</span>root@localhost boot.test<span class="token punctuation">]</span><span class="token comment"># restore -r -f /root/boot.bakl.bz2</span>
Dump tape is compressed.
<span class="token comment">#恢复增量备份的数据</span>
<span class="token punctuation">[</span>root@localhost boot.test<span class="token punctuation">]</span><span class="token comment"># ll</span>
总用量21328
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">106611</span> <span class="token number">6</span> 月 <span class="token number">22</span> <span class="token number">20</span>:12 config-2.6.32-279.el6.i686
drwxr-xr-x. <span class="token number">3</span> root root <span class="token number">4096</span> <span class="token number">4</span> 月 <span class="token number">10</span> <span class="token number">21</span>:47 efi
drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">4096</span> <span class="token number">4</span> 月 <span class="token number">10</span> <span class="token number">21</span>:49 grub
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">14708399</span> <span class="token number">4</span> 月 <span class="token number">10</span> <span class="token number">21</span>:49 initramfs-2.6.32-279.eX6.i686.img
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">24772</span> <span class="token number">6</span> 月 <span class="token number">5</span> 08:20 install. log
<span class="token comment">#增量备份的install.log文件被恢复了</span>
drwx------. <span class="token number">2</span> root root <span class="token number">4096</span> <span class="token number">4</span> 月 <span class="token number">10</span> <span class="token number">21</span>:44 lost+found
-rw-------. <span class="token number">1</span> root root <span class="token number">47552</span> <span class="token number">6</span> 月 <span class="token number">5</span> 09:57 restoresymtable
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">175903</span> <span class="token number">6</span> 月 <span class="token number">22</span> <span class="token number">20</span>:12 symvers-2.6.32-279.el6.i686.gz
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">1846041</span> <span class="token number">6</span> 月 <span class="token number">22</span> <span class="token number">20</span>:12 System.map-2.6.32-279.el6.i686
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">1048576</span> <span class="token number">6</span> 月 <span class="token number">5</span> 02:38 <span class="token builtin class-name">test</span>
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">3856608</span> <span class="token number">6</span>月 <span class="token number">22</span> <span class="token number">20</span>:12 vmlinuz-2.6.32-279.el6.i686
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>我们再来还原 <code>/etc/</code> 目录的备份 <code>etc.dump.bz2</code>，其实还原的方法是完全一样的。命令如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># restore -r -f etc.dump.bz2</span>
Dump tape is compressed.
<span class="token comment">#还原etc.dump.bz2备份</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ll -d /root/etc</span>
drwxr-xr-x.103 root root <span class="token number">12288</span> <span class="token number">6</span>月 <span class="token number">5</span> 07:45 /root/etc
<span class="token comment">#在root下生成了etc目录，里面的数据和/etc/目录中的数据完全一致</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="dd命令"><a href="#dd命令" class="header-anchor">#</a> dd命令</h3> <p><code>dd</code> 命令主要用来进行数据备份，并且可以在备份的过程中进行格式转换。其实 <code>dd</code> 命令可以把源数据复制成目标数据，而且不管源数据是文件、分区、磁盘还是光盘，都可以进行数据备份。</p> <p><code>dd</code> 命令的基本格式如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># dd if=&quot;输入文件&quot; of=&quot;输出文件&quot; bs=&quot;数据块&quot; count=&quot;数量&quot;</span>
参数：
	<span class="token keyword">if</span>			：定义输入数据的文件，也可以是输入设备；
	of			：定义输出数据的文件，也可以是输出设备；
	bs			：指定数据块的大小，也就是定义一次性读取或写入多少字节。模式数据块大小是 <span class="token number">512</span> 字节；
	count		：指定 bs 的数量；
	<span class="token assign-left variable">conv</span><span class="token operator">=</span>标志	：依据标志转换文件。
	
		标志有以下这些：
		ascii	：由 EBCDIC 码转换至 ASCII 码；
		ebcdic	：由 ASCII 码转换至 EBCDIC 码；
		ibm		：由 ASCII 码转换至替换的 EBCDIC 码；
		block	：将结束字符块里的换行替换成等长的空格；
		unblock	：将 cbs 大小的块中尾部的空格替换为一个换行符；
		lcase	：将大写字符转换为小写；
		notrunc	：不截断输出文件；
		ucase	：将小写字符转换为大写；
		swab	：交换每一对输入数据字节；
		noerror	：读取数据发生错误后仍然继续；
		<span class="token function">sync</span>	：将每个输入数据块以 NUL 字符填满至 ibs 的大小；当配合 block 或 unblock 时，会以空格代替 NUL 字符填充；
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="备份文件"><a href="#备份文件" class="header-anchor">#</a> 备份文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># dd if=/etc/httpd/conf/httpd.conf of=/tmp/httpd.bak</span>
记录了67+1 的读入
<span class="token comment">#数据占了写满的67个数据块，以及1个没有写满的数据块</span>
记录了67+1 的写出
<span class="token comment">#默认数据块大小是512字节</span>
<span class="token number">34439</span>字节<span class="token punctuation">(</span><span class="token number">34</span> kB<span class="token punctuation">)</span>已复制，0.0524897 秒，656 kB/秒
<span class="token comment">#如果要备份文件，那么dd命令和cp命令非常类似</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ll -h /tmp/httpd.bak</span>
-rw-r--r--.1 root root 34K <span class="token number">6</span>月 <span class="token number">5</span> <span class="token number">18</span>：04 /tmp/httpd.bak
<span class="token comment">#查看一下生成的备份文件的大小</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="备份分区为一个备份文件"><a href="#备份分区为一个备份文件" class="header-anchor">#</a> 备份分区为一个备份文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># df -h</span>
文件系统	容量	已用	可用	已用%%	挂载点
/dev/sda3	20G		<span class="token number">2</span>.0G	17G		<span class="token number">11</span>%		/
tmpfs		306M	<span class="token number">0</span>		306M	<span class="token number">0</span>%		/dev/shm
/dev/sda1	194M	27M		157M	<span class="token number">15</span>%		/boot
/dev/sr0	<span class="token number">3</span>.5G	<span class="token number">3</span>.5G	<span class="token number">0</span>		<span class="token number">100</span>%	/mnt/cdrom
<span class="token comment">#查看一下分区容量，我们备份/boot分区</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># dd if=/dev/sda1 of=/tmp/boot.bak</span>
<span class="token comment">#备份完成</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ll -h /tmp/boot.bak</span>
-rw-r--r--.1 root root 200M <span class="token number">6</span>月 <span class="token number">5</span> <span class="token number">18</span>：14 /tmp/boot.bak
<span class="token comment">#查看生成的备份文件</span>

<span class="token comment">#如果需要恢复，则执行以下命令</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># dd if=/tmp/boot.bak of=/dev/sda1</span>

<span class="token comment">#如果想要把分区直接备份成另一个分区，就需要生成一个新的分区，</span>
<span class="token comment">#这个分区的大小不能比源分区小，只能和源分区大小一致或比它大。命令如下：</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># dd if=/dev/sda1 of=/dev/sdb1</span>
<span class="token comment">#如果需要恢复，则只需把输入项和输出项反过来即可，命令如下：</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># dd if=/dev/sdb1 of=/dev/sda1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h4 id="整盘备份"><a href="#整盘备份" class="header-anchor">#</a> 整盘备份</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># dd if=/dev/sda of=/dev/sdb</span>
<span class="token comment">#把磁盘a备份到磁盘b</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># dd if=/dev/sda of=/tmp/disk.bak</span>
<span class="token comment">#把磁盘a备份成文件disk.bak</span>
<span class="token comment">#备份恢复</span>
<span class="token comment">#如果要备份到另一块硬盘上，那么，当源硬盘数据损坏时，只需用备份硬盘替换源硬盘即可</span>
<span class="token comment">#如果要备份成文件，那么在恢复时需要把备份数据复制到其他Linux中，然后把新硬盘安装到这台Linux</span>
<span class="token comment">#服务器上，再把磁盘备份数据复制到新硬盘中。命令如下</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># dd if=/tmp/disk.bak of=/dev/sdb</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="复制软盘"><a href="#复制软盘" class="header-anchor">#</a> 复制软盘</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># dd if=/dev/fd0 of=/tmp/fd.bak</span>
<span class="token comment">#在Linux中软盘的设备文件名是/dev/fd0</span>
<span class="token comment">#这条命令先把软盘中的数据保存为临时数据文件</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># dd if=/tmp/fd.bak of=/dev/fd0</span>
<span class="token comment">#然后更换新的软盘，把数据备份复制到新软盘中，就实现了软盘的复制</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="复制光盘"><a href="#复制光盘" class="header-anchor">#</a> 复制光盘</h4> <p>如果需要备份的是光盘，那么在 Linux 中就是使用 <code>dd</code> 命令制作光盘的 ISO 镜像的。命令如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#制作光盘ISO镜像</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># dd if=/dev/cdrom of=/tmp/cd.iso</span>
<span class="token comment">#把光盘中所有的数据制作成ISO镜像</span>
<span class="token punctuation">[</span>root@localhost ~J <span class="token comment"># mkdir /mnt/cd</span>
<span class="token comment">#建立一个新的挂载点</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># mount -o loop /tmp/cd.iso /mnt/cd</span>
<span class="token comment">#挂栽ISO文件到挂载点</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cd /mnt/cd</span>
<span class="token comment">#进入挂栽点</span>
<span class="token punctuation">[</span>root@localhost cd<span class="token punctuation">]</span><span class="token comment"># ls</span>
CentOS_BuildTag images RELEASE-NOTES-en-tJS.html RPM-GPG-KEY-CentOS-Debug-6 TRANS.TBL
EULA    isolinux repodata   RPM-GPG-KEY-CentOS-Security-6
GPL Packages RPM-GPG-KEY-CentOS-6 RPM-GPG-KEY-CentOS-Testing-6
<span class="token comment">#数据是光盘当中的数据,这个ISO镜像是可以被当作真正的光盘使用的</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h4> <p>我们有时需要制作指定大小的文件，比如，在增加 swap 分区时，就需要建立指定大小的文件，这时也使用 <code>dd</code> 命令。命令如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># dd if=/dev/zero of=/tmp/testfile bs=1M count=10</span>
<span class="token comment">#数据输入项是/dev/zero会向目标文件中不停地写入二进制的0</span>
<span class="token comment">#指定数据块大小是1MB</span>
<span class="token comment">#指定生成10个数据块。也就是定义输出的文件大小为10MB</span>
记录了10+0 的读入
<span class="token comment">#显示数据占满了10个数据块</span>
记录了10+0 的写出
<span class="token comment">#不过这里数据块的大小已经是1MB了</span>
<span class="token number">10485760</span>字节<span class="token punctuation">(</span><span class="token number">10</span> MB<span class="token punctuation">)</span>已复制，0.00709902 秒，1.5 GB/秒
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ll -h /tmp/testfile</span>
-rw-r--r--.1 root root 10M <span class="token number">6</span>月 <span class="token number">5</span> <span class="token number">18</span>：46 /tmp/testfile
<span class="token comment">#生成的testfile文件的大小刚好是10MB</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><code>dd</code> 命令在进行整盘复制时，类似于 GHOST 工具的功能，不过通过 <code>dd</code> 命令复制出来的硬盘数据要比 GHOST 复制出来的硬盘数据稳定得多。虽然 <code>dd</code> 命令功能强大，不过也有一个明显的缺点，就是复制的时间较长，复制 100GB 的数据需要 15～25 分钟（根据服务器的性能不同而不同）。</p> <p>实现数据备份还有非常多的方法和工具，比如 <code>tar</code> 和 <code>cpio</code> 命令。至于网络复制工具，如 rsync 和 scp 等，需要较完善的网络知识才能够学习，这里不再介绍。</p></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/Ryukarin/blog/edit/main/project/Linux_manage/07.linux_backup_recover.md" target="_blank" rel="noopener noreferrer">编辑此页</a></div> <div class="meta-item update-time"><span class="label">上次编辑于:</span> <span class="info">2022年1月26日 14:11</span></div> <div class="meta-item contributors"><span class="label">贡献者: </span> <span class="info"><span title="email: ryuukaringo@gmail.com" class="contributor">
          ryuukarin
        </span> <!----></span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/blog/project/Linux_manage/06.LAMP_LNMP_evn/" class="prev"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon prev-icon"><path d="M906.783 588.79c-.02 8.499-6.882 15.36-15.38 15.37l-443.7-.01 75.704 191.682c2.52 6.42.482 13.763-5.038 17.91-5.52 4.168-13.138 4.147-18.616-.092L123.228 524.175a15.362 15.362 0 0 1-6-12.165c0-4.782 2.222-9.277 6-12.185L499.753 210.35a15.388 15.388 0 0 1 9.38-3.195c3.236 0 6.502 1.034 9.236 3.103 5.52 4.147 7.578 11.49 5.038 17.91L447.683 419.84l443.72-.01c8.498.01 15.36 6.881 15.36 15.36l.02 153.6z" fill="currentColor"></path></svg>
        LAMP和LNMP环境搭建
      </a></span> <span class="next"><a href="/blog/project/Linux_manage/08.SELinux/">
        SELinux管理
        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon next-icon"><path d="M906.772 512c0 4.772-2.211 9.267-5.99 12.175L524.257 813.66a15.37 15.37 0 0 1-18.616.092 15.368 15.368 0 0 1-5.038-17.91l75.714-191.672h-443.73c-8.488 0-15.36-6.881-15.36-15.36v-153.6c0-8.489 6.872-15.36 15.36-15.36h443.73l-75.714-191.682a15.358 15.358 0 0 1 5.048-17.91c5.51-4.158 13.128-4.137 18.606.092l376.525 289.485a15.323 15.323 0 0 1 5.99 12.165z" fill="currentColor"></path></svg></a></span></p></div> <div class="comments-wrapper"><div class="waline-wrapper"><div id="waline-comment"></div></div></div> <!----> <div class="content__page-bottom"></div></main> <footer class="footer-wrapper"><div class="media-links-wrapper"><a href="https://gitee.com/ryuukarin" rel="noopener noreferrer" target="_blank" aria-label="Gitee" data-balloon-pos="up" class="media-link"><span class="sr-only">Gitee</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-gitee"><circle cx="512" cy="512" r="512" fill="#C71D23"></circle> <path d="M772.953 454.723H480.17v.006a25.46 25.46 0 0 0-25.46 25.453l-.025 63.649a25.46 25.46 0 0 0 25.46 25.466l178.242-.007a25.46 25.46 0 0 1 25.459 25.46v12.73c0 42.18-34.198 76.378-76.378 76.378H365.583a25.46 25.46 0 0 1-25.46-25.46V416.533h-.006c0-42.18 34.192-76.378 76.378-76.378h356.388v-.013a25.46 25.46 0 0 0 25.46-25.446l.057-63.65h.013a25.46 25.46 0 0 0-25.46-25.471l-356.432.012c-105.453 0-190.946 85.493-190.946 190.946v356.433a25.46 25.46 0 0 0 25.46 25.46H626.56c94.913 0 171.852-76.94 171.852-171.852V480.182a25.46 25.46 0 0 0-25.46-25.46z" fill="#fff"></path></svg></a><a href="https://github.com/Ryukarin" rel="noopener noreferrer" target="_blank" aria-label="Github" data-balloon-pos="up" class="media-link"><span class="sr-only">Github</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-github"><circle cx="512" cy="512" r="512" fill="#171515"></circle> <path d="M509.423 146.442c-200.317 0-362.756 162.42-362.756 362.8 0 160.266 103.936 296.24 248.109 344.217 18.139 3.327 24.76-7.872 24.76-17.486 0-8.613-.313-31.427-.49-61.702-100.912 21.923-122.205-48.63-122.205-48.63-16.495-41.91-40.28-53.067-40.28-53.067-32.937-22.51 2.492-22.053 2.492-22.053 36.407 2.566 55.568 37.386 55.568 37.386 32.362 55.438 84.907 39.43 105.58 30.143 3.296-23.444 12.667-39.43 23.032-48.498-80.557-9.156-165.246-40.28-165.246-179.297 0-39.604 14.135-71.988 37.342-97.348-3.731-9.178-16.18-46.063 3.556-96.009 0 0 30.46-9.754 99.76 37.19 28.937-8.048 59.97-12.071 90.823-12.211 30.807.14 61.843 4.165 90.822 12.21 69.26-46.944 99.663-37.189 99.663-37.189 19.792 49.946 7.34 86.831 3.61 96.01 23.25 25.359 37.29 57.742 37.29 97.347 0 139.366-84.82 170.033-165.637 179.013 13.026 11.2 24.628 33.342 24.628 67.182 0 48.498-.445 87.627-.445 99.521 0 9.702 6.535 20.988 24.945 17.444 144.03-48.067 247.881-183.95 247.881-344.175 0-200.378-162.442-362.798-362.802-362.798z" fill="#FFF"></path></svg></a></div> <div class="footer">MIT Licensed</div> <div class="copyright">Copyright © 2022 karin</div></footer></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="关闭" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">该应用可以安装在您的 PC 或移动设备上。这将使该 Web 应用程序外观和行为与其他应用程序相同。它将在出现在应用程序列表中，并可以固定到主屏幕，开始菜单或任务栏。此 Web 应用程序还将能够与其他应用程序和您的操作系统安全地进行交互。</p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>详情</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        安装 <span></span></button> <button class="cancel-button">
        取消
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="关闭" aria-label="关闭" class="pswp__button pswp__button--close"></button> <button title="分享" aria-label="分享" class="pswp__button pswp__button--share"></button> <button title="切换全屏" aria-label="切换全屏" class="pswp__button pswp__button--fs"></button> <button title="缩放" aria-label="缩放" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="上一个 (左箭头)" aria-label="上一个 (左箭头)" class="pswp__button pswp__button--arrow--left"></button> <button title="下一个 (右箭头)" aria-label="下一个 (右箭头)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/blog/assets/js/app.9f9c9b81.js" defer></script><script src="/blog/assets/js/vendors~layout-Layout.79b66223.js" defer></script><script src="/blog/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.efafecdd.js" defer></script><script src="/blog/assets/js/page-linux数据备份与恢复.f202f4a1.js" defer></script>
  </body>
</html>
