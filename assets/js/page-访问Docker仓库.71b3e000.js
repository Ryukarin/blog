(window.webpackJsonp=window.webpackJsonp||[]).push([[114],{1100:function(s,a,e){"use strict";e.r(a);var t=e(1),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("仓库（Repository）是集中存放镜像的地方，又分公共仓库和私有仓库。")]),s._v(" "),t("p",[s._v("有时候容易把仓库与注册服务器（Registry）混淆。实际上注册服务器是存放仓库的具体服务器，一个注册服务器上可以有多个仓库，而每个仓库下面可以有多个镜像。从这方面来说，仓库可以被认为是一个具体的项目或目录。例如对于仓库地址 private-docker.com/ubuntu 来说，private-docker.com 是注册服务器地址，ubuntu 是仓库名。")]),s._v(" "),t("p",[s._v("接下来，将分别介绍使用 Docker Hub 官方仓库进行登录、载等基本操作，以及使用国内社区提供的仓库下载镜像；最后还将介绍创建和使用私有仓库的基本操作。")]),s._v(" "),t("h2",{attrs:{id:"docker-hub-公共镜像市场"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-hub-公共镜像市场"}},[s._v("#")]),s._v(" Docker Hub 公共镜像市场")]),s._v(" "),t("p",[s._v("Docker Hub 是 Docker 官方提供的最大的公共镜像仓库，目前包括了超过 100000 的镜像，地址为 "),t("a",{attrs:{href:"https://hub.docker.com",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://hub.docker.com"),t("OutboundLink")],1),s._v("。大部分对镜像的需求，都可以通过在 Docker Hub 中直接下载镜像来实现，如图 5-1 所示。")]),s._v(" "),t("h3",{attrs:{id:"_1、登录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、登录"}},[s._v("#")]),s._v(" 1、登录")]),s._v(" "),t("p",[s._v("可以通过命令行执行 "),t("code",[s._v("docker login")]),s._v(" 命令来输入用户名、密码和邮箱来完成注册和登录。注册成功后，本地用户目录下会自动创建 "),t("code",[s._v(".docker/config.json")]),s._v(" 文件，保存用户的认证信息。")]),s._v(" "),t("p",[s._v("登录成功的用户可以上传个人制作的镜像到 Docker Hub。")]),s._v(" "),t("h3",{attrs:{id:"_2、基本操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、基本操作"}},[s._v("#")]),s._v(" 2、基本操作")]),s._v(" "),t("p",[s._v("用户无须登录即可通过 "),t("code",[s._v("docker search")]),s._v(" 命令来查找官方仓库中的镜像，并利用 "),t("code",[s._v("docker [image] pull")]),s._v(" 命令来将它下载到本地。")]),s._v(" "),t("div",{staticClass:"custom-block center"},[t("p",[t("img",{attrs:{src:e(646),alt:"",loading:"lazy"}})]),s._v(" "),t("p",[t("u",[s._v("图 5-1")]),s._v("\tDocker Hub 是最大的公共镜像仓库")])]),s._v(" "),t("p",[s._v("前面已经具体介绍了如何使用 "),t("code",[s._v("docker [image] pull")]),s._v(" 命令来搜寻镜像。例如以 centos 为关键词进行搜索：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" search centos\nNAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED\ncentos                            The official build of CentOS.                   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6736")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("       \nansible/centos7-ansible           Ansible on Centos7                              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("134")]),s._v("                  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nconsol/centos-xfce-vnc            Centos container with "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"headless"')]),s._v(" VNC session…  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("130")]),s._v("                  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\njdeathe/centos-ssh                OpenSSH / Supervisor / EPEL/IUS/SCL Repos - …  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("120")]),s._v("                  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ncentos/systemd                    systemd enabled base container.                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v("                  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("根据是否为官方提供，可将这些镜像资源分为两类：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("一种是类似于 centos 这样的基础镜像，也称为根镜像。这些镜像是由 Docker 公司创建、验证、支持、提供，这样的镜像往往使用单个单词作为名字；")])]),s._v(" "),t("li",[t("p",[s._v("另一种类型的镜像，比如 ansible/centos7-ansible 镜像，是由 Docker 用户 ansible 创建并维护的，带有用户名称为前缀，表明是某用户下的某仓库。可以通过用户名称前缀“user_name/镜像名”来指定使用某个用户提供的镜像。")])])]),s._v(" "),t("p",[s._v("下载官方 centos 镜像到本地，代码如下所示：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull centos\nUsing default tag: latest\nlatest: Pulling from library/centos\n7a0437f04f83: Pull complete \nDigest: sha256:5528e8b1b1719d34604c87e11dcd1c0a20bedf46e83b5632cdeac91b8c04efc1\nStatus: Downloaded newer image "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" centos:latest\ndocker.io/library/centos:latest\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("用户也可以在登录后通过 "),t("code",[s._v("docker push")]),s._v(" 命令来将本地镜像推送到 Docker Hub。")]),s._v(" "),t("h3",{attrs:{id:"_3、自动创建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、自动创建"}},[s._v("#")]),s._v(" 3、自动创建")]),s._v(" "),t("p",[s._v("自动创建（Automated Builds）是 Docker Hub 提供的自动化服务，这一功能可以自动跟随项目代码的变更而重新构建镜像。")]),s._v(" "),t("p",[s._v("例如，用户构建了某应用镜像，如果应用发布新版本，用户需要手动更新镜像。而自动创建则允许用户通过 Docker Hub 指定跟踪一个目标网站（目前支持 GitHub 或 BitBucket）上的项目，一旦项目发生新的提交，则自动执行创建。")]),s._v(" "),t("p",[s._v("要配置自动创建，包括如下的步骤：")]),s._v(" "),t("ol",[t("li",[s._v("创建并登录 Docker Hub，以及目标网站如 Github；")]),s._v(" "),t("li",[s._v("在目标网站中允许 Docker Hub 访问服务；")]),s._v(" "),t("li",[s._v("在 Docker Hub 中配置一个“自动创建”类型的项目；")]),s._v(" "),t("li",[s._v("选取一个目标网站中的项目（需要含 Dockerfile）和分支；")]),s._v(" "),t("li",[s._v("指定 Dockerfile 的位置，并提交创建。")])]),s._v(" "),t("p",[s._v("之后，可以在 Docker Hub 的“自动创建”页面中跟踪每次创建的状态。")]),s._v(" "),t("h2",{attrs:{id:"第三方镜像市场"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第三方镜像市场"}},[s._v("#")]),s._v(" 第三方镜像市场")]),s._v(" "),t("p",[s._v("国内不少云服务商都提供了 Docker 镜像市场，包括腾讯云、网易云、阿里云等。下面以"),t("a",{attrs:{href:"https://hub.tenxcloud.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("时速云"),t("OutboundLink")],1),s._v("为例，介绍如何使用这些市场，如图 5-2 所示。")]),s._v(" "),t("div",{staticClass:"custom-block center"},[t("p",[t("img",{attrs:{src:e(647),alt:"",loading:"lazy"}})]),s._v(" "),t("p",[t("u",[s._v("图 5-2")]),s._v("\t时速云镜像市场")])]),s._v(" "),t("h3",{attrs:{id:"_1、查看镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、查看镜像"}},[s._v("#")]),s._v(" 1、查看镜像")]),s._v(" "),t("p",[s._v("访问 "),t("a",{attrs:{href:"https://hub.tenxcloud.com",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://hub.tenxcloud.com"),t("OutboundLink")],1),s._v(" ，即可看到己存在的仓库和存储的镜像，包括 Ubuntu、Java、Mongo、MySQL、Nginx 等热门仓库和镜像。时速云官方仓库中的镜像会保持与Docker Hub 中官方镜像的同步。")]),s._v(" "),t("p",[s._v("以 MongoDB 仓库为例，其中包括了 2.6、3.0 和 3.2 等镜像。")]),s._v(" "),t("h3",{attrs:{id:"_2、下载镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、下载镜像"}},[s._v("#")]),s._v(" 2、下载镜像")]),s._v(" "),t("p",[s._v("下载镜像也是使用 "),t("code",[s._v("docker pull")]),s._v(" 命令，但是要在镜像名称前添加注册服务器的具体地址。格式为 index.tenxcloud.com/<namespace>/<reposito ry>:<tag >。")]),s._v(" "),t("p",[s._v("例如，要下载 Docker 官方仓库中的 node:latest 镜像，可以使用如下命令：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull hub.c.163.com/public/centos:6.5\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.5")]),s._v(": Pulling from public/centos\n96057de2d572: Pull complete \na3ed95caeb02: Pull complete \n8a1dcc3f76c2: Pull complete \n8fe56c90e86a: Pull complete \n43fc3558431f: Pull complete \n5881bc109689: Pull complete \nDigest: sha256:92fd18cda0cbf63bb4b5ffd0c073a9d689d5b202e3b491cbc74488fff1c37d11\nStatus: Downloaded newer image "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" hub.c.163.com/public/centos:6.5\nhub.c.163.com/public/centos:6.5\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("正常情况下，镜像下载会比直接从 Docker Hub 下载快得多。通过 "),t("code",[s._v("docker images")]),s._v(" 命令来查看下载到本地的镜像：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images\nREPOSITORY                    TAG       IMAGE ID       CREATED        SIZE\ntest/ubuntu                   v1.0      00cf452ac39b   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" hours ago   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("72")]),s._v(".8MB\nubuntu                        latest    fb52e22af1b0   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" days ago     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("72")]),s._v(".8MB\nubuntu                        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.04")]),s._v("     54919e10a95d   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" days ago     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(".1MB\ncentos                        latest    300e315adb2f   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" months ago   209MB\nhub.c.163.com/public/centos   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.5")]),s._v("       997f0ed97903   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" years ago    442MB\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("下载后，可以更新镜像的标签，与官方标签保持一致，方便使用：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag hub.c.163.com/public/centos:6.5  centos:6.5\nkei@kei-KVM:/etc/docker$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images\nREPOSITORY                    TAG       IMAGE ID       CREATED        SIZE\ntest/ubuntu                   v1.0      00cf452ac39b   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" hours ago   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("72")]),s._v(".8MB\nubuntu                        latest    fb52e22af1b0   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" days ago     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("72")]),s._v(".8MB\nubuntu                        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.04")]),s._v("     54919e10a95d   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" days ago     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(".1MB\ncentos                        latest    300e315adb2f   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" months ago   209MB\ncentos                        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.5")]),s._v("       997f0ed97903   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" years ago    442MB\nhub.c.163.com/public/centos   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.5")]),s._v("       997f0ed97903   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" years ago    442MB\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("除了使用这些公共镜像服务外，还可以搭建本地的私有仓库服务器。")]),s._v(" "),t("h2",{attrs:{id:"搭建本地私有仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#搭建本地私有仓库"}},[s._v("#")]),s._v(" 搭建本地私有仓库")]),s._v(" "),t("h3",{attrs:{id:"_1、创建私有仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、创建私有仓库"}},[s._v("#")]),s._v(" 1、创建私有仓库")]),s._v(" "),t("p",[s._v("安装 Docker 后，可以通过官方提供的 registry 镜像来简单搭建一套本地私有仓库环境：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull registry:2\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(": Pulling from library/registry\n6a428f9f83b0: Pull complete \n90cad49de35d: Pull complete \nb215d0b40846: Pull complete \n429305b6c15c: Pull complete \n6f7e10a4e907: Pull complete \nDigest: sha256:265d4a5ed8bf0df27d1107edb00b70e658ee9aa5acb3f37336c5a17db634481e\nStatus: Downloaded newer image "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" registry:2\ndocker.io/library/registry:2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("这将自动下载井启动一个 registry 容器，创建本地的私有仓库服务。默认情况下，仓库会被创建在容器的 "),t("code",[s._v("/var/lib/registry")]),s._v(" 目录下。可以通过 -v 参数来将镜像文件存放在本地的指定路径。例如下面的例子将上传的镜像放到 "),t("code",[s._v("/opt/data/registry")]),s._v(" 目录：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d -v /opt/registry:/var/lib/registry -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000 --name myregistry registry:2\n933e961801d6fb8292f97f1d1eeeeb2457ac40333a562d82907f1b9bea08924c\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("此时，在本地将启动一个私有仓库服务，监听端口为 5000。")]),s._v(" "),t("p",[s._v("浏览器访问 http://127.0.0.1:5000/v2，出现下面情况说明 registry 运行正常。")]),s._v(" "),t("div",{staticClass:"custom-block center"},[t("p",[t("img",{attrs:{src:e(648),alt:"",loading:"lazy"}})]),s._v(" "),t("p",[t("u",[s._v("图 5-3")]),s._v("\tregistry 运行情况")])]),s._v(" "),t("h3",{attrs:{id:"_2、管理私有仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、管理私有仓库"}},[s._v("#")]),s._v(" 2、管理私有仓库")]),s._v(" "),t("p",[s._v("首先在你的系统上搭建私有仓库，查看其地址为 127.0.0.1:5000，然后测试上传和下载镜像 ubuntu:18.04。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images\nREPOSITORY   TAG       IMAGE ID       CREATED        SIZE\nregistry     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("         b2cb11db9d3d   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" days ago     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(".2MB\nubuntu       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.04")]),s._v("     54919e10a95d   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" days ago     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(".1MB\ncentos       latest    300e315adb2f   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" months ago   209MB\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("使用 "),t("code",[s._v("docker tag")]),s._v(" 命令将这个镜像标记为 localhost:5000/ubuntu:18.04（格式为 docker tag [IMAGE[:TAG]] [REGISTRYHOST/] [USERNAME/] NAME [:TAG ]）。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag ubuntu:18.04 localhost:5000/ubuntu:18.04\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images\nREPOSITORY              TAG       IMAGE ID       CREATED        SIZE\nregistry                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("         b2cb11db9d3d   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" days ago     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(".2MB\nlocalhost:5000/ubuntu   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.04")]),s._v("     54919e10a95d   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" days ago     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(".1MB\nubuntu                  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.04")]),s._v("     54919e10a95d   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" days ago     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(".1MB\ncentos                  latest    300e315adb2f   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" months ago   209MB\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("使用 "),t("code",[s._v("docker push")]),s._v(" 上传标记的镜像：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push localhost:5000/ubuntu:18.04 \nThe push refers to repository "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("localhost:5000/ubuntu"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n6babb56be259: Pushed \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.04")]),s._v(": digest: sha256:b9caadbf898c50ce67da0ab5bafc4680997b010c3e17d2bb73d2ae5fe056e52b size: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("529")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("访问 http://127.0.0.1:5000/v2/_catalog 查看私有仓库目录，可以看到刚上传的镜像了：")]),s._v(" "),t("div",{staticClass:"custom-block center"},[t("p",[t("img",{attrs:{src:e(649),alt:"",loading:"lazy"}})]),s._v(" "),t("p",[t("u",[s._v("图 5-4")]),s._v("\t私有仓库目录")])]),s._v(" "),t("p",[s._v("下载私有仓库的镜像：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images\nREPOSITORY   TAG       IMAGE ID       CREATED        SIZE\nregistry     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("         b2cb11db9d3d   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" days ago     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(".2MB\nubuntu       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.04")]),s._v("     54919e10a95d   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" days ago     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(".1MB\ncentos       latest    300e315adb2f   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" months ago   209MB\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull localhost:5000/ubuntu:18.04\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.04")]),s._v(": Pulling from ubuntu\nDigest: sha256:b9caadbf898c50ce67da0ab5bafc4680997b010c3e17d2bb73d2ae5fe056e52b\nStatus: Downloaded newer image "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" localhost:5000/ubuntu:18.04\nlocalhost:5000/ubuntu:18.04\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images\nREPOSITORY              TAG       IMAGE ID       CREATED        SIZE\nregistry                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("         b2cb11db9d3d   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" days ago     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(".2MB\nubuntu                  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.04")]),s._v("     54919e10a95d   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" days ago     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(".1MB\nlocalhost:5000/ubuntu   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.04")]),s._v("     54919e10a95d   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" days ago     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(".1MB\ncentos                  latest    300e315adb2f   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" months ago   209MB\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("下载后，还可以添加 一个更通用的标签 ubuntu:04，方便后续使用：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag localhost:5000/ubuntu:18.04 test_ubuntu:18.04 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("说明")]),s._v(" "),t("p",[s._v("如果要使用安全证书，用户也可以从较知名的 CA 服务商（如 verisign）申请公开的\nSSL/TLS 证书，或者使用 OpenSSL 等软件来自行生成。")])]),s._v(" "),t("h2",{attrs:{id:"小结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),t("p",[s._v("仓库是集中维护容器镜像的地方，为 Docker 镜像文件的分发和管理提供了便捷的途径。这里介绍的 Docker Hub 和时速云镜像市场两个公共仓库服务，可以方便个人用户进行镜像的下载和使用等操作。")]),s._v(" "),t("p",[s._v("在企业的生产环境中，往往需要使用私有仓库来维护内部镜像，这里也介绍了基本的搭建操作，在后续部分中，将介绍私有仓库的更多配置选项。")]),s._v(" "),t("p",[s._v("除了官方的 registry 项目外，用户还可以使用其他的开源方案（例如 nexus）来搭建私有化的容器镜像仓库。")])])}),[],!1,null,null,null);a.default=n.exports},646:function(s,a,e){s.exports=e.p+"assets/img/docker_5-1.913008d0.png"},647:function(s,a,e){s.exports=e.p+"assets/img/docker_5-2.32075794.png"},648:function(s,a,e){s.exports=e.p+"assets/img/docker_5-3.9b845de3.png"},649:function(s,a,e){s.exports=e.p+"assets/img/docker_5-4.0832af18.png"}}]);