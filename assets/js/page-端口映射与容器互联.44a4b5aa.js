(window.webpackJsonp=window.webpackJsonp||[]).push([[112],{1102:function(s,a,t){"use strict";t.r(a);var n=t(1),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("通过前面的学习，相信你已经掌握了单个容器的管理操作。在实践中，经常会碰到需要多个服务组件容器共同协作的情况，这往往需要多个容器之间能够互相访问到对方的服务。")]),s._v(" "),n("p",[s._v("Docker 除了通过网络访间外，还提供了两个很方便的功能来满足服务访问的基本需求：一个是允许映射容器内应用的服务端口到本地宿主主机；另一个是互联机制实现多个容器间通过容器名来快速访问。下面将分别讲解这两个很实用的功能。")]),s._v(" "),n("h2",{attrs:{id:"端口映射实现容器访问"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#端口映射实现容器访问"}},[s._v("#")]),s._v(" 端口映射实现容器访问")]),s._v(" "),n("h3",{attrs:{id:"_1、从外部访问容器应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1、从外部访问容器应用"}},[s._v("#")]),s._v(" 1、从外部访问容器应用")]),s._v(" "),n("p",[s._v("在启动容器的时候，如果不指定对应参数，在容器外部是无法通过网络来访问容器内的网络应用和服务的。")]),s._v(" "),n("p",[s._v("当容器中运行一些网络应用，要让外部访问这些应用时，可以通过 -P 或 -p 参数来指定端口映射。当使用 -P（大写的）标记时，Docker 会随机映射一个 49000～49900 的端口到内部容器开放的网络端口：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d -P training/webapp python app.py\nUnable to "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" image "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'training/webapp:latest'")]),s._v(" locally\nlatest: Pulling from training/webapp\nImage docker.io/training/webapp:latest uses outdated schema1 manifest format. Please upgrade to a schema2 image "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" better future compatibility. More information at https://docs.docker.com/registry/spec/deprecated-schema-v1/\ne190868d63f8: Pull complete \n909cd34c6fd7: Pull complete \n0b9bfabab7c1: Pull complete \na3ed95caeb02: Pull complete \n10bbbc0fc0ff: Pull complete \nfca59b508e9f: Pull complete \ne7ae2541b15b: Pull complete \n9dd97ef58ce9: Pull complete \na4c1b0cb7af7: Pull complete \nDigest: sha256:06e9c1983bd6d5db5fba376ccd63bfa529e8d02f23d5079b8f74a616308fb11d\nStatus: Downloaded newer image "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" training/webapp:latest\n1d3cb3e3c02c0d02fba3f997c31d56755658f177d6776e72994aa435dca6cca4\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -l\nCONTAINER ID   IMAGE             COMMAND           CREATED         STATUS         PORTS                                         NAMES\n1d3cb3e3c02c   training/webapp   "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python app.py"')]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" minutes ago   Up "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" minutes   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:49153-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("/tcp，:::49153-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("/tcp   trusting_chaum\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("p",[s._v("此时，可以使用 "),n("code",[s._v("docker ps")]),s._v(" 看到，本地主机的 49153 被映射到了容器的 5000 端口。")]),s._v(" "),n("p",[s._v("访间宿主主机的 49153 端口即可访问容器内 web 应用提供的界面。")]),s._v(" "),n("div",{staticClass:"custom-block center"},[n("p",[n("img",{attrs:{src:t(650),alt:"",loading:"lazy"}})]),s._v(" "),n("p",[n("u",[s._v("图 7-1")]),s._v("\t浏览器访问本机的 49153 端口")])]),s._v(" "),n("p",[s._v("同样，可以通过 "),n("code",[s._v("docker logs")]),s._v(" 命令来查看应用的信息：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" logs -f trusting_chaum \n * Running on http://0.0.0.0:5000/ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Press CTRL+C to quit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.1 - - "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("08/Sep/2021 07:43:47"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET / HTTP/1.1"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" -\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.1 - - "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("08/Sep/2021 07:43:48"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /favicon.ico HTTP/1.1"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" -\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("-p（小写的）则可以指定要映射的端口，并且，在一个指定端口上只可以绑定一个容器。支持的格式有 "),n("code",[s._v("IP:HostPort:ContainerPort | IP:: ContainerPort | HostPort:ContainerPort")]),s._v("。")]),s._v(" "),n("h3",{attrs:{id:"_2、映射所有接口地址"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2、映射所有接口地址"}},[s._v("#")]),s._v(" 2、映射所有接口地址")]),s._v(" "),n("p",[s._v("使用 HostPort:ContainerPort 格式把本地的 5000 端口映射到容器的 5000 端口，可以执行如下命令：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000 training/webapp python app.py\n739716a4c97b68979f205c412ca0e0ddd1722badca142409ff1b6c05095112e2\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINER ID   IMAGE             COMMAND           CREATED          STATUS          PORTS                                       NAMES\n739716a4c97b   training/webapp   "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python app.py"')]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" seconds ago    Up "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" seconds    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:5000-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("/tcp, :::5000-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("/tcp   gifted_hoover\n57f6feb67848   ubuntu:18.04      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/bash"')]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v(" minutes ago   Up "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v(" minutes                                               interesting_bardeen\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("此时默认会绑定本地所有接口上的所有地址。多次使用 -p 标记可以绑定多个端口。例如：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000 -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v(":80 training/webapp python app.py\na8693f3c75a12c4a51be104a587307d254862b2d98d8242dc18cc4f91a487a4d\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINER ID   IMAGE             COMMAND           CREATED          STATUS          PORTS                                                                              NAMES\na8693f3c75a1   training/webapp   "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python app.py"')]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" seconds ago    Up "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" seconds    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:5000-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("/tcp, :::5000-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("/tcp, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:3000-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp, :::3000-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp   wizardly_torvalds\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"_3、映射到指定地址的指定端口"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3、映射到指定地址的指定端口"}},[s._v("#")]),s._v(" 3、映射到指定地址的指定端口")]),s._v(" "),n("p",[s._v("可以使用 "),n("code",[s._v("IP:HostPort:ContainerPort")]),s._v(" 格式指定映射使用一个特定地址，比如地址 127.0.2.1:5000：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000:5000 training/webapp python app.py\n16df89a9037cc439fd0dcf5905b21679ec729188158427080bcbd4a3c7b14de7\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINER ID   IMAGE             COMMAND           CREATED          STATUS          PORTS                      NAMES\n16df89a9037c   training/webapp   "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python app.py"')]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" seconds ago    Up "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" seconds    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".2.1:5000-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("/tcp   serene_williamson\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"_4、映射到指定地址的任意端口"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4、映射到指定地址的任意端口"}},[s._v("#")]),s._v(" 4、映射到指定地址的任意端口")]),s._v(" "),n("p",[s._v("使用 IP::ContainerPort 绑定 localhost 的任意端口到容器的 5000 端口，本地主机会自动分配一个端口：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1::5000 training/webapp python app.py\nad5320b5cbc11774a0677a973d49a3696769d09a5fc2360b46dc4475d34b4132\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINER ID   IMAGE             COMMAND           CREATED          STATUS          PORTS                       NAMES\nad5320b5cbc1   training/webapp   "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python app.py"')]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" seconds ago    Up "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" seconds    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:49153-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("/tcp   gifted_bell\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("还可以使用 udp 标记来指定 udp 端口：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000:5000/udp training/webapp python app.py\n4da22d44f5575a180d8e494e65440b3b45a59f5d489e8d4aaa350d95ea1c2c14\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINER ID   IMAGE             COMMAND           CREATED          STATUS          PORTS                                NAMES\n4da22d44f557   training/webapp   "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python app.py"')]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" seconds ago    Up "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" seconds    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("/tcp, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("/udp   determined_turing\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"_5、查看映射端口配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5、查看映射端口配置"}},[s._v("#")]),s._v(" 5、查看映射端口配置")]),s._v(" "),n("p",[s._v("使用 "),n("code",[s._v("docker port")]),s._v(" 来查看当前映射的端口配置，也可以查看到绑定的地址：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1::5000 training/webapp python app.py\nac00973485fb8aa90443fd6a1fc7203d80b577d99757d5d5181f931b37b8bfc3\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" port compassionate_brattain \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("/tcp -"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:49154\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),n("p",[s._v("容器有自己的内部网络和 IP 地址，使用 "),n("code",[s._v("docker [container] inspect 容器ID")]),s._v(" 可以获取容器的具体信息。")])]),s._v(" "),n("h2",{attrs:{id:"互联机制实现便捷互访"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#互联机制实现便捷互访"}},[s._v("#")]),s._v(" 互联机制实现便捷互访")]),s._v(" "),n("p",[s._v("容器的互联（Iinking）是一种让多个容器中的应用进行快速交互的方式。它会在源和接收容器之间创建连接关系，接收容器可以通过容器名快速访问到源容器，而不用指定具体的 IP 地址。")]),s._v(" "),n("h3",{attrs:{id:"_1、自定义容器命名"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1、自定义容器命名"}},[s._v("#")]),s._v(" 1、自定义容器命名")]),s._v(" "),n("p",[s._v("连接系统依据容器的名称来执行。因此，首先需要自定义一个好记的容器命名。虽然当创建容器的时候，系统默认会分配一个名字，但自定义命名容器有两个好处：")]),s._v(" "),n("ul",[n("li",[s._v("自定义的命名，比较好记，比如一个 Web 应用容器我们可以给它起名叫 web，一目了然；")]),s._v(" "),n("li",[s._v("当要连接其他容器时候（即便重启），也可以使用容器名而不用改变，比如连接 web 容器到 db 容器。")])]),s._v(" "),n("p",[s._v("使用 --name 标记可以为容器自定义命名：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d -P --name web training/webapp python app.py\n34c73b3f41309246047c1eff9e49888b71a6a7191c1ddb57cec2115d4fb54d3c\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINER ID   IMAGE             COMMAND           CREATED             STATUS             PORTS                                         NAMES\n34c73b3f4130   training/webapp   "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python app.py"')]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" seconds ago       Up "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" seconds       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:49154-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("/tcp, :::49154-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("/tcp   web\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用 docker ps 来验证设定的命名")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("也可以使用 "),n("code",[s._v("docker [container) inspect")]),s._v(" 来查看容器的名字：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" inspect -f "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{.Name}}"')]),s._v(" 34c73b3f4130\n/web\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),n("p",[s._v("容器的名称是唯一的。如果巳经命名了一个叫 web 的容器，当你要再次使用 web 这个名称的时候，需要先用 "),n("code",[s._v("docker rm")]),s._v(" 命令删除之前创建的同名容器。")])]),s._v(" "),n("p",[s._v("在执行 "),n("code",[s._v("docker [container] run")]),s._v(" 的时候如果添加 --rm 标记，则容器在终止后会立刻删除。注意，--rm 和 -d 参数不能同时使用。")]),s._v(" "),n("h3",{attrs:{id:"_2、容器互联"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2、容器互联"}},[s._v("#")]),s._v(" 2、容器互联")]),s._v(" "),n("p",[s._v("使用 --link 参数可以让容器之间安全地进行交互。")]),s._v(" "),n("p",[s._v("下面先创建一个新的数据库容器：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d --name db training/postgres\nUnable to "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" image "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'training/postgres:latest'")]),s._v(" locally\nlatest: Pulling from training/postgres\nImage docker.io/training/postgres:latest uses outdated schema1 manifest format. Please upgrade to a schema2 image "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" better future compatibility. More information at https://docs.docker.com/registry/spec/deprecated-schema-v1/\na3ed95caeb02: Pull complete \n6e71c809542e: Downloading \n2978d9af87ba: Download complete \ne1bca35b062f: Download complete \n500b6decf741: Download complete \n74b14ef2151f: Download complete \n7afd5ed3826e: Download complete \n3c69bb244f5e: Download complete \nd86f9ec5aedf: Download complete \n010fabf20157: Download complete \nlatest: Pulling from training/postgres\nImage docker.io/training/postgres:latest uses outdated schema1 manifest format. Please upgrade to a schema2 image "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" better future compatibility. More information at https://docs.docker.com/registry/spec/deprecated-schema-v1/\na3ed95caeb02: Pull complete \n6e71c809542e: Pull complete \n2978d9af87ba: Pull complete \ne1bca35b062f: Pull complete \n500b6decf741: Pull complete \n74b14ef2151f: Pull complete \n7afd5ed3826e: Pull complete \n3c69bb244f5e: Pull complete \nd86f9ec5aedf: Pull complete \n010fabf20157: Pull complete \nDigest: sha256:a945dc6dcfbc8d009c3d972931608344b76c2870ce796da00a827bd50791907e\nStatus: Downloaded newer image "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" training/postgres:latest\ndd2bf319cac08333c221abd08748a8f06b5ae75f4bab9c45e74785e0d56932e0\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("p",[s._v("删除之前创建的 web 容器：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f web\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("然后创建 一 个新的 web 容器，并将它连接到 db 容器：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d -P --name web --link db:db training/webapp python app.py\nb726365f50d7a4a4b31570bcd8a9ccbe77e6b63fd8f1438182398b5e1426ed21\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("此时，db 容器和 web 容器建立互联关系。")]),s._v(" "),n("p",[s._v("--link 参数的格式为 --link name:alias，其中 name 是要链接的容器的名称，alias 是别名。")]),s._v(" "),n("p",[s._v("使用 "),n("code",[s._v("docker inspect web")]),s._v(" 来查看 web 容器的详情（Links）：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" inspect web \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Id"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"68f6051bd5be4c13b1d97fdfee1b468c1ecbb0ecc203b26ce3673b3744d74b69"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Created"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2021-09-09T00:59:29.018886397Z"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Path"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Args"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app.py"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"State"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Status"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"running"')]),s._v(",\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Links"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/db:/web/db"')]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[s._v("Docker 相当于在两个互联的容器之间创建了一个虚机通道，而且不用映射它们的端口到宿主主机上。在启动 db 容器的时候并没有使用 -p 和 -P 标记，从而避免了暴露数据库服务端口到外部网络上。")]),s._v(" "),n("p",[s._v("Docker 通过两种方式为容器公开连接信息：")]),s._v(" "),n("ul",[n("li",[s._v("更新环境变量;")]),s._v(" "),n("li",[s._v("更新 "),n("code",[s._v("/etc/hosts")]),s._v(" 文件。")])]),s._v(" "),n("p",[s._v("使用 "),n("code",[s._v("env")]),s._v(" 命令来查看 web 容器的环境变量：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run --rm --name web2 --link db:db training/webapp "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("env")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("HOSTNAME")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("4acbb47609c1\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DB_PORT")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tcp://172.17.0.2:5432\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DB_PORT_5432_TCP")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tcp://172.17.0.2:5432\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DB_PORT_5432_TCP_ADDR")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DB_PORT_5432_TCP_PORT")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5432")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DB_PORT_5432_TCP_PROTO")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tcp\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DB_NAME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/web2/db\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DB_ENV_PG_VERSION")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.3")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("HOME")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/root\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("其中 DB_ 开头的环境变量是供 web 容器连接 db 容器使用，前缀采用大写的连接别名。")]),s._v(" "),n("p",[s._v("除了环境变量，Docker 还添加 host 信息到父容器的 /etc/hosts 的文件。下面是父容器 web 的 hosts 文件：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -it --rm --link db:db training/webapp /bin/bash\nroot@4581c58ad217:/opt/webapp"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/hosts ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\tlocalhost\n::1\tlocalhost ip6-localhost ip6-loopback\nfe00::0\tip6-localnet\nff00::0\tip6-mcastprefix\nff02::1\tip6-allnodes\nff02::2\tip6-allrouters\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2\tdb 7d1b09695298\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.4\t4581c58ad217\nroot@4581c58ad217:/opt/webapp"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("这里有 2 个 hosts 信息，第一个是 web 容器，web 容器用自己的 id 作为默认主机名，第二个是 db 容器的 IP 和主机名。")]),s._v(" "),n("p",[s._v("可以在 web 容器中安装 "),n("code",[s._v("ping")]),s._v(" 命令来测试跟 db 容器的连通：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("root@17d65c4c4712:/opt/webapp"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt install -yqq inetutils-ping")]),s._v("\nThe following packages will be REMOVED:\n  iputils-ping ubuntu-minimal\nThe following NEW packages will be installed:\n  inetutils-ping\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" upgraded, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" newly installed, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" to remove and "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" not upgraded.\nNeed to get "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("55.6")]),s._v(" kB of archives.\nAfter this operation, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("131")]),s._v(" kB of additional disk space will be used.\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Reading database "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("18233")]),s._v(" files and directories currently installed."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nRemoving ubuntu-minimal "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.325")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nRemoving iputils-ping "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":20121221-4ubuntu1.1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nSelecting previously unselected package inetutils-ping.\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Reading database "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("18221")]),s._v(" files and directories currently installed."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nPreparing to unpack "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("./inetutils-ping_2%3a1.9.2-1_amd64.deb "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nUnpacking inetutils-ping "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(":1.9.2-1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nSetting up inetutils-ping "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(":1.9.2-1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nroot@17d65c4c4712:/opt/webapp"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ping db")]),s._v("\nPING db "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(" data bytes\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.933")]),s._v(" ms\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.278")]),s._v(" ms\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.172")]),s._v(" ms\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.150")]),s._v(" ms\n^C--- db "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" packets transmitted, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" packets received, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% packet loss\nround-trip min/avg/max/stddev "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.089")]),s._v("/0.290/0.933/0.293 ms\nroot@17d65c4c4712:/opt/webapp"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("p",[s._v("用 ping 来测试 db 容器，它会解析成 172.17.0.2。")]),s._v(" "),n("p",[s._v("用户可以链接多个子容器到父容器，比如可以链接多个 web 到同一个 db 容器上。")]),s._v(" "),n("h2",{attrs:{id:"小结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[s._v("#")]),s._v(" 小结")]),s._v(" "),n("p",[s._v("毫无疑问，容器服务的访间是很关键的一个用途。通过具体案例讲解了 Docker 容器服务访问的两大基本操作，包括基础的容器端口映射机制和容器互联机制。同时，Docker 目前可以成熟支持 Linux 系统自带的网络服务和功能，这既可以利用现有成熟的技术提供稳定支持，又可以实现快速的高性能转发。")]),s._v(" "),n("p",[s._v("在生产环境中，网络方面的需求更加复杂和多变，包括跨主机甚至跨数据中心的通信，这时候往往就需要引入额外的机制，例如 SDN（软件定义网络）或 NFV （网络功能虚拟化）\n的相关技术。")])])}),[],!1,null,null,null);a.default=e.exports},650:function(s,a,t){s.exports=t.p+"assets/img/docker_7-1.fd773062.png"}}]);